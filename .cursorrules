# Uya 项目 Cursor 规则文件

本文档包含 Uya 项目的开发规则和重要参考文档。

## 重要文档

### 编译器实现待办事项（v0.1.0）

项目 v0.1.0 已达成自举，详见 `RELEASE_v0.1.0.md`。

**使用场景**：
- 开始新的实现任务前，先查看上述文档了解当前状态
- 实现功能后，同步更新相应待办文档

---

## 项目结构

- `uya.md` - 完整语言规范
- `grammar_formal.md` - 正式BNF语法规范
- `grammar_quick.md` - 语法速查手册
- `uya_ai_prompt.md` - AI代码生成提示词
- `compiler-mini/` - Uya Mini 编译器源代码（C 实现 + uya-src 自举）
- `RELEASE_v0.1.0.md` - v0.1.0 版本说明

---

## 开发规范

### 文件命名

- Markdown 文档使用小写文件名，单词间用下划线分隔：`todo_implementation.md`
- 代码文件遵循现有命名约定

### 代码风格

- C 代码使用 C99 标准
- 使用 `-Wall -Wextra -pedantic` 编译选项
- 遵循现有的代码风格和注释规范

---

## 编译器开发工作流

新增或修改语言特性时，按以下顺序进行：

### 1. 规范优先
- 更新 `compiler-mini/spec/UYA_MINI_SPEC.md`
- 定义类型、字面量、BNF、语义规则、C99 映射等

### 2. 测试先行
- 在 `tests/programs/` 添加测试用例（如 `test_xxx.uya`）
- 覆盖目标场景，返回 0 表示通过

### 3. C 编译器实现
按编译流水线依次修改：Lexer → AST → Parser → Checker → C99 Codegen

### 4. 自举编译器同步
同步修改 `compiler-mini/uya-src/` 中对应模块，保持 C 版与 Uya 版行为一致。

### 5. 验证流程
```
make build                                    # 构建 C 版编译器
./tests/run_programs.sh --c99 test_xxx.uya    # C 版测试
cd uya-src && ./compile.sh --c99 -e           # 构建自举编译器
./tests/run_programs.sh --uya --c99 test_xxx.uya  # 自举版测试
./compile.sh --c99 -b                         # 自举对比（C 输出必须完全一致）
```

---

## AI 辅助开发提示

当进行编译器开发时：
1. 参考 `RELEASE_v0.1.0.md` 了解当前状态
2. 参考 `uya.md` 和 `grammar_formal.md` 确认语法规范
3. 遵循上述「编译器开发工作流」

