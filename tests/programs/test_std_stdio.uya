// test_std_stdio.uya
// 测试 lib/std/c/stdio 标准库模块（通过 use 导入）

use std.c.stdio;
use std.c.stdio.write_bytes;
use std.c.stdio.i32_to_str;

// ============================================================
// 测试函数
// ============================================================

fn test_i32_to_str() i32 {
    var buf: [byte: 16] = [];

    // 测试 1：正整数
    const len1: usize = i32_to_str(42, &buf[0] as &byte);
    if len1 != 2 {
        return 1;
    }
    if buf[0] != 52 as byte {
        return 2;  // '4' = 52
    }
    if buf[1] != 50 as byte {
        return 3;  // '2' = 50
    }

    // 测试 2：零
    const len2: usize = i32_to_str(0, &buf[0] as &byte);
    if len2 != 1 {
        return 4;
    }
    if buf[0] != 48 as byte {
        return 5;  // '0' = 48
    }

    // 测试 3：负数
    const len3: usize = i32_to_str(0 - 123, &buf[0] as &byte);
    if len3 != 4 {
        return 6;
    }
    if buf[0] != 45 as byte {
        return 7;  // '-' = 45
    }
    if buf[1] != 49 as byte {
        return 8;  // '1' = 49
    }
    if buf[2] != 50 as byte {
        return 9;  // '2' = 50
    }
    if buf[3] != 51 as byte {
        return 10; // '3' = 51
    }

    // 测试 4：多位正整数
    const len4: usize = i32_to_str(12345, &buf[0] as &byte);
    if len4 != 5 {
        return 11;
    }
    if buf[0] != 49 as byte {
        return 12; // '1'
    }
    if buf[4] != 53 as byte {
        return 13; // '5'
    }

    return 0;
}

fn test_put_char() i32 {
    // 测试 1：写入单个字符 'A' (65)
    const result: i32 = stdio.put_char(65);
    if result != 65 {
        return 1;
    }

    // 测试 2：写入换行符
    const result2: i32 = stdio.put_char(10);
    if result2 != 10 {
        return 2;
    }

    return 0;
}

fn test_write_bytes() i32 {
    // 测试 1：写入 "OK\n"
    var msg: [byte: 4] = [];
    msg[0] = 79 as byte;   // 'O'
    msg[1] = 75 as byte;   // 'K'
    msg[2] = 10 as byte;   // '\n'
    const written: i64 = write_bytes(&msg[0] as &byte, 3);
    if written != 3 {
        return 1;
    }

    return 0;
}

// ============================================================
// 主测试入口
// ============================================================

fn main() i32 {
    var result: i32 = 0;

    result = test_i32_to_str();
    if result != 0 {
        return result;  // i32_to_str 测试失败
    }

    result = test_put_char();
    if result != 0 {
        return result + 20;  // put_char 测试失败
    }

    result = test_write_bytes();
    if result != 0 {
        return result + 30;  // write_bytes 测试失败
    }

    return 0;
}
