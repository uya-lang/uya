// 饱和运算 +| -| *| 与包装运算 +% -% *% 测试，规范 uya.md §10、§16
// 返回 0 表示通过

fn main() i32 {
    const max_i32: i32 = 2147483647;
    const min_i32: i32 = (-2147483647 - 1);

    // ----- 饱和加法 +| -----
    const a: i32 = 2000000000;
    const b: i32 = 2000000000;
    const sat_add: i32 = a +| b;  // 溢出，饱和到 INT32_MAX
    if (sat_add != max_i32) {
        return 1;
    }
    const c: i32 = -2000000000;
    const d: i32 = -2000000000;
    const sat_add_neg: i32 = c +| d;  // 下溢，饱和到 INT32_MIN
    if (sat_add_neg != min_i32) {
        return 2;
    }
    const normal_add: i32 = 10 +| 20;
    if (normal_add != 30) {
        return 3;
    }

    // ----- 饱和减法 -| -----
    const e: i32 = -2000000000;
    const f: i32 = 2000000000;
    const sat_sub: i32 = e -| f;  // 下溢，饱和到 INT32_MIN
    if (sat_sub != min_i32) {
        return 4;
    }
    const g: i32 = 2000000000;
    const h: i32 = -2000000000;
    const sat_sub_pos: i32 = g -| h;  // 上溢，饱和到 INT32_MAX
    if (sat_sub_pos != max_i32) {
        return 5;
    }
    const normal_sub: i32 = 50 -| 8;
    if (normal_sub != 42) {
        return 6;
    }

    // ----- 饱和乘法 *| -----
    const m1: i32 = 50000;
    const m2: i32 = 50000;
    const sat_mul: i32 = m1 *| m2;  // 溢出，饱和到 INT32_MAX
    if (sat_mul != max_i32) {
        return 7;
    }
    const normal_mul: i32 = 3 *| 7;
    if (normal_mul != 21) {
        return 8;
    }

    // ----- 包装加法 +% -----
    const w1: i32 = max_i32;
    const w2: i32 = 1;
    const wrap_add: i32 = w1 +% w2;  // 包装到 INT32_MIN
    if (wrap_add != min_i32) {
        return 9;
    }
    const wrap_add2: i32 = 100 +% 200;
    if (wrap_add2 != 300) {
        return 10;
    }

    // ----- 包装减法 -% -----
    const w3: i32 = min_i32;
    const w4: i32 = 1;
    const wrap_sub: i32 = w3 -% w4;  // 包装到 2147483647
    if (wrap_sub != max_i32) {
        return 11;
    }

    // ----- 包装乘法 *% -----
    const w5: i32 = 65536;
    const w6: i32 = 65536;
    const wrap_mul: i32 = w5 *% w6;  // 包装
    if (wrap_mul != 0) {
        return 12;
    }

    return 0;
}
