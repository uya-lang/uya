# 待办事项执行计划

基于 `todo_implementation_pending.md` 的优先级分析，制定以下执行计划。

**最后更新**：2026-01-09

---

## 执行优先级排序

### 高优先级（建议先执行）

#### 1. 元组类型完善（P2）⚠️ 部分实现

**任务分解**：

1.1. **元组字段索引范围检查** ⚠️
   - **复杂度**：中等
   - **位置**：`compiler/src/checker/typechecker.c`
   - **当前状态**：基础类型检查已实现（第1881-1900行），但缺少索引范围检查
   - **需要**：
     - 获取元组类型的元素数量
     - 检查字段索引是否在有效范围内（0 到 element_count-1）
     - 类似于数组边界检查的实现

1.2. **元组模式匹配完善** ⚠️
   - **复杂度**：中等
   - **当前状态**：
     - 语法解析已支持（通过 `parser_parse_tuple_literal`）
     - match 表达式基础功能已实现
     - 需要验证元组模式匹配是否完整工作
   - **需要验证**：
     - match 表达式中元组模式的 IR 生成
     - 代码生成是否支持元组模式匹配

1.3. **元组类型声明类型检查错误修复** ⚠️
   - **复杂度**：低-中等
   - **需要确认**：错误是否仍然存在
   - **如果存在**：修复类型检查器对元组类型的处理

**预计工作量**：2-4 小时

---

#### 2. 编译期常量表达式增强（P3）⚠️

**复杂度**：中等
**位置**：`compiler/src/checker/const_eval.c`

**任务**：
- 改进类型匹配检查
- 扩展支持的常量表达式类型
- 优化常量折叠性能

**预计工作量**：3-5 小时

---

#### 3. 变量遮蔽检查完善（P3）⚠️

**复杂度**：低-中等
**位置**：`compiler/src/checker/typechecker.c`

**任务**：
- 完善遮蔽规则验证
- 添加遮蔽相关的错误消息
- 测试用例完善

**预计工作量**：2-3 小时

---

### 中优先级（大型功能）

#### 4. 模块系统（P1）❌

**复杂度**：高（大型功能）
**预计工作量**：2-4 周

**任务分解**：
- 词法分析器：确认 `export` 和 `use` 关键字支持
- 语法分析器：实现 `export_decl` 和 `import_stmt` 解析
- 模块解析器（新建）：目录扫描、模块路径映射、依赖解析、循环依赖检测
- 符号表扩展：模块级别符号表、导出符号管理、导入符号解析
- 类型检查器：跨模块类型检查、导出符号可见性检查
- IR 生成器：模块信息的 IR 表示
- 代码生成器：多文件代码生成、模块前缀处理

**建议**：这是一个大型功能，建议分阶段实现，可以先实现基础功能再逐步完善。

---

### 低优先级（未来特性）

#### 5. 泛型系统（P3）❌

**复杂度**：非常高（需要完整的类型系统重构）
**状态**：未来特性
**建议**：暂时不实现，等待语言规范稳定

---

#### 6. 显式宏系统（P3）❌

**复杂度**：非常高（需要完整的宏展开系统）
**状态**：未来特性
**建议**：暂时不实现，等待语言规范稳定

---

## 推荐执行顺序

### 第一阶段：快速改进（1-2天）

1. ✅ **元组字段索引范围检查**（如果当前实现不完整）
2. ✅ **验证并完善元组模式匹配**（如果功能不完整）
3. ✅ **变量遮蔽检查完善**（相对简单）

### 第二阶段：功能增强（1周）

4. ✅ **编译期常量表达式增强**

### 第三阶段：大型功能（2-4周）

5. ⚠️ **模块系统**（需要详细设计和规划）

### 第四阶段：未来特性（暂不执行）

6. ❌ **泛型系统**
7. ❌ **显式宏系统**

---

## 执行建议

1. **从小任务开始**：先完成元组类型完善和变量遮蔽检查，这些任务相对独立且影响范围小
2. **测试驱动**：每个功能完成后，编写或更新测试用例验证
3. **模块系统规划**：如果需要实现模块系统，建议先详细设计架构，分阶段实现
4. **文档更新**：完成每个功能后，更新相关文档

---

## 当前状态检查清单

开始执行前，建议先确认：

- [ ] 元组字段索引范围检查的当前实现状态
- [ ] 元组模式匹配的当前工作状态（是否需要修复）
- [ ] 元组类型声明类型检查错误是否仍然存在
- [ ] 变量遮蔽检查的当前实现程度
- [ ] 编译期常量表达式支持的当前范围

---

**下一步行动**：请选择要执行的任务，或从第一阶段的小任务开始。

