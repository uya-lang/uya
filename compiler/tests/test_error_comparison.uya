// 测试错误类型比较功能
// 验证错误类型支持相等性比较：err == error.ErrorName
// 验证错误类型不支持不等性比较（仅支持 ==）

error FileNotFound;
error DivisionByZero;
error InvalidInput;

fn may_fail_basic(flag: i32) !i32 {
    if flag == 1 {
        return error.FileNotFound;
    } else if flag == 2 {
        return error.DivisionByZero;
    } else {
        return 42;
    }
}

fn may_fail_runtime_error() !i32 {
    return error.RuntimeError;  // 运行时错误（未预定义）
}

fn may_fail_multiple(flag: i32) !i32 {
    if flag == 1 {
        return error.FileNotFound;
    } else if flag == 2 {
        return error.DivisionByZero;
    } else if flag == 3 {
        return error.InvalidInput;
    } else {
        return 100;
    }
}

fn test_error_comparison_basic() !i32 {
    // 测试成功路径
    const success: i32 = try may_fail_basic(0);
    if success != 42 {
        return 1;
    }

    // 测试错误比较
    const err1: i32 = may_fail_basic(1) catch |err| {
        if err == error.FileNotFound {
            return 0;  // 正确识别错误类型
        }
        return 1;  // 错误：应该匹配FileNotFound
    };
    if err1 != 0 {
        return 1;
    }

    const err2: i32 = may_fail_basic(2) catch |err| {
        if err == error.DivisionByZero {
            return 0;  // 正确识别错误类型
        }
        return 1;  // 错误：应该匹配DivisionByZero
    };
    if err2 != 0 {
        return 1;
    }

    return 0;
}

fn test_error_comparison_runtime_error() i32 {
    const err: i32 = may_fail_runtime_error() catch |err| {
        if err == error.RuntimeError {
            return 0;  // 正确识别运行时错误
        }
        return 1;
    };
    if err != 0 {
        return 1;
    }

    return 0;
}

fn test_error_comparison_multiple() i32 {
    // 测试多个错误类型的比较
    const err1: i32 = may_fail_multiple(1) catch |err| {
        if err == error.FileNotFound {
            return 10;
        } else if err == error.DivisionByZero {
            return 20;
        } else if err == error.InvalidInput {
            return 30;
        }
        return 0;
    };
    if err1 != 10 {
        return 1;
    }

    const err2: i32 = may_fail_multiple(2) catch |err| {
        if err == error.FileNotFound {
            return 10;
        } else if err == error.DivisionByZero {
            return 20;
        } else if err == error.InvalidInput {
            return 30;
        }
        return 0;
    };
    if err2 != 20 {
        return 1;
    }

    const err3: i32 = may_fail_multiple(3) catch |err| {
        if err == error.FileNotFound {
            return 10;
        } else if err == error.DivisionByZero {
            return 20;
        } else if err == error.InvalidInput {
            return 30;
        }
        return 0;
    };
    if err3 != 30 {
        return 1;
    }

    return 0;
}

fn main() i32 {
    if test_error_comparison_basic() != 0 {
        return 1;
    }
    if test_error_comparison_runtime_error() != 0 {
        return 2;
    }
    if test_error_comparison_multiple() != 0 {
        return 3;
    }
    return 0;
}

