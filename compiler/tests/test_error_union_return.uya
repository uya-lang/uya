// 测试函数返回 !T 类型的各种场景
// 验证生成的 C 代码中：
// 1. 正常返回：error_id = 0, value = 返回值
// 2. 错误返回：error_id = 错误码（非0），value 字段未定义

extern printf(fmt: *byte, ...) i32;

// 测试 1: !i32 正常返回
fn return_success_i32() !i32 {
    return 100;
}

// 测试 2: !i32 错误返回
fn return_error_i32() !i32 {
    return error.DivisionByZero;
}

// 测试 3: !void 正常返回
fn return_success_void() !void {
    return;
}

// 测试 4: !void 错误返回
fn return_error_void() !void {
    return error.FileNotFound;
}

// 测试 5: 条件返回（正常路径）
fn conditional_return_success(flag: i32) !i32 {
    if flag > 0 {
        return 200;
    }
    return 300;
}

// 测试 6: 条件返回（错误路径）
fn conditional_return_error(flag: i32) !i32 {
    if flag < 0 {
        return error.InvalidInput;
    }
    return 400;
}

// 测试 7: 多个返回点
fn multiple_returns(x: i32) !i32 {
    if x == 0 {
        return error.ZeroValue;
    }
    if x < 0 {
        return error.NegativeValue;
    }
    return x * 2;
}

fn main() i32 {
    // 测试正常返回
    const val1: i32 = return_success_i32() catch |err| {
        printf("Unexpected error\n");
        return 1;
    };
    if val1 != 100 {
        printf("Expected 100, got %d\n", val1);
        return 1;
    }
    
    // 测试错误返回
    const val2: i32 = return_error_i32() catch |err| {
        if err == error.DivisionByZero {
            printf("Caught DivisionByZero\n");
        }
        return 0;
    };
    
    // 测试 void 正常返回
    return_success_void() catch |err| {
        printf("Unexpected error in void\n");
        return 1;
    };
    
    // 测试 void 错误返回
    return_error_void() catch |err| {
        if err == error.FileNotFound {
            printf("Caught FileNotFound\n");
        }
    };
    
    // 测试条件返回
    const val3: i32 = conditional_return_success(1) catch |err| {
        printf("Unexpected error\n");
        return 1;
    };
    if val3 != 200 {
        printf("Expected 200, got %d\n", val3);
        return 1;
    }
    
    const val4: i32 = conditional_return_error(-1) catch |err| {
        if err == error.InvalidInput {
            printf("Caught InvalidInput\n");
        }
        return 0;
    };
    
    // 测试多个返回点
    const val5: i32 = multiple_returns(5) catch |err| {
        printf("Unexpected error\n");
        return 1;
    };
    if val5 != 10 {
        printf("Expected 10, got %d\n", val5);
        return 1;
    }
    
    const val6: i32 = multiple_returns(0) catch |err| {
        if err == error.ZeroValue {
            printf("Caught ZeroValue\n");
        }
        return 0;
    };
    
    printf("All return tests passed\n");
    return 0;
}

