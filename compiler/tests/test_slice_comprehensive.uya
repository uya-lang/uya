// 测试切片语法的各种用例
extern printf(fmt: *byte, ...) i32;

struct Point {
    x: i32,
    y: i32
}

// 基本切片测试
fn test_basic_slice() void {
    const arr: [i32; 10] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    
    // 基本切片 [2:5] -> [2, 3, 4]
    const slice1: [i32; 3] = slice(arr, 2, 5);  // 从索引2到4
    printf("Basic slice [2:5]: ");
    for (iter(&slice1)) |item| {
        printf("%d ", item);
    }
    printf("\n");
}

// 负数索引切片测试
fn test_negative_index_slice() void {
    const arr: [i32; 10] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
    
    // 负数索引切片 [-3:10] -> [7, 8, 9]
    const slice1: [i32; 3] = slice(arr, -3, 10);  // 从倒数第3个到末尾
    printf("Negative index slice [-3:10]: ");
    for (iter(&slice1)) |item| {
        printf("%d ", item);
    }
    printf("\n");
    
    // 从某个索引到倒数第几个 [2:-1] -> [2, 3, 4, 5, 6, 7, 8]
    const slice2: [i32; 7] = slice(arr, 2, -1);   // 从索引2到倒数第1个（不包含）
    printf("Slice from index to negative [-1]: ");
    for (iter(&slice2)) |item| {
        printf("%d ", item);
    }
    printf("\n");
    
    // 负数到负数 [-5:-2] -> [5, 6, 7]
    const slice3: [i32; 3] = slice(arr, -5, -2);  // 从倒数第5个到倒数第2个（不包含）
    printf("Negative to negative slice [-5:-2]: ");
    for (iter(&slice3)) |item| {
        printf("%d ", item);
    }
    printf("\n");
}

// 边界测试
fn test_boundary_slice() void {
    const arr: [i32; 5] = [10, 20, 30, 40, 50];
    
    // 空切片
    const empty_slice: [i32; 0] = slice(arr, 2, 2);  // 从索引2到2（不包含），为空
    printf("Empty slice [2:2]: (length %d)\n", len(empty_slice));
    
    // 单元素切片
    const single_slice: [i32; 1] = slice(arr, 2, 3);  // [30]
    printf("Single element slice [2:3]: %d\n", single_slice[0]);
    
    // 整个数组切片
    const full_slice: [i32; 5] = slice(arr, 0, 5);  // [10, 20, 30, 40, 50]
    printf("Full slice [0:5]: ");
    for (iter(&full_slice)) |item| {
        printf("%d ", item);
    }
    printf("\n");
}

// 从开头切片测试
fn test_from_start_slice() void {
    const arr: [i32; 8] = [1, 2, 3, 4, 5, 6, 7, 8];
    
    // 从开头到某个位置 [:4] -> [1, 2, 3, 4]
    const slice1: [i32; 4] = slice(arr, 0, 4);
    printf("From start slice [:4]: ");
    for (iter(&slice1)) |item| {
        printf("%d ", item);
    }
    printf("\n");
    
    // 从开头到倒数第几个 [:-2] -> [1, 2, 3, 4, 5, 6]
    const slice2: [i32; 6] = slice(arr, 0, -2);
    printf("From start to negative [:-2]: ");
    for (iter(&slice2)) |item| {
        printf("%d ", item);
    }
    printf("\n");
}

// 到末尾切片测试
fn test_to_end_slice() void {
    const arr: [i32; 8] = [1, 2, 3, 4, 5, 6, 7, 8];
    
    // 从某个位置到末尾 [3:] -> [4, 5, 6, 7, 8]
    const slice1: [i32; 5] = slice(arr, 3, 8);
    printf("To end slice [3:]: ");
    for (iter(&slice1)) |item| {
        printf("%d ", item);
    }
    printf("\n");
    
    // 从倒数第几个到末尾 [-3:] -> [6, 7, 8]
    const slice2: [i32; 3] = slice(arr, -3, 8);
    printf("From negative to end [-3:]: ");
    for (iter(&slice2)) |item| {
        printf("%d ", item);
    }
    printf("\n");
}

// 结构体数组切片测试
fn test_struct_slice() void {
    const points: [Point; 4] = [
        Point{ x: 1, y: 2 },
        Point{ x: 3, y: 4 },
        Point{ x: 5, y: 6 },
        Point{ x: 7, y: 8 }
    ];
    
    // 结构体数组切片
    const slice: [Point; 2] = slice(points, 1, 3);  // [points[1], points[2]]
    printf("Struct slice [1:3]: ");
    for (iter(&slice)) |pt| {
        printf("(x=%d,y=%d) ", pt.x, pt.y);
    }
    printf("\n");
}

// 字符串切片测试（如果支持的话）
fn test_string_slice() void {
    const str_arr: [byte; 13] = "Hello, World!";
    
    // 字符串切片
    const substr: [byte; 5] = slice(str_arr, 0, 5);  // "Hello"
    printf("String slice [0:5]: ");
    for (iter(&substr)) |ch| {
        printf("%c", ch);
    }
    printf("\n");
    
    // 使用负数索引的字符串切片
    const substr2: [byte; 5] = slice(str_arr, -6, 13);  // "World"
    printf("String slice [-6:13]: ");
    for (iter(&substr2)) |ch| {
        printf("%c", ch);
    }
    printf("\n");
}

fn main() i32 {
    printf("=== 基本切片测试 ===\n");
    test_basic_slice();
    
    printf("\n=== 负数索引切片测试 ===\n");
    test_negative_index_slice();
    
    printf("\n=== 边界测试 ===\n");
    test_boundary_slice();
    
    printf("\n=== 从开头切片测试 ===\n");
    test_from_start_slice();
    
    printf("\n=== 到末尾切片测试 ===\n");
    test_to_end_slice();
    
    printf("\n=== 结构体数组切片测试 ===\n");
    test_struct_slice();
    
    printf("\n=== 字符串切片测试 ===\n");
    test_string_slice();
    
    return 0;
}