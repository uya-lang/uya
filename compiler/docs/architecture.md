# Uya 编译器架构设计

## 概述

Uya 编译器是一个将 Uya 语言源代码转换为 C99 兼容代码的编译器。编译器采用多阶段设计，包含词法分析、语法分析、类型检查、中间表示生成和代码生成等阶段。

## 整体架构

```
+------------------+    +------------------+    +------------------+
|                  |    |                  |    |                  |
|  Uya 源代码      | -> |   词法分析器     | -> |   语法分析器     |
|                  |    |                  |    |                  |
+------------------+    +------------------+    +------------------+
                                                        |
                                                        v
+------------------+    +------------------+    +------------------+
|                  |    |                  |    |                  |
|   类型检查器     | <- |    IR 生成器     | <- |   抽象语法树     |
|                  |    |                  |    |                  |
+------------------+    +------------------+    +------------------+
                                                        |
                                                        v
+------------------+    +------------------+    +------------------+
|                  |    |                  |    |                  |
|   优化器         | -> |  C99 代码生成器  | -> |   C99 代码       |
|                  |    |                  |    |                  |
+------------------+    +------------------+    +------------------+
```

## 模块设计

### 1. 词法分析器 (lexer)
- 将源代码转换为 Token 流
- 识别关键字、标识符、字面量、运算符等
- 处理注释和空白字符

### 2. 语法分析器 (parser)
- 使用递归下降解析构建抽象语法树 (AST)
- 处理所有 Uya 语言语法结构
- 生成类型化的 AST 节点

### 3. 类型检查器 (checker)
- ✅ 验证类型安全
- ✅ 检查函数调用和变量使用
- ✅ 验证内存安全规则
- ✅ 数组边界检查
- ✅ 整数溢出检查
- ✅ 除零检查
- ✅ 未初始化变量检查
- ✅ 空指针解引用检查
- ✅ 路径敏感分析（约束系统）

### 4. 中间表示 (IR)
- 定义 C 语言友好的中间表示
- 便于优化和代码生成
- 保持 Uya 语言特性

### 5. 代码生成器 (codegen)
- 将 IR 转换为 C99 兼容代码
- 生成类型安全的 C 代码
- 处理错误联合类型和内存管理

## 技术栈

- 编译器前端：C99
- 目标语言：C99
- 构建系统：Makefile
- 测试框架：简单的测试脚本

## 设计原则

1. **安全性**：生成的 C 代码必须保持 Uya 的内存安全特性
2. **兼容性**：生成的代码必须符合 C99 标准
3. **可读性**：生成的 C 代码应具有良好的可读性
4. **性能**：生成的代码应具有良好的性能
5. **调试性**：生成的代码应便于调试