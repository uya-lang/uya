# 阶段0：准备工作 - 字符串函数封装和 LLVM API 声明

## 概述

创建字符串辅助函数模块和 LLVM C API 外部函数声明文件，为后续翻译工作做准备。

**优先级**：P0（最高）

**工作量估算**：1-2 小时

**依赖**：无

---

## 任务列表

### 任务 0.1：创建翻译工作目录结构

- [ ] 创建 `uya-src/` 目录
- [ ] 创建各模块的 `.uya` 文件占位符：
  - [ ] `uya-src/arena.uya`（空文件，待阶段1填充）
  - [ ] `uya-src/ast.uya`（空文件，待阶段2填充）
  - [ ] `uya-src/lexer.uya`（空文件，待阶段3填充）
  - [ ] `uya-src/parser.uya`（空文件，待阶段4填充）
  - [ ] `uya-src/checker.uya`（空文件，待阶段5填充）
  - [ ] `uya-src/codegen.uya`（空文件，待阶段6填充）
  - [ ] `uya-src/main.uya`（空文件，待阶段7填充）

**验证**：确认目录和文件已创建

---

### 任务 0.2：创建字符串辅助函数模块

**文件**：`uya-src/str_utils.uya`

- [ ] 声明 C 标准库字符串函数（`extern` 函数）：
  - [ ] `strlen` - 字符串长度
  - [ ] `strcmp` - 字符串比较
  - [ ] `strncmp` - 字符串比较（指定长度）
  - [ ] `strcpy` - 字符串复制
  - [ ] `strncpy` - 字符串复制（指定长度）
  - [ ] `strcat` - 字符串连接
  - [ ] `sprintf` - 格式化字符串
  - [ ] `fprintf` - 格式化输出到文件流
  - [ ] `snprintf` - 格式化字符串（指定长度）
- [ ] 声明字符分类函数（`ctype.h`）：
  - [ ] `isalpha` - 是否为字母
  - [ ] `isdigit` - 是否为数字
  - [ ] `isalnum` - 是否为字母或数字
  - [ ] `isspace` - 是否为空白字符
- [ ] （可选）创建封装函数提供更友好的接口：
  - [ ] `str_equals` - 字符串相等判断（返回 `bool`）
  - [ ] `str_length` - 字符串长度（返回 `i32`）

**参考**：`BOOTSTRAP_PLAN.md` 中的"字符串函数封装详细设计"章节

**验证**：
- 创建简单的测试程序验证字符串函数封装
- 确保所有函数声明语法正确

---

### 任务 0.3：创建 LLVM C API 外部函数声明文件

**文件**：`uya-src/llvm_api.uya`

- [ ] 创建文件框架和注释说明
- [ ] 声明基础的 LLVM C API 函数（根据 CodeGen 模块的需要逐步添加）：
  - [ ] 基础类型和上下文函数
  - [ ] 模块和函数创建函数
  - [ ] 基本块和指令构建函数
  - [ ] 类型创建函数
  - [ ] 常量创建函数
  - [ ] 其他 CodeGen 需要的函数

**注意**：
- 不需要一次性声明所有 LLVM API 函数
- 根据 CodeGen 模块翻译时的需要逐步添加
- 参考 `src/codegen.c` 中使用的 LLVM API 函数

**验证**：
- 确保函数声明语法正确
- 确保类型映射正确（LLVM 类型使用 `*void` 或具体结构体）

---

## 完成标准

- [ ] `uya-src/` 目录已创建
- [ ] 所有模块的 `.uya` 文件占位符已创建
- [ ] `str_utils.uya` 已创建，包含所有必需的字符串函数声明
- [ ] `llvm_api.uya` 已创建，包含基础框架
- [ ] 所有文件语法正确，可以编译（使用 C99 编译器验证）
- [ ] 已更新 `PROGRESS.md`，标记阶段0为完成

---

## 参考文档

- `BOOTSTRAP_PLAN.md` - 自举实现计划，包含字符串函数封装的详细设计
- `spec/UYA_MINI_SPEC.md` - Uya Mini 语言规范，确认 `extern` 函数语法
- `src/codegen.c` - 参考使用的 LLVM API 函数

---

## 注意事项

1. **字符串字面量类型**：在 Uya Mini 中，字符串字面量类型为 `*byte`，仅可用于 `extern` 函数参数
2. **函数声明语法**：使用 `extern fn` 声明外部函数
3. **类型映射**：LLVM 类型（如 `LLVMValueRef`）映射为 `*void` 或具体结构体指针类型
4. **逐步添加**：LLVM API 声明不需要一次性完成，可以根据需要逐步添加

