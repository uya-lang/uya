// 测试结构体含 &[T] 切片字段：声明、初始化、字段访问、@len、@size_of、@align_of
// 返回 0 表示通过

struct Data {
    values: &[i32],
    tag: i32,
}

fn main() i32 {
    var arr: [i32: 5] = [1, 2, 3, 4, 5];
    const s: &[i32] = arr[0:3];

    // 结构体初始化：切片字段
    var data: Data = Data{ values: s, tag: 42 };
    if data.tag != 42 {
        return 1;
    }
    if @len(data.values) != 3 {
        return 2;
    }
    if data.values[0] != 1 || data.values[2] != 3 {
        return 3;
    }

    // 修改原数组，通过结构体切片字段访问
    arr[1] = 99;
    if data.values[1] != 99 {
        return 4;
    }

    // @size_of：结构体类型、变量、切片字段
    if @size_of(Data) != @size_of(data) {
        return 5;
    }
    if @size_of(data.values) != @size_of(&[i32]) {
        return 6;
    }

    // @align_of：结构体类型、变量、切片类型
    if @align_of(Data) != @align_of(data) {
        return 7;
    }
    if @align_of(s) != @align_of(&[i32]) {
        return 8;
    }

    // @size_of &[T]、@align_of &[T] 常数比较（胖指针 ptr+len = 2*usize，对齐=usize）
    if @size_of(&[i32]) != @size_of(usize) * 2 {
        return 9;
    }
    if @align_of(&[i32]) != @align_of(usize) {
        return 10;
    }

    return 0;
}
