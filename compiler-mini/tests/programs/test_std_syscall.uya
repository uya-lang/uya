// test_std_syscall.uya
// 测试 lib/std/c/syscall 标准库模块（通过 use 导入）

use std.c.syscall.sys_write;
use std.c.syscall.sys_open;
use std.c.syscall.sys_close;
use std.c.syscall.sys_getpid;
use std.c.syscall.STDOUT_FILENO;
use std.c.syscall.O_CREAT;
use std.c.syscall.O_WRONLY;
use std.c.syscall.O_TRUNC;
use std.c.syscall.S_IRWXU;

fn main() i32 {
    const msg1: *byte = "Hello from syscall wrappers!\n";
    const len1: i64 = 30;
    _ = sys_write(STDOUT_FILENO, msg1 as i64, len1) catch {
        return 1;
    };

    const path: *byte = "/tmp/test_file.txt";
    const fd_result: !i64 = sys_open(path as i64, O_CREAT | O_WRONLY | O_TRUNC, S_IRWXU);
    const fd: i64 = fd_result catch {
        return 2;
    };

    const msg2: *byte = "Writing via syscall!\n";
    const len2: i64 = 21;
    _ = sys_write(fd, msg2 as i64, len2) catch {
        _ = sys_close(fd);
        return 3;
    };

    _ = sys_close(fd) catch {
        return 4;
    };

    const pid: i64 = sys_getpid();
    if pid <= 0 {
        return 5;
    }

    return 0;
}
