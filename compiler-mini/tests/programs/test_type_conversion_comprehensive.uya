// 类型转换完整测试程序
// 测试所有支持的类型转换：i32↔byte、i32↔bool、i32↔usize、&void↔&T

fn main() i32 {
    // ========== 测试1：i32 ↔ byte 转换 ==========
    
    // 1.1 i32 as byte（截断）
    var i32_val: i32 = 256;
    var byte_val: byte = i32_val as byte;
    if byte_val != 0 {
        return 1;  // 256 截断为 byte 应该是 0（只保留低 8 位）
    }
    
    var i32_val2: i32 = 42;
    var byte_val2: byte = i32_val2 as byte;
    if byte_val2 != 42 {
        return 2;  // 42 转换为 byte 应该是 42
    }
    
    var i32_val3: i32 = 300;
    var byte_val3: byte = i32_val3 as byte;
    if byte_val3 != 44 {
        return 3;  // 300 截断为 byte 应该是 44（300 % 256 = 44）
    }
    
    // 1.2 byte as i32（零扩展）
    var byte_val4: byte = 200;
    var i32_val4: i32 = byte_val4 as i32;
    if i32_val4 != 200 {
        return 4;  // byte 200 零扩展为 i32 应该是 200
    }
    
    var byte_val5: byte = 0;
    var i32_val5: i32 = byte_val5 as i32;
    if i32_val5 != 0 {
        return 5;  // byte 0 零扩展为 i32 应该是 0
    }
    
    // ========== 测试2：i32 ↔ bool 转换 ==========
    
    // 2.1 i32 as bool（非零值为 true，零值为 false）
    var i32_val6: i32 = 42;
    var bool_val1: bool = i32_val6 as bool;
    if bool_val1 != true {
        return 6;  // 非零值应该转换为 true
    }
    
    var i32_val7: i32 = 0;
    var bool_val2: bool = i32_val7 as bool;
    if bool_val2 != false {
        return 7;  // 零值应该转换为 false
    }
    
    var i32_val8: i32 = -1;
    var bool_val3: bool = i32_val8 as bool;
    if bool_val3 != true {
        return 8;  // 负数（非零）应该转换为 true
    }
    
    // 2.2 bool as i32（true 转换为 1，false 转换为 0）
    var bool_val4: bool = true;
    var i32_val9: i32 = bool_val4 as i32;
    if i32_val9 != 1 {
        return 9;  // true 应该转换为 1
    }
    
    var bool_val5: bool = false;
    var i32_val10: i32 = bool_val5 as i32;
    if i32_val10 != 0 {
        return 10;  // false 应该转换为 0
    }
    
    // ========== 测试3：i32 ↔ usize 转换 ==========
    
    // 3.1 i32 as usize
    var i32_val11: i32 = 123;
    var usize_val1: usize = i32_val11 as usize;
    if usize_val1 != 123 as usize {
        return 11;  // i32 123 转换为 usize 应该是 123
    }
    
    var i32_val12: i32 = 0;
    var usize_val2: usize = i32_val12 as usize;
    if usize_val2 != 0 as usize {
        return 12;  // i32 0 转换为 usize 应该是 0
    }
    
    // 3.2 usize as i32
    var usize_val3: usize = 456 as usize;
    var i32_val13: i32 = usize_val3 as i32;
    if i32_val13 != 456 {
        return 13;  // usize 456 转换为 i32 应该是 456
    }
    
    var usize_val4: usize = 0 as usize;
    var i32_val14: i32 = usize_val4 as i32;
    if i32_val14 != 0 {
        return 14;  // usize 0 转换为 i32 应该是 0
    }
    
    // ========== 测试4：指针类型转换 ==========
    
    // 4.1 &T as &void（类型擦除）
    var x: i32 = 42;
    var i32_ptr: &i32 = &x;
    var void_ptr: &void = i32_ptr as &void;
    if void_ptr == null {
        return 15;  // void_ptr 不应该是 null
    }
    
    // 4.2 &void as &T（类型恢复）
    var recovered_i32_ptr: &i32 = void_ptr as &i32;
    if recovered_i32_ptr == null {
        return 16;  // recovered_i32_ptr 不应该是 null
    }
    if *recovered_i32_ptr != 42 {
        return 17;  // 恢复后的指针应该指向值 42
    }
    
    // 4.3 &T as *T（FFI 指针转换）
    var y: i32 = 100;
    var normal_ptr: &i32 = &y;
    // 注意：*T 类型不能用于普通变量声明，只能在 extern 函数调用时使用
    // 这里只测试转换语法本身
    
    // ========== 测试5：类型转换在表达式中使用 ==========
    
    // 5.1 类型转换用于比较运算
    var byte_val6: byte = 42;
    if (byte_val6 as i32) != 42 {
        return 18;  // 转换为 i32 后比较应该正确
    }
    
    // 5.2 类型转换用于算术运算
    var byte_val7: byte = 10;
    var i32_val15: i32 = 20;
    var result: i32 = (byte_val7 as i32) + i32_val15;
    if result != 30 {
        return 19;  // 类型转换后运算应该正确
    }
    
    // 5.3 类型转换用于条件表达式
    var i32_val16: i32 = 42;
    var bool_val6: bool = (i32_val16 as bool);
    if bool_val6 != true {
        return 20;  // 非零值转换为 bool 应该是 true
    }
    
    // ========== 测试6：类型转换优先级 ==========
    
    // 6.1 类型转换优先级高于乘除运算
    var i32_val17: i32 = 10;
    var byte_val8: byte = 2;
    // (i32_val17 as byte) * byte_val8 应该先转换再乘法
    var result2: i32 = (i32_val17 as byte) as i32 * (byte_val8 as i32);
    if result2 != 20 {
        return 21;  // 类型转换优先级测试
    }
    
    // 所有测试通过
    return 0;
}

