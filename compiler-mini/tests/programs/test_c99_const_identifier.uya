// 测试 C99 后端常量标识符支持
// 验证 eval_const_expr 函数能正确评估常量标识符

// 基本常量
const MAX_SIZE: i32 = 64;
const SMALL_SIZE: i32 = 8;

// 常量表达式
const SIZE_10: i32 = 10;
const SIZE_5: i32 = 5;
const TOTAL_SIZE: i32 = SIZE_10 + SIZE_5;  // 应该是 15

// 常量链
const BASE: i32 = 100;
const OFFSET: i32 = BASE;  // 引用其他常量
const FINAL_SIZE: i32 = OFFSET + 20;  // 应该是 120

// 测试函数：使用常量作为数组大小
fn test_basic_const_array() i32 {
    var arr: [i32: MAX_SIZE] = [];
    if @len(arr) != 64 {
        return 1;
    }
    return 0;
}

fn test_const_expr_array() i32 {
    var arr: [i32: TOTAL_SIZE] = [];
    if @len(arr) != 15 {
        return 1;
    }
    return 0;
}

fn test_const_chain_array() i32 {
    var arr: [i32: FINAL_SIZE] = [];
    if @len(arr) != 120 {
        return 1;
    }
    return 0;
}

fn test_multiple_const_arrays() i32 {
    var arr1: [i32: MAX_SIZE] = [];
    var arr2: [i32: SMALL_SIZE] = [];
    var arr3: [i32: TOTAL_SIZE] = [];
    
    if @len(arr1) != 64 {
        return 1;
    }
    if @len(arr2) != 8 {
        return 2;
    }
    if @len(arr3) != 15 {
        return 3;
    }
    return 0;
}

// 全局嵌套常量（用于测试常量链）
const NESTED_A: i32 = 50;
const NESTED_B: i32 = NESTED_A;
const NESTED_C: i32 = NESTED_B + 10;

fn test_nested_const() i32 {
    var arr: [i32: NESTED_C] = [];
    if @len(arr) != 60 {
        return 1;
    }
    return 0;
}

fn main() i32 {
    const result1: i32 = test_basic_const_array();
    if result1 != 0 {
        return result1;
    }
    
    const result2: i32 = test_const_expr_array();
    if result2 != 0 {
        return result2 + 10;
    }
    
    const result3: i32 = test_const_chain_array();
    if result3 != 0 {
        return result3 + 20;
    }
    
    const result4: i32 = test_multiple_const_arrays();
    if result4 != 0 {
        return result4 + 30;
    }
    
    const result5: i32 = test_nested_const();
    if result5 != 0 {
        return result5 + 40;
    }
    
    return 0;
}

