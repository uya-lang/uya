// null 字面量作为函数返回值测试程序
// 测试 null 字面量在 return 语句中的使用，验证可以返回给任意类型的指针

struct Node {
    value: i32,
    next: &Node,
}

struct Point {
    x: i32,
    y: i32,
}

// 全局变量用于测试返回指针
var global_x: i32 = 42;

// 测试1：返回 &i32 类型的 null
fn return_null_i32() &i32 {
    return null;
}

// 测试2：返回 &void 类型的 null
fn return_null_void() &void {
    return null;
}

// 测试3：返回结构体指针类型的 null
fn return_null_node() &Node {
    return null;
}

// 测试4：返回结构体指针类型的 null（Point）
fn return_null_point() &Point {
    return null;
}

// 测试5：返回 &usize 类型的 null
fn return_null_usize() &usize {
    return null;
}

// 测试6：返回 &bool 类型的 null
fn return_null_bool() &bool {
    return null;
}

// 测试7：返回 &byte 类型的 null
fn return_null_byte() &byte {
    return null;
}

// 测试8：条件返回 null
fn conditional_return_null(condition: bool) &i32 {
    if condition {
        return null;
    }
    // 使用全局变量，避免返回局部变量地址
    global_x = 42;
    return &global_x;
}

// 测试9：多个 return null 语句
fn multiple_return_null(flag: i32) &Node {
    if flag == 0 {
        return null;
    }
    if flag == 1 {
        return null;
    }
    return null;
}

fn main() i32 {
    // 测试1：调用返回 &i32 类型的 null
    var ptr1: &i32 = return_null_i32();
    if ptr1 != null {
        return 1;  // ptr1 应该是 null
    }
    
    // 测试2：调用返回 &void 类型的 null
    var void_ptr: &void = return_null_void();
    if void_ptr != null {
        return 2;  // void_ptr 应该是 null
    }
    
    // 测试3：调用返回结构体指针类型的 null
    var node_ptr: &Node = return_null_node();
    if node_ptr != null {
        return 3;  // node_ptr 应该是 null
    }
    
    // 测试4：调用返回 Point 指针类型的 null
    var point_ptr: &Point = return_null_point();
    if point_ptr != null {
        return 4;  // point_ptr 应该是 null
    }
    
    // 测试5：调用返回 &usize 类型的 null
    var usize_ptr: &usize = return_null_usize();
    if usize_ptr != null {
        return 5;  // usize_ptr 应该是 null
    }
    
    // 测试6：调用返回 &bool 类型的 null
    var bool_ptr: &bool = return_null_bool();
    if bool_ptr != null {
        return 6;  // bool_ptr 应该是 null
    }
    
    // 测试7：调用返回 &byte 类型的 null
    var byte_ptr: &byte = return_null_byte();
    if byte_ptr != null {
        return 7;  // byte_ptr 应该是 null
    }
    
    // 测试8：条件返回 null
    var ptr2: &i32 = conditional_return_null(true);
    if ptr2 != null {
        return 8;  // ptr2 应该是 null（condition 为 true）
    }
    
    var ptr3: &i32 = conditional_return_null(false);
    if ptr3 == null {
        return 9;  // ptr3 不应该是 null（condition 为 false）
    }
    if *ptr3 != 42 {
        return 10;  // ptr3 应该指向值 42
    }
    
    // 测试9：多个 return null 语句
    var node_ptr2: &Node = multiple_return_null(0);
    if node_ptr2 != null {
        return 11;  // node_ptr2 应该是 null
    }
    
    var node_ptr3: &Node = multiple_return_null(1);
    if node_ptr3 != null {
        return 12;  // node_ptr3 应该是 null
    }
    
    var node_ptr4: &Node = multiple_return_null(2);
    if node_ptr4 != null {
        return 13;  // node_ptr4 应该是 null
    }
    
    // 所有测试通过
    return 0;
}

