# Uya Mini è§„èŒƒæ‰©å±• TODO æ–‡æ¡£ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰

æœ¬æ–‡æ¡£è®°å½•ä¸ºæ”¯æŒä½¿ç”¨ Uya Mini é‡æ„ compiler-mini è€Œéœ€è¦æ·»åŠ çš„è¯­è¨€ç‰¹æ€§ã€‚**æ‰€æœ‰ç‰¹æ€§å¿…é¡»ç¬¦åˆå®Œæ•´ Uya è¯­è¨€è§„èŒƒ**ï¼ˆå‚è€ƒ `uya_ai_prompt.md`ï¼‰ã€‚

**åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-11  
**æœ€åæ›´æ–°**ï¼š2026-01-13ï¼ˆæ›´æ–°å®ç°çŠ¶æ€ï¼šextern å‡½æ•° FFI æŒ‡é’ˆç±»å‹å‚æ•°æ”¯æŒå·²å®Œæˆï¼‰  
**ç›®çš„**ï¼šè®°å½•éœ€è¦æ·»åŠ åˆ° Uya Mini è§„èŒƒä¸­çš„ç‰¹æ€§ï¼Œä»¥æ”¯æŒ compiler-mini çš„è‡ªä¸¾é‡æ„ï¼Œæ‰€æœ‰è¯­æ³•å¿…é¡»ç¬¦åˆå®Œæ•´ Uya è¯­è¨€è§„èŒƒã€‚

**æ³¨æ„**ï¼šæœ¬æ–‡æ¡£è®°å½•çš„æ˜¯**ç¼–è¯‘å™¨å®ç°çŠ¶æ€**ï¼Œè€Œä¸æ˜¯è§„èŒƒæ–‡æ¡£çŠ¶æ€ã€‚è§„èŒƒæ–‡æ¡£ï¼ˆ`spec/UYA_MINI_SPEC.md`ï¼‰å¯èƒ½å·²ç»å®šä¹‰äº†æŸäº›ç‰¹æ€§çš„è¯­æ³•ï¼Œä½†ç¼–è¯‘å™¨å®ç°çŠ¶æ€å¯èƒ½ä»ä¸º"æœªå®ç°"ã€‚å®ç°çŠ¶æ€ä»…æŒ‡ç¼–è¯‘å™¨ä»£ç çš„å®ç°ï¼Œä¸åŒ…æ‹¬è§„èŒƒæ–‡æ¡£çš„ç¼–å†™ã€‚

---

## ğŸš§ å½“å‰å®ç°è¿›åº¦

**çŠ¶æ€**ï¼šğŸ”„ è¿›è¡Œä¸­ï¼ˆ2026-01-13ï¼Œfor å¾ªç¯å·²å®ç°ï¼‰

**å·²å®Œæˆçš„å·¥ä½œ**ï¼š
- âœ… æ·»åŠ  `TOKEN_AMPERSAND` åˆ° `lexer.h`ï¼ˆæ”¯æŒå–åœ°å€è¿ç®—ç¬¦ `&`ï¼‰
- âœ… ä¿®æ”¹ `lexer.c` è¯†åˆ«å•ä¸ª `&` ç¬¦å·ï¼ˆä¹‹å‰åªè¯†åˆ« `&&`ï¼‰
- âœ… æ‰©å±• `TypeKind` æšä¸¾æ·»åŠ  `TYPE_POINTER` å’Œ `TYPE_ARRAY`
- âœ… æ‰©å±• `Type` ç»“æ„ä½“æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹ï¼ˆä½¿ç”¨ union å­˜å‚¨ä¸åŒç±»å‹æ•°æ®ï¼‰
- âœ… æ›´æ–° `checker.c` ä¸­æ‰€æœ‰ä½¿ç”¨ Type ç»“æ„ä½“çš„åœ°æ–¹ï¼ˆä» `.struct_name` æ”¹ä¸º `.data.struct_name`ï¼‰
- âœ… æ›´æ–° `type_equals` å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ¯”è¾ƒ

**å½“å‰è¿›åº¦**ï¼ˆæœ€åæ›´æ–°ï¼š2026-01-13ï¼‰ï¼š
- âœ… æ­¥éª¤1ï¼šæ‰©å±• AST èŠ‚ç‚¹ç±»å‹æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹ï¼ˆå·²å®Œæˆï¼‰
- âœ… æ­¥éª¤2ï¼šæ‰©å±•è§£æå™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹è§£æï¼ˆå·²å®Œæˆï¼‰
- âœ… æ­¥éª¤3ï¼šæ‰©å±•ç±»å‹æ£€æŸ¥å™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ£€æŸ¥ï¼ˆå·²å®Œæˆï¼‰
  - âœ… `type_from_ast()` å‡½æ•°æ‰©å±•
  - âœ… `checker_infer_type()` å‡½æ•°æ‰©å±•ï¼ˆæ”¯æŒå–åœ°å€å’Œè§£å¼•ç”¨ï¼‰
  - âœ… `checker_check_unary_expr()` å‡½æ•°æ‰©å±•ï¼ˆæ”¯æŒå–åœ°å€å’Œè§£å¼•ç”¨ï¼‰
- âœ… æ­¥éª¤4ï¼šå®ç°å–åœ°å€å’Œè§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆå·²å®Œæˆï¼‰
  - âœ… è§£æå™¨æ‰©å±•å®Œæˆ
  - âœ… ç±»å‹æ£€æŸ¥å™¨æ‰©å±•å®Œæˆ
  - âœ… ä»£ç ç”Ÿæˆå™¨æ‰©å±•å®Œæˆï¼ˆ`&expr` ä½¿ç”¨å˜é‡æŒ‡é’ˆæˆ–ä¸´æ—¶ç©ºé—´åœ°å€ï¼Œ`*expr` ä½¿ç”¨ `LLVMBuildLoad2`ï¼‰
- âœ… æ­¥éª¤5ï¼šæ‰©å±•ä»£ç ç”Ÿæˆå™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹ä»£ç ç”Ÿæˆï¼ˆå·²å®Œæˆï¼‰
  - âœ… æ‰©å±• `get_llvm_type_from_ast()` å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ˜ å°„åˆ° LLVM ç±»å‹
  - âœ… æ”¯æŒåµŒå¥—ç±»å‹ï¼ˆæŒ‡é’ˆæŒ‡å‘ç»“æ„ä½“ã€æ•°ç»„å…ƒç´ ä¸ºæŒ‡é’ˆç­‰ï¼‰
  - âœ… æ•°ç»„å˜é‡å£°æ˜ä»£ç ç”Ÿæˆï¼ˆé€šè¿‡ `get_llvm_type_from_ast()` å·²æ”¯æŒï¼‰
  - âœ… æ•°ç»„å­—é¢é‡ä»£ç ç”Ÿæˆå·²å®ç°
  - âœ… æ•°ç»„è®¿é—®è¯­æ³•ï¼ˆ`arr[index]`ï¼‰å·²å®ç°ï¼ˆAST_ARRAY_ACCESS èŠ‚ç‚¹ç±»å‹ã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆå‡æ”¯æŒï¼‰
- âœ… æ­¥éª¤6ï¼šå®ç° `sizeof` å†…ç½®å‡½æ•°ï¼ˆå·²å®Œæˆï¼‰
- âœ… æ­¥éª¤7ï¼šæ‰©å±• `extern` å‡½æ•°å£°æ˜æ”¯æŒæŒ‡é’ˆç±»å‹å‚æ•°ï¼ˆå·²å®Œæˆï¼Œ2026-01-13ï¼‰

**ä¸‹ä¸€æ­¥å·¥ä½œ**ï¼ˆæŒ‰å®ç°é¡ºåºï¼‰ï¼š
1. âœ… **æ‰©å±• AST èŠ‚ç‚¹ç±»å‹**ï¼ˆå·²å®Œæˆï¼Œ2026-01-11 ç»­ï¼‰
   - æ·»åŠ  `AST_TYPE_POINTER` èŠ‚ç‚¹ç±»å‹ï¼ˆ`&T` å’Œ `*T`ï¼‰
   - æ·»åŠ  `AST_TYPE_ARRAY` èŠ‚ç‚¹ç±»å‹ï¼ˆ`[T: N]`ï¼‰
   - æ‰©å±• `ast.h` ä¸­çš„ union ç»“æ„ä½“æ”¯æŒæ–°èŠ‚ç‚¹ç±»å‹
   - æ‰©å±• `ast.c` ä¸­çš„èŠ‚ç‚¹åˆ›å»ºå‡½æ•°

2. âœ… **æ‰©å±•è§£æå™¨æ”¯æŒç±»å‹è¯­æ³•**ï¼ˆå·²å®Œæˆï¼Œ2026-01-11 ç»­ï¼‰
   - âœ… æ‰©å±• `parser_parse_type()` å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹è¯­æ³•
   - âœ… æ·»åŠ é€’å½’è§£æé€»è¾‘ï¼ˆæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹å¯ä»¥åµŒå¥—ï¼‰
   - âœ… æ·»åŠ  4 ä¸ªæµ‹è¯•ç”¨ä¾‹éªŒè¯æ–°ç±»å‹è¯­æ³•è§£æ

3. âœ… **æ‰©å±•ç±»å‹æ£€æŸ¥å™¨**ï¼ˆå·²å®Œæˆï¼Œ2026-01-11 ç»­ï¼‰
   - âœ… æ‰©å±• `type_from_ast()` å‡½æ•°æ”¯æŒä» AST ç±»å‹èŠ‚ç‚¹åˆ›å»ºæŒ‡é’ˆå’Œæ•°ç»„ Type ç»“æ„
   - âœ… æ‰©å±• `checker_infer_type()` å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ¨æ–­ï¼Œä»¥åŠå–åœ°å€å’Œè§£å¼•ç”¨è¿ç®—ç¬¦çš„ç±»å‹æ¨æ–­
   - âœ… æ‰©å±• `checker_check_unary_expr()` å‡½æ•°æ”¯æŒå–åœ°å€å’Œè§£å¼•ç”¨è¿ç®—ç¬¦çš„ç±»å‹æ£€æŸ¥
   - âœ… æ‰€æœ‰ç°æœ‰æµ‹è¯•é€šè¿‡

4. âœ… **å®ç°å–åœ°å€å’Œè§£å¼•ç”¨è¿ç®—ç¬¦**ï¼ˆå·²å®Œæˆï¼Œ2026-01-11 ç»­ï¼‰
   - âœ… æ‰©å±•ä¸€å…ƒè¡¨è¾¾å¼è§£æï¼ˆ`parser_parse_unary_expr()`ï¼‰æ”¯æŒ `&expr` å’Œ `*expr`
   - âœ… æ‰©å±•ç±»å‹æ£€æŸ¥å™¨æ”¯æŒå–åœ°å€å’Œè§£å¼•ç”¨ç±»å‹æ£€æŸ¥å’Œç±»å‹æ¨æ–­
   - âœ… æ‰©å±•ä»£ç ç”Ÿæˆå™¨æ”¯æŒå–åœ°å€ï¼ˆä½¿ç”¨å˜é‡æŒ‡é’ˆæˆ–ä¸´æ—¶ç©ºé—´åœ°å€ï¼‰å’Œè§£å¼•ç”¨ï¼ˆ`LLVMBuildLoad2`ï¼‰

5. âœ… **æ‰©å±•ä»£ç ç”Ÿæˆå™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹**ï¼ˆå·²å®Œæˆï¼Œ2026-01-13ï¼‰
   - âœ… æ‰©å±• `get_llvm_type_from_ast()` å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ˜ å°„åˆ° LLVM ç±»å‹
   - âœ… æ”¯æŒåµŒå¥—ç±»å‹ï¼ˆæŒ‡é’ˆæŒ‡å‘ç»“æ„ä½“ã€æ•°ç»„å…ƒç´ ä¸ºæŒ‡é’ˆç­‰ï¼‰
   - âœ… æ•°ç»„å˜é‡å£°æ˜ä»£ç ç”Ÿæˆï¼ˆé€šè¿‡ `get_llvm_type_from_ast()` å·²æ”¯æŒï¼‰
   - âœ… æ•°ç»„å­—é¢é‡ä»£ç ç”Ÿæˆå·²å®ç°
   - âœ… æ•°ç»„è®¿é—®è¯­æ³•ï¼ˆ`arr[index]`ï¼‰å·²å®ç°ï¼ˆAST_ARRAY_ACCESS èŠ‚ç‚¹ç±»å‹ã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆå‡æ”¯æŒï¼‰

6. âœ… **å®ç° `sizeof` å†…ç½®å‡½æ•°**ï¼ˆå·²å®Œæˆï¼Œ2026-01-13ï¼‰
   - âœ… AST_SIZEOF èŠ‚ç‚¹ç±»å‹å·²å­˜åœ¨ï¼ˆåœ¨ä¹‹å‰çš„æ­¥éª¤ä¸­å®Œæˆï¼‰
   - âœ… æ·»åŠ  `TOKEN_SIZEOF` åˆ° lexer.h å’Œ lexer.c
   - âœ… æ‰©å±•è§£æå™¨æ”¯æŒ `sizeof(Type)` å’Œ `sizeof(expr)` è¯­æ³•ï¼ˆä½¿ç”¨ TOKEN_SIZEOFï¼‰
   - âœ… æ‰©å±•ç±»å‹æ£€æŸ¥å™¨æ”¯æŒ `sizeof` ç±»å‹æ¨æ–­ï¼ˆè¿”å› i32 ç±»å‹ï¼‰
   - âœ… æ‰©å±•ä»£ç ç”Ÿæˆå™¨æ”¯æŒ `sizeof` ä»£ç ç”Ÿæˆï¼ˆåŸºç¡€ç±»å‹ã€æŒ‡é’ˆç±»å‹ã€æ•°ç»„ç±»å‹å¤§å°è®¡ç®—ï¼‰
   - âœ… ç»“æ„ä½“ç±»å‹å¤§å°è®¡ç®—å·²å®ç°ï¼ˆä½¿ç”¨ TargetData çš„ `LLVMStoreSizeOfType`ï¼‰

7. âœ… **å®ç° `len` å†…ç½®å‡½æ•°**ï¼ˆå·²å®Œæˆï¼Œ2026-01-13ï¼‰
   - âœ… æ·»åŠ  `AST_LEN` èŠ‚ç‚¹ç±»å‹åˆ° ast.h
   - âœ… æ·»åŠ  `TOKEN_LEN` åˆ° lexer.h å’Œ lexer.c
   - âœ… æ‰©å±•è§£æå™¨æ”¯æŒ `len(expr)` è¯­æ³•
   - âœ… æ‰©å±•ç±»å‹æ£€æŸ¥å™¨æ”¯æŒ `len` ç±»å‹æ¨æ–­å’Œæ£€æŸ¥ï¼ˆè¿”å› i32 ç±»å‹ï¼ŒéªŒè¯å‚æ•°ä¸ºæ•°ç»„ç±»å‹ï¼‰
   - âœ… æ‰©å±•ä»£ç ç”Ÿæˆå™¨æ”¯æŒ `len` ä»£ç ç”Ÿæˆï¼ˆä½¿ç”¨ `LLVMGetArrayLength` è·å–æ•°ç»„é•¿åº¦ï¼‰
   - âœ… æ”¯æŒç©ºæ•°ç»„å­—é¢é‡ï¼ˆ`[]` è¡¨ç¤ºæœªåˆå§‹åŒ–ï¼Œ`len` è¿”å›æ•°ç»„å£°æ˜æ—¶çš„å¤§å°ï¼‰
   - âœ… æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

8. âœ… **æ‰©å±• `extern` å‡½æ•°å£°æ˜æ”¯æŒæŒ‡é’ˆç±»å‹å‚æ•°**ï¼ˆå·²å®Œæˆï¼Œ2026-01-13ï¼‰
   - âœ… è§£æå™¨ `parser_parse_extern_function()` ä½¿ç”¨ `parser_parse_type()` è§£æå‚æ•°ç±»å‹ï¼Œå·²æ”¯æŒ `*T` è¯­æ³•
   - âœ… ç±»å‹æ£€æŸ¥å™¨å¯¹ extern å‡½æ•° FFI æŒ‡é’ˆç±»å‹å‚æ•°çš„æ£€æŸ¥æ­£ç¡®ï¼ˆé€šè¿‡ `type_from_ast()` å’Œ `checker_check_fn_decl()`ï¼‰
   - âœ… ä»£ç ç”Ÿæˆå™¨å¯¹ extern å‡½æ•° FFI æŒ‡é’ˆç±»å‹å‚æ•°çš„æ˜ å°„æ­£ç¡®ï¼ˆFFIæŒ‡é’ˆç±»å‹æ­£ç¡®æ˜ å°„ä¸ºLLVM ptrç±»å‹ï¼‰
   - âœ… æ·»åŠ æµ‹è¯•ç”¨ä¾‹éªŒè¯å®Œæ•´çš„ extern å‡½æ•° FFI æŒ‡é’ˆå‚æ•°æµç¨‹ï¼ˆ`test_extern_ffi_pointer.uya`ï¼‰

---

## ä¼˜å…ˆçº§è¯´æ˜

- **P0ï¼ˆå¿…éœ€ï¼‰**ï¼šé˜»å¡æ€§ç‰¹æ€§ï¼Œæ²¡æœ‰è¿™äº›ç‰¹æ€§æ— æ³•é‡æ„ compiler-mini
- **P1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰**ï¼šæ˜¾è‘—æ”¹å–„ä»£ç è´¨é‡å’Œå¯è¯»æ€§
- **P2ï¼ˆå¯é€‰ï¼‰**ï¼šä¼˜åŒ–ä½“éªŒï¼Œå¯ç”¨æ›¿ä»£æ–¹æ¡ˆ

---

## é‡è¦è¯´æ˜ï¼šUya Mini ä¸å®Œæ•´ Uya çš„å…³ç³»

Uya Mini æ˜¯ Uya è¯­è¨€çš„æœ€å°å­é›†ã€‚æ‰©å±•ç‰¹æ€§æ—¶ï¼Œåº”å‚è€ƒå®Œæ•´ Uya è¯­è¨€è§„èŒƒï¼ˆ`uya_ai_prompt.md`ï¼‰ï¼Œç¡®ä¿è¯­æ³•å’Œè¯­ä¹‰ä¸€è‡´ã€‚å…³é”®åŒºåˆ«ï¼š

- **æŒ‡é’ˆç±»å‹**ï¼šå®Œæ•´ Uya ä½¿ç”¨ `&T` ä½œä¸ºæ™®é€šæŒ‡é’ˆï¼Œ`*T` ä»…ç”¨äº FFI
- **æ•°ç»„è¯­æ³•**ï¼šå®Œæ•´ Uya ä½¿ç”¨ `[T: N]` è¯­æ³•
- **sizeof**ï¼šå®Œæ•´ Uya ä¸­ `sizeof(T)` æ˜¯æ ‡å‡†åº“å‡½æ•°ï¼ˆ`use std.mem;`ï¼‰ï¼ŒUya Mini ä¸­ä½œä¸ºå†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼‰
- **æšä¸¾**ï¼šå®Œæ•´ Uya å·²æ”¯æŒæšä¸¾ï¼Œé»˜è®¤åº•å±‚ç±»å‹ `i32`

---

## P0 ä¼˜å…ˆçº§ç‰¹æ€§ï¼ˆå¿…éœ€ï¼‰

### 1. æŒ‡é’ˆç±»å‹ (`&T` å’Œ `*T`)

**çŠ¶æ€**ï¼šâœ… å·²å®ç°  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆåŒ…æ‹¬æŒ‡é’ˆè§£å¼•ç”¨è¿ç®—ç¬¦ `*expr`ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æï¼Œæœ€åæ›´æ–°ï¼š2026-01-13ï¼‰ï¼š
- âœ… `TypeKind` æšä¸¾ä¸­å·²æ·»åŠ  `TYPE_POINTER`
- âœ… `Type` ç»“æ„ä½“å·²æ‰©å±•æ”¯æŒæŒ‡é’ˆç±»å‹ï¼ˆä½¿ç”¨ unionï¼Œå­˜å‚¨æŒ‡å‘çš„ç±»å‹æŒ‡é’ˆå’Œ FFI æ ‡è®°ï¼‰
- âœ… `type_equals` å‡½æ•°å·²æ”¯æŒæŒ‡é’ˆç±»å‹æ¯”è¾ƒ
- âœ… AST èŠ‚ç‚¹ç±»å‹å·²åŒ…å« `AST_TYPE_POINTER`
- âœ… è§£æå™¨å·²å®ç°æŒ‡é’ˆç±»å‹è§£æï¼ˆ`&Type` å’Œ `*Type`ï¼‰
- âœ… ç±»å‹æ£€æŸ¥å™¨å·²å®ç°æŒ‡é’ˆç±»å‹æ£€æŸ¥ï¼ˆç±»å‹åˆ›å»ºå’Œæ¨æ–­ï¼‰
- âœ… ä»£ç ç”Ÿæˆå™¨å·²å®ç°æŒ‡é’ˆä»£ç ç”Ÿæˆ
- âœ… å–åœ°å€è¿ç®—ç¬¦ `&expr` å·²å®ç°ï¼ˆè§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨å‡æ”¯æŒï¼‰
- âœ… è§£å¼•ç”¨è¿ç®—ç¬¦ `*expr` å·²å®ç°ï¼ˆè§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨å‡æ”¯æŒï¼‰

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- `&T` - æ™®é€šæŒ‡é’ˆï¼ˆæ— lifetimeç¬¦å·ï¼‰ï¼Œ8å­—èŠ‚ï¼Œç”¨äºæ™®é€šå˜é‡å’Œå‡½æ•°å‚æ•°
- `*T` - FFI æŒ‡é’ˆç±»å‹ï¼Œä»…ç”¨äº FFI å‡½æ•°å£°æ˜/è°ƒç”¨ï¼Œä¸èƒ½ç”¨äºæ™®é€šå˜é‡å£°æ˜
- å–åœ°å€æ“ä½œç¬¦ï¼š`&expr`
- è§£å¼•ç”¨ï¼šé€šè¿‡ `.` è®¿é—®å­—æ®µï¼Œæˆ–ä½¿ç”¨ `*expr` æ“ä½œç¬¦

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-11ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ·»åŠ æŒ‡é’ˆè§£å¼•ç”¨è¿ç®—ç¬¦ `*` çš„è¯­æ³•å®šä¹‰
- âœ… è¿ç®—ç¬¦åˆ—è¡¨ã€BNF è¯­æ³•ã€è¿ç®—ç¬¦ä¼˜å…ˆçº§å‡å·²æ›´æ–°
- âœ… è¡¨è¾¾å¼è¯´æ˜ä¸­è¡¥å……äº†æŒ‡é’ˆè§£å¼•ç”¨çš„è¯¦ç»†è¯´æ˜

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç»“æ„ä½“æŒ‡é’ˆä¼ é€’ï¼ˆ`&ASTNode`, `&Arena`ï¼‰ - ä½¿ç”¨ `&T`
- æ•°ç»„æŒ‡é’ˆï¼ˆ`&[ASTNode: N]`ï¼‰ - ä½¿ç”¨ `&[T: N]`
- FFI å‡½æ•°å‚æ•°ï¼ˆ`*byte`, `*void`, `*FILE`ï¼‰ - ä½¿ç”¨ `*T`
- C æ ‡å‡†åº“å’Œ LLVM C API è°ƒç”¨ - ä½¿ç”¨ `*T`

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/ast.h` - ASTNode ç»“æ„ä½“å®šä¹‰
- `compiler-mini/src/arena.h` - Arena ç»“æ„ä½“å®šä¹‰
- `compiler-mini/src/main.c:23-29` - æ–‡ä»¶ I/Oï¼ˆFFIï¼‰
- `compiler-mini/src/codegen.c` - LLVM C API è°ƒç”¨ï¼ˆFFIï¼‰

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
// æ™®é€šæŒ‡é’ˆï¼ˆ&Tï¼‰- ç”¨äºæ™®é€šå˜é‡å’Œå‡½æ•°å‚æ•°
struct Node {
    value: i32;
}

fn process(node: &Node) i32 {
    return node.value;  // é€šè¿‡æŒ‡é’ˆè®¿é—®å­—æ®µ
}

var n: Node = Node{ value: 10 };
var p: &Node = &n;  // å–åœ°å€
var v: i32 = p.value;  // é€šè¿‡æŒ‡é’ˆè®¿é—®å­—æ®µ

// FFI æŒ‡é’ˆç±»å‹ï¼ˆ*Tï¼‰- ä»…ç”¨äº extern å‡½æ•°å£°æ˜/è°ƒç”¨
extern fn fopen(filename: *byte, mode: *byte) *FILE;
extern fn fread(buffer: *void, size: i32, count: i32, file: *FILE) i32;
extern fn strcmp(s1: *byte, s2: *byte) i32;

// LLVM C APIï¼ˆFFIï¼‰
extern fn LLVMContextCreate() *LLVMContext;
extern fn LLVMModuleCreateWithNameInContext(name: *byte, context: *LLVMContext) *LLVMModule;
```

**å®ç°è¦ç‚¹**ï¼š
- æ™®é€šæŒ‡é’ˆç±»å‹ï¼š`&Type`
- FFI æŒ‡é’ˆç±»å‹ï¼š`*Type`ï¼ˆä»…ç”¨äº extern å‡½æ•°ï¼‰
- å–åœ°å€ï¼š`&expr`
- è§£å¼•ç”¨ï¼š`.field` æˆ– `*expr`
- æŒ‡é’ˆç±»å‹æ£€æŸ¥ï¼šæŒ‡é’ˆç±»å‹å¿…é¡»åŒ¹é…
- NULL æŒ‡é’ˆå¤„ç†ï¼š`null` å¸¸é‡ï¼ˆå¦‚æœæ”¯æŒï¼‰

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- `&T` å¯¹åº”å®Œæ•´ Uya çš„æ™®é€šæŒ‡é’ˆï¼ˆæ— lifetimeç¬¦å·ï¼‰
- `*T` å¯¹åº”å®Œæ•´ Uya çš„ FFI æŒ‡é’ˆç±»å‹ï¼ˆä»…ç”¨äº FFIï¼‰

---

### 2. å›ºå®šå¤§å°æ•°ç»„ (`[T: N]`)

**çŠ¶æ€**ï¼šâœ… å·²å®ç°  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æï¼Œæœ€åæ›´æ–°ï¼š2026-01-13ï¼‰ï¼š
- âœ… `TypeKind` æšä¸¾ä¸­å·²æ·»åŠ  `TYPE_ARRAY`
- âœ… `Type` ç»“æ„ä½“å·²æ‰©å±•æ”¯æŒæ•°ç»„ç±»å‹ï¼ˆä½¿ç”¨ unionï¼Œå­˜å‚¨å…ƒç´ ç±»å‹æŒ‡é’ˆå’Œæ•°ç»„å¤§å°ï¼‰
- âœ… `type_equals` å‡½æ•°å·²æ”¯æŒæ•°ç»„ç±»å‹æ¯”è¾ƒ
- âœ… AST èŠ‚ç‚¹ç±»å‹å·²åŒ…å« `AST_TYPE_ARRAY` å’Œ `AST_ARRAY_ACCESS`
- âœ… è§£æå™¨å·²å®ç°æ•°ç»„ç±»å‹è§£æï¼ˆ`[Type: N]`ï¼‰å’Œæ•°ç»„è®¿é—®è§£æï¼ˆ`arr[index]`ï¼‰
- âœ… ç±»å‹æ£€æŸ¥å™¨å·²å®ç°æ•°ç»„ç±»å‹æ£€æŸ¥ï¼ˆç±»å‹åˆ›å»ºå’Œæ¨æ–­ï¼‰å’Œæ•°ç»„è®¿é—®ç±»å‹æ£€æŸ¥
- âœ… ä»£ç ç”Ÿæˆå™¨å·²å®ç°æ•°ç»„ç±»å‹ä»£ç ç”Ÿæˆï¼ˆç±»å‹æ˜ å°„å’Œå˜é‡å£°æ˜ï¼‰å’Œæ•°ç»„è®¿é—®ä»£ç ç”Ÿæˆ
- âœ… æ•°ç»„å­—é¢é‡æ”¯æŒï¼ˆ`[expr1, expr2, ...]`ï¼‰
- âœ… æ•°ç»„è®¿é—®è¯­æ³•ï¼ˆ`arr[index]`ï¼‰å·²å®ç°ï¼ˆAST_ARRAY_ACCESS èŠ‚ç‚¹ç±»å‹ã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆå‡æ”¯æŒï¼‰

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- æ•°ç»„è¯­æ³•ï¼š`[Type: Size]`
- Size å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡
- å¤šç»´æ•°ç»„ï¼š`[[Type: N]: M]`
- æ•°ç»„å¤§å°æŸ¥è¯¢ï¼š`sizeof(arr)` æˆ– `len(arr)`

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç¬¦å·è¡¨æ§½ä½æ•°ç»„ï¼ˆ`[&Symbol: 256]`ï¼‰
- è¯æ³•åˆ†æå™¨ç¼“å†²åŒºï¼ˆ`[i8: 1024*1024]`ï¼‰
- AST èŠ‚ç‚¹æ•°ç»„ï¼ˆ`&[ASTNode: N]`ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/checker.h:48` - SymbolTable slots[256]
- `compiler-mini/src/lexer.h:77` - Lexer buffer[1024*1024]
- `compiler-mini/src/codegen.h:25` - struct_types[64]

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
struct SymbolTable {
    slots: [&Symbol: 256];  // å›ºå®šå¤§å°æ•°ç»„ï¼Œå…ƒç´ ç±»å‹ä¸ºæŒ‡é’ˆ
    count: i32;
}

struct Lexer {
    buffer: [i8: 1024*1024];  // 1MB ç¼“å†²åŒº
    position: i32;
}

struct CodeGenerator {
    struct_types: [StructTypeMap: 64];
    var_map: [VarMap: 256];
}

// æ•°ç»„è®¿é—®
fn access_array(arr: [i32: 10], index: i32) i32 {
    if index >= 0 && index < 10 {
        return arr[index];  // æ•°ç»„è®¿é—®ï¼ˆéœ€è¦è¾¹ç•Œæ£€æŸ¥è¯æ˜ï¼‰
    }
    return 0;
}

// æ•°ç»„å¤§å°
const buffer: [i8: 1024] = [];
const size: i32 = sizeof(buffer);  // æ•°ç»„æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰
const len: i32 = len(buffer);  // æ•°ç»„å…ƒç´ ä¸ªæ•°ï¼ˆ1024ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- æ•°ç»„å£°æ˜è¯­æ³•ï¼š`[Type: Size]`
- Size å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼ˆ`const` æˆ–å­—é¢é‡ï¼‰
- æ•°ç»„è®¿é—®è¯­æ³•ï¼š`arr[index]`
- æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°ï¼šæŒ‰å€¼ä¼ é€’ï¼ˆå¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼‰æˆ–æŒ‰æŒ‡é’ˆä¼ é€’ `&[T: N]`
- æ•°ç»„å¤§å°æŸ¥è¯¢ï¼š`sizeof(arr)` è¿”å›æ•°ç»„æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œ`len(arr)` è¿”å›å…ƒç´ ä¸ªæ•°
- ç©ºæ•°ç»„å­—é¢é‡ `[]`ï¼šä»…å½“å˜é‡ç±»å‹å·²æ˜ç¡®æ—¶å¯ç”¨ï¼Œè¡¨ç¤ºæœªåˆå§‹åŒ–ï¼Œ`len` è¿”å›æ•°ç»„å£°æ˜æ—¶çš„å¤§å°

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- è¯­æ³•ä¸å®Œæ•´ Uya å®Œå…¨ä¸€è‡´ï¼š`[T: N]`
- ç©ºæ•°ç»„å­—é¢é‡ `[]` è¡¨ç¤ºæœªåˆå§‹åŒ–ï¼Œç±»å‹ä»å˜é‡å£°æ˜ä¸­è·å–

---

### 3. `len` å†…ç½®å‡½æ•°

**çŠ¶æ€**ï¼šâœ… å·²å®ç°  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆåŒ…æ‹¬ BNF è¯­æ³•å®šä¹‰ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-13ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ·»åŠ  `len_expr` çš„ BNF è¯­æ³•å®šä¹‰
- âœ… åœ¨è¡¨è¾¾å¼è¯­æ³•ä¸­æ­£ç¡®é›†æˆ `len` è¯­æ³•
- âœ… åœ¨æ•°ç»„å­—é¢é‡è¯´æ˜ä¸­æ·»åŠ äº†ç©ºæ•°ç»„å­—é¢é‡çš„è¯´æ˜

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æï¼Œæœ€åæ›´æ–°ï¼š2026-01-13ï¼‰ï¼š
- âœ… AST èŠ‚ç‚¹ç±»å‹å·²åŒ…å« `AST_LEN`
- âœ… Token å·²åŒ…å« `TOKEN_LEN`
- âœ… è§£æå™¨å·²å®ç° `len(expr)` è§£æ
- âœ… ç±»å‹æ£€æŸ¥å™¨å·²å®ç° `len` ç±»å‹æ£€æŸ¥ï¼ˆè¿”å› i32 ç±»å‹ï¼ŒéªŒè¯å‚æ•°ä¸ºæ•°ç»„ç±»å‹ï¼‰
- âœ… ä»£ç ç”Ÿæˆå™¨å·²å®ç° `len` ä»£ç ç”Ÿæˆï¼ˆä½¿ç”¨ `LLVMGetArrayLength` è·å–æ•°ç»„é•¿åº¦ï¼‰

**è§„èŒƒè¯´æ˜**ï¼š
- `len(array)` æ˜¯å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
- è¿”å›æ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼‰
- å‚æ•°å¿…é¡»æ˜¯æ•°ç»„ç±»å‹è¡¨è¾¾å¼
- å¯¹äºç©ºæ•°ç»„å­—é¢é‡ `[]`ï¼Œ`len` è¿”å›æ•°ç»„å£°æ˜æ—¶çš„å¤§å°ï¼Œè€Œä¸æ˜¯ 0

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ•°ç»„å¤§å°æŸ¥è¯¢ï¼ˆ`len(buffer)` è¿”å›å…ƒç´ ä¸ªæ•°ï¼‰
- å¾ªç¯æ¡ä»¶åˆ¤æ–­ï¼ˆ`while i < len(arr)`ï¼‰
- æ•°ç»„è¾¹ç•Œæ£€æŸ¥

**è¯­æ³•è§„èŒƒ**ï¼ˆå·²åœ¨è§„èŒƒä¸­å®šä¹‰ï¼‰ï¼š
```uya
// å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
var arr: [i32: 5] = [1, 2, 3, 4, 5];
const arr_len: i32 = len(arr);  // 5ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰

// ç©ºæ•°ç»„å­—é¢é‡
var buffer: [i32: 100] = [];
const buffer_len: i32 = len(buffer);  // 100ï¼ˆä»å£°æ˜ä¸­è·å–ï¼‰

// len ä¸ sizeof çš„åŒºåˆ«
const len_val: i32 = len(arr);      // 5ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰
const size_val: i32 = sizeof(arr);  // 20ï¼ˆå­—èŠ‚å¤§å°ï¼š5 * 4ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- `len(array)` - è·å–æ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼ˆç¼–è¯‘æ—¶è®¡ç®—ï¼‰
- å‚æ•°å¿…é¡»æ˜¯æ•°ç»„ç±»å‹è¡¨è¾¾å¼ï¼ˆ`[T: N]`ï¼‰
- è¿”å›å€¼ç±»å‹ï¼š`i32`ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰
- å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡
- å¯¹äºç©ºæ•°ç»„å­—é¢é‡ï¼Œè¿”å›æ•°ç»„å£°æ˜æ—¶çš„å¤§å°

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- å®Œæ•´ Uya ä¸­ `len` å¯èƒ½æ˜¯æ ‡å‡†åº“å‡½æ•°æˆ–å†…ç½®å‡½æ•°ï¼ˆå–å†³äºå®ç°ï¼‰
- Uya Mini ä¸­ `len` æ˜¯å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼‰ï¼Œè¿™æ˜¯ Uya Mini æœ€å°å­é›†è®¾è®¡çš„ç®€åŒ–

---

### 4. `sizeof` å†…ç½®å‡½æ•°

**çŠ¶æ€**ï¼šâœ… å·²å®ç°  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆåŒ…æ‹¬ BNF è¯­æ³•å®šä¹‰ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-11ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ·»åŠ  `sizeof_expr` çš„ BNF è¯­æ³•å®šä¹‰
- âœ… åœ¨è¡¨è¾¾å¼è¯­æ³•ä¸­æ­£ç¡®é›†æˆ `sizeof` è¯­æ³•

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æï¼Œæœ€åæ›´æ–°ï¼š2026-01-13ï¼‰ï¼š
- âœ… AST èŠ‚ç‚¹ç±»å‹å·²åŒ…å« `AST_SIZEOF`
- âœ… Token å·²åŒ…å« `TOKEN_SIZEOF`
- âœ… è§£æå™¨å·²å®ç° `sizeof(Type)` å’Œ `sizeof(expr)` è§£æ
- âœ… ç±»å‹æ£€æŸ¥å™¨å·²å®ç° `sizeof` ç±»å‹æ£€æŸ¥ï¼ˆè¿”å› i32 ç±»å‹ï¼‰
- âœ… ä»£ç ç”Ÿæˆå™¨å·²å®ç° `sizeof` ä»£ç ç”Ÿæˆï¼ˆåŸºç¡€ç±»å‹ã€æŒ‡é’ˆç±»å‹ã€æ•°ç»„ç±»å‹å¤§å°è®¡ç®—ï¼‰
- âœ… ç»“æ„ä½“ç±»å‹å¤§å°è®¡ç®—å·²å®ç°ï¼ˆä½¿ç”¨ TargetDataï¼‰

**è§„èŒƒè¯´æ˜**ï¼š
- `sizeof(T)` æ˜¯å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
- è¿”å›ç±»å‹å¤§å°ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼‰
- **è®¾è®¡å†³å®š**ï¼šUya Mini ä½œä¸ºæœ€å°å­é›†ï¼Œä¸ä¾èµ–æ¨¡å—ç³»ç»Ÿï¼Œå› æ­¤ `sizeof` ä½œä¸ºå†…ç½®å‡½æ•°è€Œéæ ‡å‡†åº“å‡½æ•°

**ä½¿ç”¨åœºæ™¯**ï¼š
- Arena åˆ†é…å™¨å†…å­˜åˆ†é…ï¼ˆ`arena_alloc(arena, sizeof(ASTNode))`ï¼‰
- æ•°ç»„å¤§å°è®¡ç®—ï¼ˆ`sizeof(&ASTNode) * capacity`ï¼‰
- ç»“æ„ä½“åˆå§‹åŒ–ï¼ˆ`memset(codegen, 0, sizeof(CodeGenerator))`ï¼‰
- ç¼“å†²åŒºå¤§å°æ£€æŸ¥

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/ast.c:14` - `arena_alloc(arena, sizeof(ASTNode))`
- `compiler-mini/src/parser.c:220` - `sizeof(ASTNode *) * new_capacity`
- `compiler-mini/src/codegen.c:18` - `memset(codegen, 0, sizeof(CodeGenerator))`

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼š
```uya
// å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
const node_size: i32 = sizeof(ASTNode);
const token_size: i32 = sizeof(Token);

// è¡¨è¾¾å¼å¤§å°æŸ¥è¯¢
var codegen: CodeGenerator = ...;
const codegen_size: i32 = sizeof(codegen);  // æˆ– sizeof(CodeGenerator)

// æ•°ç»„å¤§å°è®¡ç®—
const ptr_size: i32 = sizeof(&ASTNode);  // æŒ‡é’ˆç±»å‹å¤§å°
const array_size: i32 = sizeof(&ASTNode) * capacity;

// æ•°ç»„æ€»å¤§å°
var buffer: [i8: 1024] = [];
const buffer_size: i32 = sizeof(buffer);  // è¿”å› 1024ï¼ˆå­—èŠ‚ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- `sizeof(Type)` - è·å–ç±»å‹çš„å¤§å°ï¼ˆç¼–è¯‘æ—¶è®¡ç®—ï¼‰
- `sizeof(expr)` - è·å–è¡¨è¾¾å¼ç»“æœç±»å‹çš„å¤§å°ï¼ˆç¼–è¯‘æ—¶è®¡ç®—ï¼‰
- `sizeof(array)` - è·å–æ•´ä¸ªæ•°ç»„çš„æ€»å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
- `sizeof(&T)` - è·å–æŒ‡é’ˆç±»å‹çš„å¤§å°ï¼ˆé€šå¸¸ 8 å­—èŠ‚ï¼‰
- è¿”å›å€¼ç±»å‹ï¼š`i32`ï¼ˆå­—èŠ‚æ•°ï¼‰
- å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡
- **è®¾è®¡å†³å®š**ï¼šUya Mini ä½œä¸ºæœ€å°å­é›†ï¼Œä¸ä¾èµ–æ¨¡å—ç³»ç»Ÿï¼Œå› æ­¤ `sizeof` ä½œä¸ºå†…ç½®å‡½æ•°

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- å®Œæ•´ Uya ä¸­ `sizeof(T)` æ˜¯æ ‡å‡†åº“å‡½æ•°ï¼ˆ`use std.mem;`ï¼‰
- Uya Mini ä¸­ `sizeof(T)` æ˜¯å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼‰ï¼Œè¿™æ˜¯ Uya Mini æœ€å°å­é›†è®¾è®¡çš„ç®€åŒ–

---

### 5. `extern` å‡½æ•°æŒ‡é’ˆå‚æ•°æ”¯æŒï¼ˆæ‰©å±•ï¼‰

**çŠ¶æ€**ï¼šâœ… å·²å®ç°  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆæ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•° `*T`ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- `extern` å‡½æ•°å£°æ˜æ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°ï¼ˆ`*T`ï¼‰
- `*T` ç±»å‹ä»…ç”¨äº FFI å‡½æ•°å£°æ˜/è°ƒç”¨
- æ”¯æŒæ‰€æœ‰ C å…¼å®¹ç±»å‹ï¼š`*i8` `*i16` `*i32` `*i64` `*u8` `*u16` `*u32` `*u64` `*f32` `*f64` `*bool` `*byte` `*void` `*CStruct`

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-11ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ˜ç¡®è¯´æ˜ `extern` å‡½æ•°æ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°ï¼ˆ`*T`ï¼‰å’Œè¿”å›å€¼
- âœ… è§„èŒƒç¬¬27è¡Œï¼šå¤–éƒ¨å‡½æ•°è°ƒç”¨æ”¯æŒ `extern` å…³é”®å­—ï¼Œå…è®¸ `*T` ä½œä¸º FFI æŒ‡é’ˆå‚æ•°å’Œè¿”å›å€¼
- âœ… è§„èŒƒç¬¬240-242è¡Œï¼šå‚æ•°å’Œè¿”å›å€¼ç±»å‹æ”¯æŒåŸºç¡€ç±»å‹å’Œ FFI æŒ‡é’ˆç±»å‹ï¼ˆ`*T`ï¼‰
- âœ… æä¾›äº†è¯¦ç»†çš„ç¤ºä¾‹ä»£ç è¯´æ˜ç”¨æ³•

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æå’Œæµ‹è¯•éªŒè¯ï¼Œæœ€åæ›´æ–°ï¼š2026-01-13ï¼‰ï¼š
- âœ… è§£æå™¨ `parser_parse_type()` æ”¯æŒ `*Type` è¯­æ³•ï¼ˆFFI æŒ‡é’ˆç±»å‹ï¼‰
- âœ… `parser_parse_extern_function()` ä½¿ç”¨ `parser_parse_type()` è§£æå‚æ•°ç±»å‹ï¼Œæ”¯æŒ `*T` ç±»å‹å‚æ•°
- âœ… extern å‡½æ•°å£°æ˜å’Œè°ƒç”¨æ—¶ FFI æŒ‡é’ˆç±»å‹å‚æ•°æ­£ç¡®å·¥ä½œï¼ˆå·²éªŒè¯ï¼‰
- âœ… ç±»å‹æ£€æŸ¥å™¨å¯¹ extern å‡½æ•° FFI æŒ‡é’ˆå‚æ•°çš„æ”¯æŒæ­£ç¡®ï¼ˆé€šè¿‡ `type_from_ast()` å’Œ `checker_check_fn_decl()`ï¼‰
- âœ… ä»£ç ç”Ÿæˆå™¨å¯¹ extern å‡½æ•° FFI æŒ‡é’ˆå‚æ•°çš„æ”¯æŒæ­£ç¡®ï¼ˆFFIæŒ‡é’ˆç±»å‹æ­£ç¡®æ˜ å°„ä¸ºLLVM ptrç±»å‹ï¼‰
- âœ… æµ‹è¯•ç”¨ä¾‹éªŒè¯é€šè¿‡ï¼ˆ`test_extern_ffi_pointer.uya` æµ‹è¯•äº†å„ç§FFIæŒ‡é’ˆç±»å‹å‚æ•°å’Œè¿”å›å€¼ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- è°ƒç”¨ C æ ‡å‡†åº“å‡½æ•°ï¼ˆ`fopen`, `fread`, `strcmp` ç­‰ï¼‰
- è°ƒç”¨ LLVM C APIï¼ˆå¤§éƒ¨åˆ†å‡½æ•°éœ€è¦æŒ‡é’ˆå‚æ•°ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/main.c:23-29` - æ–‡ä»¶ I/O
- `compiler-mini/src/codegen.c` - LLVM C API è°ƒç”¨

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
// C æ ‡å‡†åº“å‡½æ•°å£°æ˜
extern fn fopen(filename: *byte, mode: *byte) *FILE;
extern fn fread(buffer: *void, size: i32, count: i32, file: *FILE) i32;
extern fn fclose(file: *FILE) i32;
extern fn strcmp(s1: *byte, s2: *byte) i32;
extern fn strlen(s: *byte) i32;
extern fn memcpy(dest: *void, src: *void, n: i32) *void;
extern fn memset(s: *void, c: i32, n: i32) *void;

// LLVM C API å‡½æ•°å£°æ˜
extern fn LLVMContextCreate() *LLVMContext;
extern fn LLVMModuleCreateWithNameInContext(name: *byte, context: *LLVMContext) *LLVMModule;
extern fn LLVMInt32Type() *LLVMType;
extern fn LLVMBuildAlloca(builder: *LLVMBuilder, ty: *LLVMType, name: *byte) *LLVMValue;
```

**å®ç°è¦ç‚¹**ï¼š
- æ‰©å±• `extern` å‡½æ•°å£°æ˜è¯­æ³•ï¼Œæ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°å’Œè¿”å›å€¼
- ç±»å‹æ˜ å°„ï¼š`*byte` â†’ `char*`, `*void` â†’ `void*`, `*i32` â†’ `int*` ç­‰
- è°ƒç”¨çº¦å®šï¼šä¸ C å…¼å®¹
- æ³¨æ„ï¼š`*T` ä»…ç”¨äº FFIï¼Œæ™®é€šå‡½æ•°å‚æ•°ä½¿ç”¨ `&T`

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- ä¸å®Œæ•´ Uya çš„ FFI è§„èŒƒå®Œå…¨ä¸€è‡´

---

## P1 ä¼˜å…ˆçº§ç‰¹æ€§ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

### 6. æšä¸¾ç±»å‹ (`enum`) âœ… å®Œæ•´ Uya å·²æ”¯æŒ

**çŠ¶æ€**ï¼šå®Œæ•´ Uya å·²æ”¯æŒï¼ŒUya Mini éœ€æ·»åŠ   
**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- æšä¸¾é»˜è®¤åº•å±‚ç±»å‹ä¸º `i32`
- æ”¯æŒæ˜¾å¼æŒ‡å®šåº•å±‚ç±»å‹ï¼ˆ`u8`, `u16`, `u32`, `i8`, `i16`, `i32`, `i64`ï¼‰
- æšä¸¾å˜ä½“å¯ä»¥æ˜¾å¼èµ‹å€¼
- æšä¸¾å€¼ä½¿ç”¨ `EnumName.Variant` è¯­æ³•
- ç±»å‹å®‰å…¨ï¼šæšä¸¾å€¼åªèƒ½ä¸ç›¸åŒæšä¸¾ç±»å‹æ¯”è¾ƒ
- ä¸ C æšä¸¾å®Œå…¨å…¼å®¹

**ä½¿ç”¨åœºæ™¯**ï¼š
- TokenType æšä¸¾ï¼ˆ`TOKEN_EOF`, `TOKEN_IDENTIFIER` ç­‰ï¼‰
- ASTNodeType æšä¸¾ï¼ˆ`AST_PROGRAM`, `AST_FN_DECL` ç­‰ï¼‰
- TypeKind æšä¸¾ï¼ˆ`TYPE_I32`, `TYPE_BOOL` ç­‰ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/lexer.h:16` - TokenType æšä¸¾
- `compiler-mini/src/ast.h:9` - ASTNodeType æšä¸¾
- `compiler-mini/src/checker.h:9` - TypeKind æšä¸¾

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
// åŸºæœ¬æšä¸¾ï¼ˆé»˜è®¤åº•å±‚ç±»å‹ i32ï¼‰
enum TokenType {
    TOKEN_EOF,
    TOKEN_IDENTIFIER,
    TOKEN_NUMBER,
    TOKEN_STRUCT,
    // ...
}

enum ASTNodeType {
    AST_PROGRAM,
    AST_FN_DECL,
    AST_STRUCT_DECL,
    // ...
}

// æ˜¾å¼èµ‹å€¼
enum TypeKind {
    TYPE_I32 = 0,
    TYPE_BOOL = 1,
    TYPE_VOID = 2,
    TYPE_STRUCT = 3
}

// ä½¿ç”¨
const token: TokenType = TokenType.TOKEN_IDENTIFIER;
const node_type: ASTNodeType = ASTNodeType.AST_PROGRAM;

fn get_token_type() TokenType {
    return TokenType.TOKEN_IDENTIFIER;
}
```

**å®ç°è¦ç‚¹**ï¼š
- æšä¸¾å€¼é»˜è®¤ä» 0 å¼€å§‹é€’å¢
- æšä¸¾å€¼å¯ä»¥æ˜¾å¼èµ‹å€¼
- ç±»å‹å®‰å…¨ï¼šæšä¸¾ç±»å‹ä¸èƒ½éšå¼è½¬æ¢ä¸ºæ•´æ•°ï¼ˆæˆ–åœ¨éœ€è¦æ—¶æ”¯æŒè½¬æ¢ï¼‰
- å¯ä»¥ä¸æ•´æ•°æ¯”è¾ƒï¼ˆå¦‚æœéœ€è¦ C å…¼å®¹æ€§ï¼‰
- åº•å±‚è¡¨ç¤ºï¼š`i32`ï¼ˆé»˜è®¤ï¼‰æˆ–æŒ‡å®šçš„åº•å±‚ç±»å‹

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- è¯­æ³•ä¸å®Œæ•´ Uya å®Œå…¨ä¸€è‡´

---

### 7. å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆæœ‰é™æ”¯æŒï¼‰

**çŠ¶æ€**ï¼šâœ… å·²å®ç°  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆä½œä¸º FFI å‡½æ•°å‚æ•°ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰
**å®ç°æ—¥æœŸ**ï¼š2026-01-13

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-11ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ˜ç¡®å­—ç¬¦ä¸²å­—é¢é‡çš„æ”¯æŒèŒƒå›´
- âœ… æ·»åŠ äº†å­—ç¬¦ä¸²å­—é¢é‡çš„è¯æ³•è§„åˆ™å®šä¹‰ï¼ˆ3.4 èŠ‚ï¼‰
- âœ… åœ¨è¡¨è¾¾å¼è¯­æ³•ä¸­æ·»åŠ äº†å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆ`STRING`ï¼‰
- âœ… æ·»åŠ äº†è¯¦ç»†çš„è¯´æ˜å’Œç¤ºä¾‹

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ï¼š`*byte`ï¼ˆFFI æŒ‡é’ˆç±»å‹ï¼‰
- å­—ç¬¦ä¸²å­—é¢é‡å­˜å‚¨ï¼šç¼–è¯‘å™¨åœ¨åªè¯»æ•°æ®æ®µä¸­å­˜å‚¨ï¼ˆnull ç»ˆæ­¢ï¼‰
- ä»…å¯ä½œä¸º `extern` å‡½æ•°å‚æ•°ä½¿ç”¨ï¼ˆä¸èƒ½èµ‹å€¼ç»™å˜é‡ã€ä¸èƒ½ç”¨äºæ™®é€šè¡¨è¾¾å¼ï¼‰
- ä¸æä¾›å†…ç½®å­—ç¬¦ä¸²æ“ä½œï¼Œéœ€è¦é€šè¿‡ `extern` è°ƒç”¨ C å‡½æ•°ï¼ˆå¦‚ `strcmp`ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- å­—ç¬¦ä¸²æ¯”è¾ƒï¼ˆ`strcmp("i32", type_name)`ï¼‰
- é”™è¯¯æ¶ˆæ¯
- æ ‡è¯†ç¬¦å­—ç¬¦ä¸²å­˜å‚¨

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/codegen.c:112-116` - å­—ç¬¦ä¸²æ¯”è¾ƒ

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
extern fn strcmp(s1: *byte, s2: *byte) i32;

// å­—ç¬¦ä¸²å­—é¢é‡ä½œä¸º FFI å‡½æ•°å‚æ•°
fn compare_string(s: *byte) bool {
    return strcmp(s, "i32") == 0;  // å­—ç¬¦ä¸²å­—é¢é‡ "i32" ç±»å‹ä¸º *byte
}

// å­—ç¬¦ä¸²å­—é¢é‡ç”¨äºæ¯”è¾ƒ
// æ³¨æ„ï¼šå­—ç¬¦ä¸²å­—é¢é‡ä¸èƒ½ç›´æ¥èµ‹å€¼ç»™å˜é‡ï¼ˆä»…ç”¨äº FFI å‡½æ•°å‚æ•°ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ï¼š`*byte`ï¼ˆFFI æŒ‡é’ˆç±»å‹ï¼‰
- å­—ç¬¦ä¸²å­—é¢é‡å­˜å‚¨ï¼šç¼–è¯‘å™¨åœ¨åªè¯»æ•°æ®æ®µä¸­å­˜å‚¨ï¼ˆåˆ›å»ºå…¨å±€å¸¸é‡å˜é‡ï¼‰
- å­—ç¬¦ä¸²æ¯”è¾ƒï¼šéœ€è¦é€šè¿‡ `extern` å‡½æ•°ï¼ˆå¦‚ `strcmp`ï¼‰
- æ³¨æ„ï¼šUya Mini ä¸æä¾›å†…ç½®å­—ç¬¦ä¸²æ“ä½œï¼Œéœ€è¦é€šè¿‡ `extern` è°ƒç”¨ C å‡½æ•°

**å®ç°ç»†èŠ‚**ï¼ˆ2026-01-13ï¼‰ï¼š
- âœ… è¯æ³•åˆ†æå™¨ï¼šå·²æ”¯æŒå­—ç¬¦ä¸²å­—é¢é‡è§£æï¼ˆ`TOKEN_STRING`ï¼‰
- âœ… è¯­æ³•åˆ†æå™¨ï¼šå·²æ”¯æŒå­—ç¬¦ä¸²å­—é¢é‡è¡¨è¾¾å¼è§£æï¼ˆ`AST_STRING`ï¼‰
- âœ… ç±»å‹æ£€æŸ¥å™¨ï¼šå­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ä¸º `*byte`
- âœ… ä»£ç ç”Ÿæˆå™¨ï¼šåˆ›å»ºå…¨å±€å¸¸é‡å˜é‡ï¼Œä½¿ç”¨ `LLVMAddGlobal` å’Œ `LLVMSetGlobalConstant`
- âœ… æµ‹è¯•ï¼š`test_string_literal.uya` æµ‹è¯•é€šè¿‡

**å®ç°æ–‡ä»¶**ï¼š
- `compiler-mini/src/lexer.c` - å­—ç¬¦ä¸²å­—é¢é‡è¯æ³•åˆ†æ
- `compiler-mini/src/parser.c` - å­—ç¬¦ä¸²å­—é¢é‡è¯­æ³•åˆ†æ
- `compiler-mini/src/codegen.c` - å­—ç¬¦ä¸²å­—é¢é‡ä»£ç ç”Ÿæˆï¼ˆAST_STRING å¤„ç†ï¼‰
- `compiler-mini/src/codegen.h` - æ·»åŠ  `string_literal_counter` å­—æ®µ
- `compiler-mini/tests/programs/test_string_literal.uya` - æµ‹è¯•ç”¨ä¾‹

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- ä¸å®Œæ•´ Uya çš„å­—ç¬¦ä¸²å­—é¢é‡è§„åˆ™ä¸€è‡´ï¼ˆä»…ç”¨äº FFIï¼‰

---

## P2 ä¼˜å…ˆçº§ç‰¹æ€§ï¼ˆå¯é€‰ï¼‰

### 8. è”åˆä½“ (`union`) - å¯é€‰

**çŠ¶æ€**ï¼šæœªå®ç°  
**ä¼˜å…ˆçº§**ï¼šP2ï¼ˆå¯é€‰ï¼‰

**è§„èŒƒè¯´æ˜**ï¼š
- å®Œæ•´ Uya è§„èŒƒä¸­æœªæ˜ç¡®æåˆ° union
- å¯ä»¥ç”¨ç»“æ„ä½“ + ç±»å‹æ ‡ç­¾ï¼ˆtagged unionï¼‰æ›¿ä»£

**ä½¿ç”¨åœºæ™¯**ï¼š
- ASTNode çš„ union è®¾è®¡ï¼ˆèŠ‚çœå†…å­˜ï¼Œå½“å‰ä½¿ç”¨ union å­˜å‚¨ä¸åŒç±»å‹èŠ‚ç‚¹æ•°æ®ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/ast.h:45-159` - ASTNode ä½¿ç”¨ union

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ç»“æ„ä½“ + ç±»å‹æ ‡ç­¾ï¼ˆtagged unionï¼‰ï¼Œä½†å ç”¨æ›´å¤šç©ºé—´ï¼š
```uya
struct ASTNode {
    node_type: ASTNodeType;
    data: ASTNodeData;  // åŒ…å«æ‰€æœ‰å¯èƒ½çš„å­—æ®µï¼ˆæµªè´¹ç©ºé—´ä½†å¯è¡Œï¼‰
}
```

**å®ç°å»ºè®®**ï¼š
- å¦‚æœ Uya Mini éœ€è¦ä¸¥æ ¼çš„æœ€å°åŒ–ï¼Œå¯ä»¥ä¸å®ç° union
- ä½¿ç”¨ tagged union æ›¿ä»£æ–¹æ¡ˆï¼ˆç»“æ„ä½“ + ç±»å‹æ ‡ç­¾ï¼‰

---

## å®ç°è·¯çº¿å›¾

### é˜¶æ®µ1ï¼šæ ¸å¿ƒç‰¹æ€§ï¼ˆP0ï¼‰

**å®ç°é¡ºåº**ï¼ˆå¿…é¡»æŒ‰ç…§ä¾èµ–å…³ç³»é¡ºåºå®ç°ï¼‰ï¼š

#### æ­¥éª¤1ï¼šæ‰©å±• AST èŠ‚ç‚¹ç±»å‹ï¼ˆé˜»å¡æ€§ï¼Œå¿…é¡»å…ˆå®Œæˆï¼‰

**ç›®æ ‡**ï¼šæ·»åŠ æŒ‡é’ˆå’Œæ•°ç»„ç±»å‹çš„ AST èŠ‚ç‚¹ç±»å‹æ”¯æŒ

**ä»»åŠ¡æ¸…å•**ï¼š
1. åœ¨ `src/ast.h` ä¸­çš„ `ASTNodeType` æšä¸¾æ·»åŠ ï¼š
   - `AST_TYPE_POINTER` - æŒ‡é’ˆç±»å‹èŠ‚ç‚¹ï¼ˆ`&T` æˆ– `*T`ï¼‰
   - `AST_TYPE_ARRAY` - æ•°ç»„ç±»å‹èŠ‚ç‚¹ï¼ˆ`[T: N]`ï¼‰
2. åœ¨ `src/ast.h` ä¸­çš„ union ç»“æ„ä½“æ·»åŠ æ•°æ®å­—æ®µï¼š
   - `type_pointer` ç»“æ„ä½“ï¼šåŒ…å« `pointed_type`ï¼ˆæŒ‡å‘çš„ç±»å‹èŠ‚ç‚¹ï¼‰å’Œ `is_ffi_pointer`ï¼ˆæ˜¯å¦ä¸º FFI æŒ‡é’ˆï¼‰
   - `type_array` ç»“æ„ä½“ï¼šåŒ…å« `element_type`ï¼ˆå…ƒç´ ç±»å‹èŠ‚ç‚¹ï¼‰å’Œ `size_expr`ï¼ˆæ•°ç»„å¤§å°è¡¨è¾¾å¼èŠ‚ç‚¹ï¼Œåç»­éœ€è¦è§£æä¸ºç¼–è¯‘æœŸå¸¸é‡ï¼‰
3. åœ¨ `src/ast.c` ä¸­æ‰©å±• `ast_new_node()` å‡½æ•°ï¼š
   - æ·»åŠ  `AST_TYPE_POINTER` å’Œ `AST_TYPE_ARRAY` çš„ case å¤„ç†
   - åˆå§‹åŒ–æ–°èŠ‚ç‚¹ç±»å‹çš„æ•°æ®å­—æ®µ

**éªŒè¯æ–¹æ³•**ï¼š
- åˆ›å»ºå•å…ƒæµ‹è¯•éªŒè¯æ–°èŠ‚ç‚¹ç±»å‹å¯ä»¥æ­£ç¡®åˆ›å»º
- éªŒè¯èŠ‚ç‚¹æ•°æ®å­—æ®µå¯ä»¥æ­£ç¡®è®¿é—®

**å‚è€ƒä»£ç **ï¼š
- `src/ast.h:35` - ç°æœ‰çš„ `AST_TYPE_NAMED` èŠ‚ç‚¹ç±»å‹å®šä¹‰
- `src/ast.h:140-145` - ç°æœ‰çš„ `type_named` æ•°æ®å­—æ®µå®šä¹‰
- `src/ast.c:105` - ç°æœ‰çš„èŠ‚ç‚¹åˆ›å»ºé€»è¾‘

---

#### æ­¥éª¤2ï¼šæ‰©å±•è§£æå™¨æ”¯æŒç±»å‹è¯­æ³•ï¼ˆä¾èµ–æ­¥éª¤1ï¼‰

**ç›®æ ‡**ï¼šè§£æå™¨èƒ½å¤Ÿè§£ææŒ‡é’ˆç±»å‹å’Œæ•°ç»„ç±»å‹çš„è¯­æ³•

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ‰©å±• `src/parser.c` ä¸­çš„ `parser_parse_type()` å‡½æ•°ï¼š
   - æ£€æµ‹ `&` ç¬¦å·ï¼ˆ`TOKEN_AMPERSAND`ï¼‰ï¼Œè§£ææ™®é€šæŒ‡é’ˆç±»å‹ `&Type`
   - æ£€æµ‹ `*` ç¬¦å·ï¼ˆ`TOKEN_ASTERISK`ï¼‰ï¼Œè§£æ FFI æŒ‡é’ˆç±»å‹ `*Type`ï¼ˆä»…åœ¨ extern å‡½æ•°ä¸Šä¸‹æ–‡ä¸­å…è®¸ï¼‰
   - æ£€æµ‹ `[` ç¬¦å·ï¼ˆ`TOKEN_LEFT_BRACKET`ï¼‰ï¼Œè§£ææ•°ç»„ç±»å‹ `[Type: Size]`
   - é€’å½’è°ƒç”¨ `parser_parse_type()` è§£æå†…éƒ¨ç±»å‹ï¼ˆæ”¯æŒåµŒå¥—ï¼‰
   - å¯¹äºæ•°ç»„ç±»å‹ï¼Œè§£æå¤§å°è¡¨è¾¾å¼ï¼ˆå¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼‰
2. æ›´æ–° `parser_parse_function()` å‡½æ•°ï¼š
   - åœ¨ extern å‡½æ•°è§£æä¸Šä¸‹æ–‡ä¸­ï¼Œå…è®¸ `*Type` è¯­æ³•
   - åœ¨æ™®é€šå‡½æ•°è§£æä¸Šä¸‹æ–‡ä¸­ï¼Œåªå…è®¸ `&Type` è¯­æ³•
3. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š
   - æŒ‡é’ˆç±»å‹è§£ææµ‹è¯•ï¼ˆ`&i32`, `*byte`, `&Node`ï¼‰
   - æ•°ç»„ç±»å‹è§£ææµ‹è¯•ï¼ˆ`[i32: 10]`, `[&Node: 256]`ï¼‰
   - åµŒå¥—ç±»å‹è§£ææµ‹è¯•ï¼ˆ`&[i32: 10]`, `[&Node: 256]`ï¼‰

**éªŒè¯æ–¹æ³•**ï¼š
- æ·»åŠ è§£æå™¨æµ‹è¯•ç”¨ä¾‹éªŒè¯æ–°è¯­æ³•å¯ä»¥æ­£ç¡®è§£æ
- éªŒè¯ç”Ÿæˆçš„ AST èŠ‚ç‚¹ç±»å‹å’Œæ•°æ®å­—æ®µæ­£ç¡®

**å‚è€ƒä»£ç **ï¼š
- `src/parser.c:129-161` - ç°æœ‰çš„ `parser_parse_type()` å‡½æ•°
- `src/parser.c:592-668` - ç°æœ‰çš„å‡½æ•°å‚æ•°è§£æé€»è¾‘

**æ³¨æ„**ï¼š
- æ•°ç»„å¤§å°å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼Œéœ€è¦åœ¨è§£ææ—¶éªŒè¯ï¼ˆæˆ–å»¶è¿Ÿåˆ°ç±»å‹æ£€æŸ¥é˜¶æ®µéªŒè¯ï¼‰
- FFI æŒ‡é’ˆç±»å‹ `*T` ä»…ç”¨äº extern å‡½æ•°å£°æ˜ï¼Œæ™®é€šå‡½æ•°å‚æ•°ä½¿ç”¨ `&T`

---

#### æ­¥éª¤3ï¼šæ‰©å±•ç±»å‹æ£€æŸ¥å™¨ï¼ˆä¾èµ–æ­¥éª¤1ã€2ï¼‰

**ç›®æ ‡**ï¼šç±»å‹æ£€æŸ¥å™¨èƒ½å¤Ÿå¤„ç†æŒ‡é’ˆå’Œæ•°ç»„ç±»å‹çš„ç±»å‹æ£€æŸ¥å’Œæ¨æ–­

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ‰©å±• `src/checker.c` ä¸­çš„ `type_from_ast()` å‡½æ•°ï¼š
   - æ·»åŠ  `AST_TYPE_POINTER` èŠ‚ç‚¹å¤„ç†ï¼š
     - é€’å½’è°ƒç”¨ `type_from_ast()` è§£ææŒ‡å‘çš„ç±»å‹
     - åˆ›å»º `TYPE_POINTER` ç±»å‹çš„ Type ç»“æ„ä½“
     - è®¾ç½® `is_ffi_pointer` æ ‡å¿—ï¼ˆä» AST èŠ‚ç‚¹è·å–ï¼‰
   - æ·»åŠ  `AST_TYPE_ARRAY` èŠ‚ç‚¹å¤„ç†ï¼š
     - é€’å½’è°ƒç”¨ `type_from_ast()` è§£æå…ƒç´ ç±»å‹
     - è§£ææ•°ç»„å¤§å°ï¼ˆå¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼‰
     - åˆ›å»º `TYPE_ARRAY` ç±»å‹çš„ Type ç»“æ„ä½“
2. æ‰©å±• `checker_infer_type()` å‡½æ•°ï¼š
   - æ·»åŠ å–åœ°å€è¡¨è¾¾å¼ï¼ˆ`&expr`ï¼‰çš„ç±»å‹æ¨æ–­ï¼šè¿”å›æŒ‡å‘è¡¨è¾¾å¼ç±»å‹çš„æŒ‡é’ˆç±»å‹
   - æ·»åŠ è§£å¼•ç”¨è¡¨è¾¾å¼ï¼ˆ`*expr`ï¼‰çš„ç±»å‹æ¨æ–­ï¼šè¿”å›æŒ‡é’ˆæŒ‡å‘çš„ç±»å‹
   - æ·»åŠ æ•°ç»„è®¿é—®è¡¨è¾¾å¼ï¼ˆ`arr[index]`ï¼‰çš„ç±»å‹æ¨æ–­ï¼šè¿”å›æ•°ç»„å…ƒç´ ç±»å‹
3. æ·»åŠ ç±»å‹æ£€æŸ¥è§„åˆ™ï¼š
   - FFI æŒ‡é’ˆç±»å‹ `*T` ä»…ç”¨äº extern å‡½æ•°å£°æ˜å’Œè°ƒç”¨ï¼Œä¸èƒ½åœ¨æ™®é€šå˜é‡å£°æ˜ä¸­ä½¿ç”¨
   - æ•°ç»„å¤§å°å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼ˆæ­£æ•´æ•°ï¼‰
   - æŒ‡é’ˆç±»å‹åŒ¹é…è§„åˆ™ï¼ˆæ™®é€šæŒ‡é’ˆå’Œ FFI æŒ‡é’ˆä¸èƒ½æ··ç”¨ï¼‰
4. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š
   - æŒ‡é’ˆç±»å‹æ£€æŸ¥æµ‹è¯•
   - æ•°ç»„ç±»å‹æ£€æŸ¥æµ‹è¯•
   - å–åœ°å€å’Œè§£å¼•ç”¨ç±»å‹æ£€æŸ¥æµ‹è¯•

**éªŒè¯æ–¹æ³•**ï¼š
- æ·»åŠ ç±»å‹æ£€æŸ¥å™¨æµ‹è¯•ç”¨ä¾‹éªŒè¯ç±»å‹æ£€æŸ¥å’Œæ¨æ–­æ­£ç¡®
- éªŒè¯é”™è¯¯æƒ…å†µèƒ½å¤Ÿæ­£ç¡®æŠ¥å‘Šé”™è¯¯

**å‚è€ƒä»£ç **ï¼š
- `src/checker.c:295-327` - ç°æœ‰çš„ `type_from_ast()` å‡½æ•°
- `src/checker.c:333-450` - ç°æœ‰çš„ `checker_infer_type()` å‡½æ•°
- `src/checker.c:260-271` - ç°æœ‰çš„æŒ‡é’ˆç±»å‹æ¯”è¾ƒé€»è¾‘ï¼ˆå¯ä»¥å‚è€ƒï¼‰

---

#### æ­¥éª¤4ï¼šå®ç°å–åœ°å€å’Œè§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆä¾èµ–æ­¥éª¤1ã€2ã€3ï¼‰

**ç›®æ ‡**ï¼šæ”¯æŒ `&expr` å–åœ°å€å’Œ `*expr` è§£å¼•ç”¨è¡¨è¾¾å¼

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ‰©å±• `src/parser.c` ä¸­çš„ `parser_parse_unary_expr()` å‡½æ•°ï¼š
   - æ£€æµ‹ `TOKEN_AMPERSAND`ï¼Œè§£æå–åœ°å€è¡¨è¾¾å¼ `&expr`
   - æ£€æµ‹ `TOKEN_ASTERISK`ï¼Œè§£æè§£å¼•ç”¨è¡¨è¾¾å¼ `*expr`
   - åˆ›å»º `AST_UNARY_EXPR` èŠ‚ç‚¹ï¼Œè®¾ç½®è¿ç®—ç¬¦ç±»å‹
2. æ‰©å±• `src/checker.c` ä¸­çš„ç±»å‹æ£€æŸ¥ï¼š
   - å–åœ°å€è¡¨è¾¾å¼ï¼šæ“ä½œæ•°å¿…é¡»æ˜¯å·¦å€¼ï¼Œè¿”å›æŒ‡å‘æ“ä½œæ•°ç±»å‹çš„æŒ‡é’ˆç±»å‹
   - è§£å¼•ç”¨è¡¨è¾¾å¼ï¼šæ“ä½œæ•°å¿…é¡»æ˜¯æŒ‡é’ˆç±»å‹ï¼Œè¿”å›æŒ‡é’ˆæŒ‡å‘çš„ç±»å‹
3. æ‰©å±• `src/codegen.c` ä¸­çš„ä»£ç ç”Ÿæˆï¼š
   - å–åœ°å€è¡¨è¾¾å¼ï¼šä½¿ç”¨ `LLVMBuildGEP2` è·å–å€¼çš„åœ°å€
   - è§£å¼•ç”¨è¡¨è¾¾å¼ï¼šä½¿ç”¨ `LLVMBuildLoad2` åŠ è½½æŒ‡é’ˆæŒ‡å‘çš„å€¼
4. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š
   - å–åœ°å€å’Œè§£å¼•ç”¨è¡¨è¾¾å¼è§£ææµ‹è¯•
   - å–åœ°å€å’Œè§£å¼•ç”¨ç±»å‹æ£€æŸ¥æµ‹è¯•
   - å–åœ°å€å’Œè§£å¼•ç”¨ä»£ç ç”Ÿæˆæµ‹è¯•

**éªŒè¯æ–¹æ³•**ï¼š
- æ·»åŠ è§£æå™¨æµ‹è¯•ç”¨ä¾‹
- æ·»åŠ ç±»å‹æ£€æŸ¥å™¨æµ‹è¯•ç”¨ä¾‹
- åˆ›å»º Uya æµ‹è¯•ç¨‹åºéªŒè¯ä»£ç ç”Ÿæˆæ­£ç¡®

**å‚è€ƒä»£ç **ï¼š
- `src/parser.c:855-880` - ç°æœ‰çš„ `parser_parse_unary_expr()` å‡½æ•°ï¼ˆæ”¯æŒ `!` å’Œ `-`ï¼‰
- `src/codegen.c:200-250` - ç°æœ‰çš„ä¸€å…ƒè¡¨è¾¾å¼ä»£ç ç”Ÿæˆé€»è¾‘
- `src/codegen.c:1100-1150` - ç°æœ‰çš„å­—æ®µè®¿é—®ä»£ç ç”Ÿæˆï¼ˆä½¿ç”¨ GEPï¼Œå¯ä»¥å‚è€ƒï¼‰

---

#### æ­¥éª¤5ï¼šæ‰©å±•ä»£ç ç”Ÿæˆå™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹ï¼ˆä¾èµ–æ­¥éª¤1ã€2ã€3ï¼‰

**ç›®æ ‡**ï¼šä»£ç ç”Ÿæˆå™¨èƒ½å¤Ÿç”ŸæˆæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹çš„ LLVM IR

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ‰©å±• `src/codegen.c` ä¸­çš„ç±»å‹æ˜ å°„å‡½æ•°ï¼š
   - æ‰©å±• `get_llvm_type_from_ast()` æˆ–åˆ›å»ºæ–°å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹ï¼š
     - æŒ‡é’ˆç±»å‹ï¼šä½¿ç”¨ `LLVMPointerType()` åˆ›å»ºæŒ‡é’ˆç±»å‹ï¼ˆæ™®é€šæŒ‡é’ˆå’Œ FFI æŒ‡é’ˆéƒ½æ˜ å°„ä¸º LLVM æŒ‡é’ˆç±»å‹ï¼‰
     - æ•°ç»„ç±»å‹ï¼šä½¿ç”¨ `LLVMArrayType()` åˆ›å»ºæ•°ç»„ç±»å‹
   - æ”¯æŒåµŒå¥—ç±»å‹ï¼ˆæŒ‡é’ˆæŒ‡å‘æ•°ç»„ã€æ•°ç»„å…ƒç´ ä¸ºæŒ‡é’ˆç­‰ï¼‰
2. å®ç°æ•°ç»„è®¿é—®ä»£ç ç”Ÿæˆï¼š
   - æ‰©å±• `codegen_gen_expr()` å‡½æ•°æ”¯æŒæ•°ç»„è®¿é—®è¡¨è¾¾å¼ï¼ˆ`arr[index]`ï¼‰
   - ä½¿ç”¨ `LLVMBuildGEP2` è·å–æ•°ç»„å…ƒç´ åœ°å€
   - ä½¿ç”¨ `LLVMBuildLoad2` åŠ è½½æ•°ç»„å…ƒç´ å€¼
3. å®ç°æ•°ç»„å˜é‡å£°æ˜ä»£ç ç”Ÿæˆï¼š
   - æ‰©å±• `codegen_gen_stmt()` å‡½æ•°æ”¯æŒæ•°ç»„å˜é‡å£°æ˜
   - ä½¿ç”¨ `LLVMBuildAlloca` åˆ†é…æ•°ç»„æ ˆç©ºé—´
4. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š
   - æŒ‡é’ˆç±»å‹ä»£ç ç”Ÿæˆæµ‹è¯•
   - æ•°ç»„ç±»å‹ä»£ç ç”Ÿæˆæµ‹è¯•
   - æ•°ç»„è®¿é—®ä»£ç ç”Ÿæˆæµ‹è¯•

**éªŒè¯æ–¹æ³•**ï¼š
- æ·»åŠ ä»£ç ç”Ÿæˆå™¨æµ‹è¯•ç”¨ä¾‹
- åˆ›å»º Uya æµ‹è¯•ç¨‹åºéªŒè¯ç”Ÿæˆçš„ä»£ç æ­£ç¡®

**å‚è€ƒä»£ç **ï¼š
- `src/codegen.c:101-122` - ç°æœ‰çš„ `get_llvm_type_from_ast()` å‡½æ•°
- `src/codegen.c:200-400` - ç°æœ‰çš„è¡¨è¾¾å¼ä»£ç ç”Ÿæˆé€»è¾‘
- `src/codegen.c:1100-1200` - ç°æœ‰çš„å­—æ®µè®¿é—®ä»£ç ç”Ÿæˆï¼ˆä½¿ç”¨ GEPï¼Œå¯ä»¥å‚è€ƒï¼‰

---

#### æ­¥éª¤6ï¼šå®ç° `sizeof` å†…ç½®å‡½æ•°ï¼ˆä¾èµ–æ­¥éª¤1ã€2ã€3ï¼‰

**ç›®æ ‡**ï¼šæ”¯æŒ `sizeof(Type)` å’Œ `sizeof(expr)` å†…ç½®å‡½æ•°

**ä»»åŠ¡æ¸…å•**ï¼š
1. åœ¨ `src/ast.h` ä¸­æ·»åŠ  `AST_SIZEOF` èŠ‚ç‚¹ç±»å‹ï¼š
   - æ·»åŠ  `sizeof_expr` æ•°æ®å­—æ®µï¼šåŒ…å« `target`ï¼ˆç±»å‹èŠ‚ç‚¹æˆ–è¡¨è¾¾å¼èŠ‚ç‚¹ï¼‰å’Œ `is_type`ï¼ˆæ˜¯å¦ä¸ºç›®æ ‡ç±»å‹ï¼‰
2. æ‰©å±• `src/parser.c` ä¸­çš„è§£æï¼š
   - åœ¨ `parser_parse_primary_expr()` æˆ–åˆ›å»ºæ–°å‡½æ•°æ£€æµ‹ `sizeof` å…³é”®å­—
   - è§£æ `sizeof(Type)` æˆ– `sizeof(expr)` è¯­æ³•
   - åˆ›å»º `AST_SIZEOF` èŠ‚ç‚¹
3. æ‰©å±• `src/checker.c` ä¸­çš„ç±»å‹æ£€æŸ¥ï¼š
   - `sizeof` è¡¨è¾¾å¼è¿”å› `i32` ç±»å‹ï¼ˆå­—èŠ‚æ•°ï¼‰
   - éªŒè¯ç›®æ ‡ç±»å‹æˆ–è¡¨è¾¾å¼æœ‰æ•ˆ
4. æ‰©å±• `src/codegen.c` ä¸­çš„ä»£ç ç”Ÿæˆï¼š
   - ä½¿ç”¨ `LLVMABISizeOfType()` è·å–ç±»å‹å¤§å°ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼‰
   - ç”Ÿæˆ i32 å¸¸é‡å€¼
5. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š
   - `sizeof` è¡¨è¾¾å¼è§£ææµ‹è¯•
   - `sizeof` ç±»å‹æ£€æŸ¥æµ‹è¯•
   - `sizeof` ä»£ç ç”Ÿæˆæµ‹è¯•

**éªŒè¯æ–¹æ³•**ï¼š
- æ·»åŠ è§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨å’Œä»£ç ç”Ÿæˆå™¨æµ‹è¯•ç”¨ä¾‹
- åˆ›å»º Uya æµ‹è¯•ç¨‹åºéªŒè¯ `sizeof` è¿”å›å€¼æ­£ç¡®

**å‚è€ƒä»£ç **ï¼š
- `src/ast.h:35` - ç°æœ‰çš„ç±»å‹èŠ‚ç‚¹å®šä¹‰
- `src/parser.c:700-800` - ç°æœ‰çš„åŸºç¡€è¡¨è¾¾å¼è§£æé€»è¾‘
- LLVM C API æ–‡æ¡£ï¼š`LLVMABISizeOfType()`

---

#### æ­¥éª¤7ï¼šæ‰©å±• `extern` å‡½æ•°å£°æ˜æ”¯æŒæŒ‡é’ˆç±»å‹å‚æ•°ï¼ˆä¾èµ–æ­¥éª¤1ã€2ã€3ï¼‰

**ç›®æ ‡**ï¼šextern å‡½æ•°å£°æ˜æ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°å’Œè¿”å›å€¼

**ä»»åŠ¡æ¸…å•**ï¼š
1. æ‰©å±• `src/parser.c` ä¸­çš„ extern å‡½æ•°è§£æï¼š
   - åœ¨ `parser_parse_function()` ä¸­çš„ extern å‡½æ•°è§£æè·¯å¾„ï¼Œå…è®¸ `*Type` è¯­æ³•
   - éªŒè¯æ™®é€šå‡½æ•°ï¼ˆé externï¼‰ä¸èƒ½ä½¿ç”¨ `*Type` è¯­æ³•
2. æ‰©å±• `src/checker.c` ä¸­çš„ç±»å‹æ£€æŸ¥ï¼š
   - extern å‡½æ•°å‚æ•°å’Œè¿”å›å€¼å¯ä»¥æ˜¯ FFI æŒ‡é’ˆç±»å‹ `*T`
   - éªŒè¯ FFI æŒ‡é’ˆç±»å‹ä»…ç”¨äº extern å‡½æ•°
3. æ‰©å±• `src/codegen.c` ä¸­çš„ä»£ç ç”Ÿæˆï¼š
   - FFI æŒ‡é’ˆç±»å‹æ˜ å°„åˆ° LLVM æŒ‡é’ˆç±»å‹ï¼ˆä¸æ™®é€šæŒ‡é’ˆç›¸åŒï¼‰
   - extern å‡½æ•°è°ƒç”¨ä½¿ç”¨æ­£ç¡®çš„è°ƒç”¨çº¦å®š
4. æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼š
   - extern å‡½æ•°æŒ‡é’ˆå‚æ•°è§£ææµ‹è¯•
   - extern å‡½æ•°æŒ‡é’ˆå‚æ•°ç±»å‹æ£€æŸ¥æµ‹è¯•
   - extern å‡½æ•°æŒ‡é’ˆå‚æ•°ä»£ç ç”Ÿæˆæµ‹è¯•

**éªŒè¯æ–¹æ³•**ï¼š
- æ·»åŠ è§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨å’Œä»£ç ç”Ÿæˆå™¨æµ‹è¯•ç”¨ä¾‹
- åˆ›å»º Uya æµ‹è¯•ç¨‹åºéªŒè¯ extern å‡½æ•°è°ƒç”¨æ­£ç¡®

**å‚è€ƒä»£ç **ï¼š
- `src/parser.c:450-550` - ç°æœ‰çš„å‡½æ•°è§£æé€»è¾‘
- `src/checker.c:450-550` - ç°æœ‰çš„å‡½æ•°ç±»å‹æ£€æŸ¥é€»è¾‘
- `src/codegen.c:450-550` - ç°æœ‰çš„å‡½æ•°ä»£ç ç”Ÿæˆé€»è¾‘

---

### é˜¶æ®µ2ï¼šå¢å¼ºç‰¹æ€§ï¼ˆP1ï¼‰

5. **å®ç°æšä¸¾ç±»å‹** (`enum`)
   - è¯­æ³•åˆ†æå™¨æ‰©å±•
   - ç±»å‹æ£€æŸ¥å™¨æ‰©å±•
   - ä»£ç ç”Ÿæˆå™¨æ‰©å±•

6. **å¢å¼ºå­—ç¬¦ä¸²å­—é¢é‡æ”¯æŒ**
   - ç¡®ä¿å­—ç¬¦ä¸²å­—é¢é‡å¯ä»¥ä½œä¸º FFI å‡½æ•°å‚æ•°
   - å­—ç¬¦ä¸²å­—é¢é‡çš„å­˜å‚¨å’Œç±»å‹

### é˜¶æ®µ3ï¼šä¼˜åŒ–ç‰¹æ€§ï¼ˆP2ï¼‰

7. **å®ç°è”åˆä½“** (`union`)ï¼ˆå¯é€‰ï¼‰
   - æˆ–ä½¿ç”¨ tagged union æ›¿ä»£æ–¹æ¡ˆ

---

## å‚è€ƒæ–‡æ¡£

- `uya_ai_prompt.md` - **å®Œæ•´ Uya è¯­è¨€è§„èŒƒï¼ˆå¿…é¡»å‚è€ƒï¼‰**
- `spec/UYA_MINI_SPEC.md` - Uya Mini è¯­è¨€è§„èŒƒï¼ˆâœ… å·²æ›´æ–°ï¼š2026-01-11 ä¿®å¤æŒ‡é’ˆè§£å¼•ç”¨å’Œ sizeof è¯­æ³•å®šä¹‰ï¼‰
- `CODE_REVIEW.md` - å¯è¡Œæ€§è¯„ä¼°æŠ¥å‘Š
- `compiler-mini/src/` - compiler-mini æºä»£ç ï¼ˆå‚è€ƒå®ç°ï¼‰

---

## æµ‹è¯•ç­–ç•¥

æ¯ä¸ªç‰¹æ€§å®ç°åéœ€è¦ï¼š

1. **è¯­æ³•æµ‹è¯•**ï¼šéªŒè¯è¯­æ³•è§£ææ­£ç¡®
2. **ç±»å‹æ£€æŸ¥æµ‹è¯•**ï¼šéªŒè¯ç±»å‹æ£€æŸ¥æ­£ç¡®
3. **ä»£ç ç”Ÿæˆæµ‹è¯•**ï¼šéªŒè¯ç”Ÿæˆçš„ä»£ç æ­£ç¡®
4. **é›†æˆæµ‹è¯•**ï¼šåœ¨ compiler-mini é‡æ„ä¸­ä½¿ç”¨æ–°ç‰¹æ€§

---

## è§„èŒƒæ–‡æ¡£çŠ¶æ€

**è§„èŒƒæ–‡æ¡£æ›´æ–°è®°å½•**ï¼š

- **2026-01-11**ï¼šä¿®å¤äº† `spec/UYA_MINI_SPEC.md` ä¸­çš„ä»¥ä¸‹é—®é¢˜ï¼š
  - âœ… æ·»åŠ äº†æŒ‡é’ˆè§£å¼•ç”¨è¿ç®—ç¬¦ `*expr` çš„å®Œæ•´è¯­æ³•å®šä¹‰
  - âœ… æ·»åŠ äº† `sizeof` çš„ BNF è¯­æ³•å®šä¹‰ï¼ˆ`sizeof_expr`ï¼‰
  - âœ… ä¿®å¤äº†ç« èŠ‚ç¼–å·é—®é¢˜ï¼ˆ4.6 â†’ 4.5ï¼‰
  - âœ… åˆå¹¶äº†é‡å¤çš„"è¯´æ˜"éƒ¨åˆ†
  - âœ… å®Œå–„äº†æŒ‡é’ˆè§£å¼•ç”¨å’Œç±»å‹æ¨æ–­çš„è¯´æ˜
  - âœ… æ˜ç¡®è¯´æ˜ `extern` å‡½æ•°æ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°ï¼ˆ`*T`ï¼‰å’Œè¿”å›å€¼

**å½“å‰å®ç°çŠ¶æ€æ€»ç»“**ï¼ˆåŸºäºæºç åˆ†æï¼Œæœ€åæ›´æ–°ï¼š2026-01-13ï¼‰ï¼š

**å·²å®ç°ç‰¹æ€§**ï¼ˆç¼–è¯‘å™¨ä»£ç ä¸­å·²å®ç°ï¼‰ï¼š
- âœ… åŸºç¡€ç±»å‹ï¼š`i32`ã€`bool`ã€`byte`ã€`void`ã€`struct Name`
- âœ… ç»“æ„ä½“å®šä¹‰ã€å®ä¾‹åŒ–å’Œå­—æ®µè®¿é—®
- âœ… `extern` å‡½æ•°å£°æ˜ï¼ˆåŸºç¡€ç±»å‹å‚æ•°ï¼‰
- âœ… æ§åˆ¶æµï¼š`if`ã€`while`ã€`for`ã€`return`ã€`break`ã€`continue`
- âœ… è¡¨è¾¾å¼ï¼šç®—æœ¯ã€é€»è¾‘ã€æ¯”è¾ƒè¿ç®—
- âœ… ä¸€å…ƒè¡¨è¾¾å¼ï¼š`!`ï¼ˆé€»è¾‘éï¼‰ã€`-`ï¼ˆè´Ÿå·ï¼‰ã€`&`ï¼ˆå–åœ°å€ï¼‰ã€`*`ï¼ˆè§£å¼•ç”¨ï¼‰
- âœ… æŒ‡é’ˆç±»å‹ï¼š`&T` å’Œ `*T`ï¼ˆç±»å‹ç³»ç»Ÿã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆï¼‰
- âœ… æ•°ç»„ç±»å‹ï¼š`[T: N]`ï¼ˆç±»å‹ç³»ç»Ÿã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆã€æ•°ç»„å­—é¢é‡ï¼‰
- âœ… æ•°ç»„è®¿é—®ï¼š`arr[index]`ï¼ˆAST_ARRAY_ACCESS èŠ‚ç‚¹ç±»å‹ã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆå‡æ”¯æŒï¼‰
- âœ… `sizeof` å†…ç½®å‡½æ•°ï¼ˆè§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆï¼‰
- âœ… ç±»å‹è½¬æ¢ `as`ï¼ˆAST_CAST_EXPR èŠ‚ç‚¹ç±»å‹ã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆå‡æ”¯æŒï¼Œæ”¯æŒ i32 â†” byte å’Œ i32 â†” bool è½¬æ¢ï¼‰
- âœ… `null` å­—é¢é‡ï¼ˆTOKEN_NULL å…³é”®å­—ã€è§£æä¸º AST_IDENTIFIER èŠ‚ç‚¹ã€ä»£ç ç”Ÿæˆå™¨æ”¯æŒæŒ‡é’ˆåˆå§‹åŒ–å’Œæ¯”è¾ƒï¼‰
- âœ… `for` å¾ªç¯ï¼ˆAST_FOR_STMT èŠ‚ç‚¹ç±»å‹ã€è§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨å‡æ”¯æŒï¼Œæ”¯æŒå€¼è¿­ä»£å’Œå¼•ç”¨è¿­ä»£ï¼Œæ”¯æŒ break/continueï¼‰
- âœ… `break` å’Œ `continue` è¯­å¥ï¼ˆTOKEN_BREAK/TOKEN_CONTINUE å…³é”®å­—ã€AST_BREAK_STMT/AST_CONTINUE_STMT èŠ‚ç‚¹ç±»å‹ã€è§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ï¼ˆå¾ªç¯ä¸Šä¸‹æ–‡è·Ÿè¸ªï¼‰ã€ä»£ç ç”Ÿæˆå™¨ï¼ˆå¾ªç¯åŸºæœ¬å—æ ˆï¼Œæ”¯æŒ while å’Œ for å¾ªç¯ï¼‰ï¼‰

**è§„èŒƒå·²å®šä¹‰ä½†æœªå®ç°ç‰¹æ€§**ï¼š
- âœ… æŒ‡é’ˆç±»å‹ `&T` å’Œ `*T`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼‰
- âœ… æ•°ç»„ç±»å‹ `[T: N]`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ç±»å‹ç³»ç»Ÿã€è§£æã€ç±»å‹æ£€æŸ¥ã€ä»£ç ç”Ÿæˆã€æ•°ç»„å­—é¢é‡ï¼‰
- âœ… æ•°ç»„è®¿é—® `arr[index]`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼‰
- âœ… `sizeof` å†…ç½®å‡½æ•°ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼‰
- âœ… `for` å¾ªç¯ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼šAST_FOR_STMT èŠ‚ç‚¹ç±»å‹ã€è§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨å‡æ”¯æŒï¼Œæ”¯æŒå€¼è¿­ä»£ `for arr |item|` å’Œå¼•ç”¨è¿­ä»£ `for arr |&item|`ï¼Œæ”¯æŒ break/continueï¼‰
- âœ… `break` å’Œ `continue` è¯­å¥ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼šå·²æ·»åŠ  `TOKEN_BREAK` å’Œ `TOKEN_CONTINUE` å…³é”®å­—ï¼ŒAST èŠ‚ç‚¹ç±»å‹ `AST_BREAK_STMT` å’Œ `AST_CONTINUE_STMT`ï¼Œè§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ï¼ˆå¾ªç¯ä¸Šä¸‹æ–‡è·Ÿè¸ªï¼‰å’Œä»£ç ç”Ÿæˆå™¨ï¼ˆå¾ªç¯åŸºæœ¬å—æ ˆï¼Œæ”¯æŒ while å’Œ for å¾ªç¯ï¼‰å‡æ”¯æŒã€‚for å¾ªç¯ä¸­çš„ continue è·³è½¬åˆ°é€’å¢åŸºæœ¬å—ï¼Œwhile å¾ªç¯ä¸­çš„ continue è·³è½¬åˆ°æ¡ä»¶æ£€æŸ¥åŸºæœ¬å—ï¼‰
- âœ… å–åœ°å€è¿ç®—ç¬¦ `&expr`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼‰
- âœ… è§£å¼•ç”¨è¿ç®—ç¬¦ `*expr`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼‰
- âœ… `null` å­—é¢é‡ï¼ˆè§„èŒƒå·²å®šä¹‰ä¸ºå…³é”®å­—ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼šå·²æ·»åŠ  `TOKEN_NULL` å…³é”®å­—ï¼Œè§£æä¸º `AST_IDENTIFIER` èŠ‚ç‚¹ï¼Œä»£ç ç”Ÿæˆå™¨æ”¯æŒæŒ‡é’ˆåˆå§‹åŒ–å’Œæ¯”è¾ƒï¼‰
- âœ… `byte` ç±»å‹ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼‰
- âœ… `extern` å‡½æ•° FFI æŒ‡é’ˆç±»å‹å‚æ•° `*T`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼šè§£æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨å‡æ”¯æŒï¼Œæµ‹è¯•ç”¨ä¾‹éªŒè¯é€šè¿‡ï¼‰
- âœ… ç±»å‹è½¬æ¢ `as`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨å·²å®ç°ï¼‰

**å®ç°çŠ¶æ€æ£€æŸ¥æ–¹æ³•**ï¼š
- æ£€æŸ¥ `src/checker.h` ä¸­çš„ `TypeKind` æšä¸¾
- æ£€æŸ¥ `src/ast.h` ä¸­çš„ `ASTNodeType` æšä¸¾
- æ£€æŸ¥ `src/lexer.h` ä¸­çš„ `TokenType` æšä¸¾
- æ£€æŸ¥æµ‹è¯•ç¨‹åºç›®å½• `tests/programs/` ä¸­çš„æµ‹è¯•ç”¨ä¾‹

**è§„èŒƒæ–‡æ¡£ä¸å®ç°çŠ¶æ€çš„å…³ç³»**ï¼š

- **è§„èŒƒçŠ¶æ€**ï¼šæŒ‡è¯­æ³•è§„èŒƒæ˜¯å¦åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰
- **å®ç°çŠ¶æ€**ï¼šæŒ‡ç¼–è¯‘å™¨ä»£ç æ˜¯å¦å®ç°äº†è¯¥ç‰¹æ€§
- è§„èŒƒå¯èƒ½å·²å®šä¹‰ï¼Œä½†å®ç°ä»ä¸º"æœªå®ç°"çŠ¶æ€

**æ›´æ–°è§„èŒƒæ–‡æ¡£çš„æ—¶æœº**ï¼š

å®ç°æ¯ä¸ªç‰¹æ€§åï¼Œéœ€è¦æ›´æ–°ï¼š

- `spec/UYA_MINI_SPEC.md` - æ·»åŠ æ–°ç‰¹æ€§çš„è¯­æ³•è§„èŒƒå’Œè¯­ä¹‰è§„åˆ™
- `spec/grammar_formal.md` - æ›´æ–° BNF è¯­æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- ç›¸å…³ç¤ºä¾‹ä»£ç 

**é‡è¦**ï¼šæ‰€æœ‰è¯­æ³•å¿…é¡»ä¸å®Œæ•´ Uya è¯­è¨€è§„èŒƒï¼ˆ`uya_ai_prompt.md`ï¼‰ä¿æŒä¸€è‡´ã€‚

---

## ğŸ“‹ å®ç°æ£€æŸ¥æ¸…å•

### å¼€å§‹å®ç°å‰

- [ ] å·²é˜…è¯» `PROGRESS.md` äº†è§£å½“å‰è¿›åº¦
- [ ] å·²é˜…è¯» `CONTEXT_SWITCH.md` äº†è§£ä¸Šä¸‹æ–‡åˆ‡æ¢æµç¨‹
- [ ] å·²é˜…è¯» `spec/UYA_MINI_SPEC.md` äº†è§£è¯­è¨€è§„èŒƒ
- [ ] å¦‚æœæ‰©å±•è§„èŒƒï¼Œå·²äº†è§£å®Œæ•´ Uya è¯­è¨€è§„èŒƒï¼ˆ`uya_ai_prompt.md`ï¼‰
- [ ] å·²äº†è§£å½“å‰å®ç°çŠ¶æ€ï¼ˆå‚è€ƒæœ¬æ–‡æ¡£çš„"å®ç°çŠ¶æ€è¯´æ˜"éƒ¨åˆ†ï¼‰
- [ ] å·²ç¡®è®¤ä¾èµ–çš„æ­¥éª¤å·²å®Œæˆï¼ˆå‚è€ƒ"ä¸‹ä¸€æ­¥å·¥ä½œ"éƒ¨åˆ†çš„ä¾èµ–å…³ç³»ï¼‰
- [ ] å·²é˜…è¯» `.cursorrules` äº†è§£å¼€å‘è§„èŒƒ

### å®ç°è¿‡ç¨‹ä¸­

- [ ] **éµå¾ª TDD æµç¨‹**ï¼ˆå…ˆå†™æµ‹è¯•ï¼Œå†å®ç°ï¼‰
- [ ] **åŠŸèƒ½å®Œæ•´å®ç°**ï¼ˆä¸èƒ½ç®€åŒ–ï¼Œä¸èƒ½å·æ‡’ï¼‰
- [ ] **æ‰€æœ‰å‡½æ•° < 200 è¡Œï¼Œæ–‡ä»¶ < 1500 è¡Œ**
- [ ] æ‰€æœ‰ä»£ç ä½¿ç”¨ä¸­æ–‡æ³¨é‡Š
- [ ] æ— å †åˆ†é…ï¼ˆä¸ä½¿ç”¨ malloc/freeï¼‰
- [ ] ä½¿ç”¨ Arena åˆ†é…å™¨
- [ ] **ä½¿ç”¨æšä¸¾ç±»å‹ï¼Œä¸èƒ½ç”¨å­—é¢é‡ä»£æ›¿æšä¸¾**ï¼ˆæé«˜ä»£ç å¯ç»´æŠ¤æ€§ï¼‰
- [ ] éµå¾ªå®ç°æ­¥éª¤çš„ä¾èµ–å…³ç³»ï¼ˆä¸èƒ½è·³è¿‡ä¾èµ–æ­¥éª¤ï¼‰

### å®Œæˆå®ç°å

- [ ] **æ‰€æœ‰æµ‹è¯•é€šè¿‡**ï¼ˆå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼‰
- [ ] ä»£ç å¯ä»¥ç¼–è¯‘ï¼ˆæ— ç¼–è¯‘é”™è¯¯å’Œè­¦å‘Šï¼‰
- [ ] ä»£ç è´¨é‡æ£€æŸ¥é€šè¿‡ï¼ˆå‡½æ•°é•¿åº¦ã€æ–‡ä»¶é•¿åº¦ã€æ³¨é‡Šã€æ— å †åˆ†é…ï¼‰
- [ ] å·²æ›´æ–° `PROGRESS.md` è®°å½•å®ŒæˆçŠ¶æ€
- [ ] å·²æ›´æ–° `TODO_uya_mini_extension.md` æ ‡è®°å®ç°çŠ¶æ€
- [ ] å·²æäº¤ä»£ç ï¼ˆå¦‚æœä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ï¼‰

### æ¯ä¸ªæ­¥éª¤å®Œæˆå

- [ ] **æ­¥éª¤1ï¼ˆæ‰©å±• AST èŠ‚ç‚¹ç±»å‹ï¼‰**ï¼š
  - [ ] æ·»åŠ  `AST_TYPE_POINTER` å’Œ `AST_TYPE_ARRAY` åˆ°æšä¸¾
  - [ ] æ·»åŠ æ•°æ®å­—æ®µåˆ° union ç»“æ„ä½“
  - [ ] æ‰©å±• `ast_new_node()` å‡½æ•°
  - [ ] æ·»åŠ å•å…ƒæµ‹è¯•
  - [ ] æ›´æ–°æ–‡æ¡£æ ‡è®°æ­¥éª¤1å®Œæˆ

- [ ] **æ­¥éª¤2ï¼ˆæ‰©å±•è§£æå™¨ï¼‰**ï¼š
  - [ ] æ‰©å±• `parser_parse_type()` æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„è¯­æ³•
  - [ ] æ·»åŠ è§£æå™¨æµ‹è¯•ç”¨ä¾‹
  - [ ] æ›´æ–°æ–‡æ¡£æ ‡è®°æ­¥éª¤2å®Œæˆ

- [ ] **æ­¥éª¤3ï¼ˆæ‰©å±•ç±»å‹æ£€æŸ¥å™¨ï¼‰**ï¼š
  - [ ] æ‰©å±• `type_from_ast()` æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹
  - [ ] æ‰©å±• `checker_infer_type()` æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ¨æ–­
  - [ ] æ·»åŠ ç±»å‹æ£€æŸ¥æµ‹è¯•ç”¨ä¾‹
  - [ ] æ›´æ–°æ–‡æ¡£æ ‡è®°æ­¥éª¤3å®Œæˆ

- [ ] **æ­¥éª¤4ï¼ˆå–åœ°å€å’Œè§£å¼•ç”¨è¿ç®—ç¬¦ï¼‰**ï¼š
  - [ ] æ‰©å±•è§£æå™¨æ”¯æŒ `&expr` å’Œ `*expr`
  - [ ] æ‰©å±•ç±»å‹æ£€æŸ¥å™¨
  - [ ] æ‰©å±•ä»£ç ç”Ÿæˆå™¨
  - [ ] æ·»åŠ æµ‹è¯•ç”¨ä¾‹
  - [ ] æ›´æ–°æ–‡æ¡£æ ‡è®°æ­¥éª¤4å®Œæˆ

- [x] **æ­¥éª¤5ï¼ˆæ‰©å±•ä»£ç ç”Ÿæˆå™¨ï¼‰**ï¼š
  - [x] æ‰©å±•ç±»å‹æ˜ å°„å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„
  - [x] å®ç°æ•°ç»„è®¿é—®ä»£ç ç”Ÿæˆ
  - [x] æ·»åŠ ä»£ç ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼ˆå·²æœ‰æµ‹è¯•ç¨‹åº array_access.uya å’Œå•å…ƒæµ‹è¯•ï¼‰
  - [x] æ›´æ–°æ–‡æ¡£æ ‡è®°æ­¥éª¤5å®Œæˆ

- [x] **æ­¥éª¤6ï¼ˆ`sizeof` å†…ç½®å‡½æ•°ï¼‰**ï¼š
  - [x] æ·»åŠ  `AST_SIZEOF` èŠ‚ç‚¹ç±»å‹
  - [x] æ‰©å±•è§£æå™¨æ”¯æŒ `sizeof` è¯­æ³•
  - [x] æ‰©å±•ç±»å‹æ£€æŸ¥å™¨
  - [x] æ‰©å±•ä»£ç ç”Ÿæˆå™¨
  - [x] æ·»åŠ æµ‹è¯•ç”¨ä¾‹
  - [x] æ›´æ–°æ–‡æ¡£æ ‡è®°æ­¥éª¤6å®Œæˆ

- [x] **æ­¥éª¤7ï¼ˆæ‰©å±• extern å‡½æ•°å£°æ˜ï¼‰**ï¼š
  - [x] æ‰©å±•è§£æå™¨æ”¯æŒ extern å‡½æ•°æŒ‡é’ˆå‚æ•°ï¼ˆé€šè¿‡ `parser_parse_type()` å·²æ”¯æŒï¼‰
  - [x] æ‰©å±•ç±»å‹æ£€æŸ¥å™¨ï¼ˆé€šè¿‡ `type_from_ast()` å’Œ `checker_check_fn_decl()` å·²æ”¯æŒï¼‰
  - [x] æ‰©å±•ä»£ç ç”Ÿæˆå™¨ï¼ˆé€šè¿‡ `get_llvm_type_from_ast()` å’Œ `codegen_declare_function()` å·²æ”¯æŒï¼‰
  - [x] æ·»åŠ æµ‹è¯•ç”¨ä¾‹ï¼ˆ`test_extern_ffi_pointer.uya`ï¼‰
  - [x] æ›´æ–°æ–‡æ¡£æ ‡è®°æ­¥éª¤7å®Œæˆ

---

## ğŸ”„ ä¸Šä¸‹æ–‡åˆ‡æ¢è¯´æ˜

å½“éœ€è¦åœ¨æ–°çš„ Cursor ä¼šè¯ä¸­ç»§ç»­å·¥ä½œæ—¶ï¼Œè¯·å‚è€ƒ `CONTEXT_SWITCH.md` äº†è§£ä¸Šä¸‹æ–‡åˆ‡æ¢æµç¨‹ã€‚

**å…³é”®è¦ç‚¹**ï¼š
1. æ–°ä¼šè¯å¼€å§‹æ—¶ï¼Œé¦–å…ˆé˜…è¯» `PROGRESS.md` äº†è§£å½“å‰è¿›åº¦
2. é˜…è¯»æœ¬æ–‡æ¡£ï¼ˆ`TODO_uya_mini_extension.md`ï¼‰äº†è§£è¯¦ç»†å®ç°çŠ¶æ€å’Œä¸‹ä¸€æ­¥å·¥ä½œ
3. ç¡®è®¤ä¾èµ–çš„æ­¥éª¤å·²å®Œæˆï¼Œæ‰èƒ½å¼€å§‹æ–°çš„æ­¥éª¤
4. å®Œæˆæ¯ä¸ªæ­¥éª¤åï¼Œç«‹å³æ›´æ–° `PROGRESS.md` å’Œæœ¬æ–‡æ¡£è®°å½•è¿›åº¦
5. éµå¾ª TDD æµç¨‹ï¼Œå…ˆå†™æµ‹è¯•ï¼Œå†å®ç°åŠŸèƒ½
6. ä¿æŒä»£ç è´¨é‡ï¼šå‡½æ•° < 200 è¡Œï¼Œæ–‡ä»¶ < 1500 è¡Œï¼Œä¸­æ–‡æ³¨é‡Šï¼Œæ— å †åˆ†é…

**å‚è€ƒæ–‡æ¡£**ï¼š
- `CONTEXT_SWITCH.md` - ä¸Šä¸‹æ–‡åˆ‡æ¢è¯¦ç»†æŒ‡å—
- `PROGRESS.md` - å½“å‰å®ç°è¿›åº¦å’ŒçŠ¶æ€
- `spec/UYA_MINI_SPEC.md` - Uya Mini è¯­è¨€è§„èŒƒ
- `.cursorrules` - å¼€å‘è§„èŒƒ

