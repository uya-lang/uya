# Uya Mini è§„èŒƒæ‰©å±• TODO æ–‡æ¡£ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰

æœ¬æ–‡æ¡£è®°å½•ä¸ºæ”¯æŒä½¿ç”¨ Uya Mini é‡æ„ compiler-mini è€Œéœ€è¦æ·»åŠ çš„è¯­è¨€ç‰¹æ€§ã€‚**æ‰€æœ‰ç‰¹æ€§å¿…é¡»ç¬¦åˆå®Œæ•´ Uya è¯­è¨€è§„èŒƒ**ï¼ˆå‚è€ƒ `uya_ai_prompt.md`ï¼‰ã€‚

**åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-11  
**æœ€åæ›´æ–°**ï¼š2026-01-11ï¼ˆç±»å‹ç³»ç»Ÿæ‰©å±•å®Œæˆï¼‰  
**ç›®çš„**ï¼šè®°å½•éœ€è¦æ·»åŠ åˆ° Uya Mini è§„èŒƒä¸­çš„ç‰¹æ€§ï¼Œä»¥æ”¯æŒ compiler-mini çš„è‡ªä¸¾é‡æ„ï¼Œæ‰€æœ‰è¯­æ³•å¿…é¡»ç¬¦åˆå®Œæ•´ Uya è¯­è¨€è§„èŒƒã€‚

**æ³¨æ„**ï¼šæœ¬æ–‡æ¡£è®°å½•çš„æ˜¯**ç¼–è¯‘å™¨å®ç°çŠ¶æ€**ï¼Œè€Œä¸æ˜¯è§„èŒƒæ–‡æ¡£çŠ¶æ€ã€‚è§„èŒƒæ–‡æ¡£ï¼ˆ`spec/UYA_MINI_SPEC.md`ï¼‰å¯èƒ½å·²ç»å®šä¹‰äº†æŸäº›ç‰¹æ€§çš„è¯­æ³•ï¼Œä½†ç¼–è¯‘å™¨å®ç°çŠ¶æ€å¯èƒ½ä»ä¸º"æœªå®ç°"ã€‚å®ç°çŠ¶æ€ä»…æŒ‡ç¼–è¯‘å™¨ä»£ç çš„å®ç°ï¼Œä¸åŒ…æ‹¬è§„èŒƒæ–‡æ¡£çš„ç¼–å†™ã€‚

---

## ğŸš§ å½“å‰å®ç°è¿›åº¦

**çŠ¶æ€**ï¼šğŸ”„ è¿›è¡Œä¸­ï¼ˆ2026-01-11ï¼‰

**å·²å®Œæˆçš„å·¥ä½œ**ï¼š
- âœ… æ·»åŠ  `TOKEN_AMPERSAND` åˆ° `lexer.h`ï¼ˆæ”¯æŒå–åœ°å€è¿ç®—ç¬¦ `&`ï¼‰
- âœ… ä¿®æ”¹ `lexer.c` è¯†åˆ«å•ä¸ª `&` ç¬¦å·ï¼ˆä¹‹å‰åªè¯†åˆ« `&&`ï¼‰
- âœ… æ‰©å±• `TypeKind` æšä¸¾æ·»åŠ  `TYPE_POINTER` å’Œ `TYPE_ARRAY`
- âœ… æ‰©å±• `Type` ç»“æ„ä½“æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹ï¼ˆä½¿ç”¨ union å­˜å‚¨ä¸åŒç±»å‹æ•°æ®ï¼‰
- âœ… æ›´æ–° `checker.c` ä¸­æ‰€æœ‰ä½¿ç”¨ Type ç»“æ„ä½“çš„åœ°æ–¹ï¼ˆä» `.struct_name` æ”¹ä¸º `.data.struct_name`ï¼‰
- âœ… æ›´æ–° `type_equals` å‡½æ•°æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ¯”è¾ƒ

**ä¸‹ä¸€æ­¥å·¥ä½œ**ï¼š
- â³ æ‰©å±• AST èŠ‚ç‚¹ç±»å‹æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹
- â³ æ‰©å±•è§£æå™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹è§£æï¼ˆ`&Type`ã€`*Type`ã€`[Type: N]`ï¼‰
- â³ æ‰©å±•ç±»å‹æ£€æŸ¥å™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹æ£€æŸ¥
- â³ æ‰©å±•ä»£ç ç”Ÿæˆå™¨æ”¯æŒæŒ‡é’ˆå’Œæ•°ç»„ç±»å‹ä»£ç ç”Ÿæˆ
- â³ å®ç° `sizeof` å†…ç½®å‡½æ•°
- â³ æ‰©å±• `extern` å‡½æ•°å£°æ˜æ”¯æŒæŒ‡é’ˆç±»å‹å‚æ•°
- â³ å®ç°å–åœ°å€å’Œè§£å¼•ç”¨è¿ç®—ç¬¦ï¼ˆ`&expr` å’Œ `*expr`ï¼‰

---

## ä¼˜å…ˆçº§è¯´æ˜

- **P0ï¼ˆå¿…éœ€ï¼‰**ï¼šé˜»å¡æ€§ç‰¹æ€§ï¼Œæ²¡æœ‰è¿™äº›ç‰¹æ€§æ— æ³•é‡æ„ compiler-mini
- **P1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰**ï¼šæ˜¾è‘—æ”¹å–„ä»£ç è´¨é‡å’Œå¯è¯»æ€§
- **P2ï¼ˆå¯é€‰ï¼‰**ï¼šä¼˜åŒ–ä½“éªŒï¼Œå¯ç”¨æ›¿ä»£æ–¹æ¡ˆ

---

## é‡è¦è¯´æ˜ï¼šUya Mini ä¸å®Œæ•´ Uya çš„å…³ç³»

Uya Mini æ˜¯ Uya è¯­è¨€çš„æœ€å°å­é›†ã€‚æ‰©å±•ç‰¹æ€§æ—¶ï¼Œåº”å‚è€ƒå®Œæ•´ Uya è¯­è¨€è§„èŒƒï¼ˆ`uya_ai_prompt.md`ï¼‰ï¼Œç¡®ä¿è¯­æ³•å’Œè¯­ä¹‰ä¸€è‡´ã€‚å…³é”®åŒºåˆ«ï¼š

- **æŒ‡é’ˆç±»å‹**ï¼šå®Œæ•´ Uya ä½¿ç”¨ `&T` ä½œä¸ºæ™®é€šæŒ‡é’ˆï¼Œ`*T` ä»…ç”¨äº FFI
- **æ•°ç»„è¯­æ³•**ï¼šå®Œæ•´ Uya ä½¿ç”¨ `[T: N]` è¯­æ³•
- **sizeof**ï¼šå®Œæ•´ Uya ä¸­ `sizeof(T)` æ˜¯æ ‡å‡†åº“å‡½æ•°ï¼ˆ`use std.mem;`ï¼‰ï¼ŒUya Mini ä¸­ä½œä¸ºå†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼‰
- **æšä¸¾**ï¼šå®Œæ•´ Uya å·²æ”¯æŒæšä¸¾ï¼Œé»˜è®¤åº•å±‚ç±»å‹ `i32`

---

## P0 ä¼˜å…ˆçº§ç‰¹æ€§ï¼ˆå¿…éœ€ï¼‰

### 1. æŒ‡é’ˆç±»å‹ (`&T` å’Œ `*T`)

**çŠ¶æ€**ï¼šéƒ¨åˆ†å®ç°ï¼ˆç±»å‹ç³»ç»Ÿæ‰©å±•å®Œæˆï¼Œè§£æå’Œä»£ç ç”Ÿæˆå¾…å®ç°ï¼‰  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆåŒ…æ‹¬æŒ‡é’ˆè§£å¼•ç”¨è¿ç®—ç¬¦ `*expr`ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æï¼Œæœ€åæ›´æ–°ï¼š2026-01-11ï¼‰ï¼š
- âœ… `TypeKind` æšä¸¾ä¸­å·²æ·»åŠ  `TYPE_POINTER`ï¼ˆ2026-01-11ï¼‰
- âœ… æ·»åŠ  `TOKEN_AMPERSAND` æ”¯æŒå–åœ°å€è¿ç®—ç¬¦ `&`ï¼ˆ2026-01-11ï¼‰
- âœ… `Type` ç»“æ„ä½“å·²æ‰©å±•æ”¯æŒæŒ‡é’ˆç±»å‹ï¼ˆä½¿ç”¨ unionï¼Œå­˜å‚¨æŒ‡å‘çš„ç±»å‹æŒ‡é’ˆå’Œ FFI æ ‡è®°ï¼‰ï¼ˆ2026-01-11ï¼‰
- âœ… `type_equals` å‡½æ•°å·²æ”¯æŒæŒ‡é’ˆç±»å‹æ¯”è¾ƒï¼ˆ2026-01-11ï¼‰
- âŒ AST èŠ‚ç‚¹ç±»å‹ä¸­æ²¡æœ‰æŒ‡é’ˆç±»å‹èŠ‚ç‚¹
- âŒ è§£æå™¨æ²¡æœ‰å®ç°æŒ‡é’ˆç±»å‹è§£æï¼ˆ`&Type` å’Œ `*Type`ï¼‰
- âŒ ç±»å‹æ£€æŸ¥å™¨æ²¡æœ‰æŒ‡é’ˆç±»å‹æ£€æŸ¥ï¼ˆç±»å‹åˆ›å»ºå’Œæ¨æ–­å¾…å®ç°ï¼‰
- âŒ ä»£ç ç”Ÿæˆå™¨æ²¡æœ‰æŒ‡é’ˆä»£ç ç”Ÿæˆ
- â³ å–åœ°å€è¿ç®—ç¬¦ `&expr` éƒ¨åˆ†å®ç°ï¼ˆToken æ”¯æŒï¼Œè§£æå™¨å¾…å®ç°ï¼‰
- âŒ è§£å¼•ç”¨è¿ç®—ç¬¦ `*expr` æœªå®ç°ï¼ˆä¸€å…ƒè¡¨è¾¾å¼åªæ”¯æŒ `!` å’Œ `-`ï¼‰

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- `&T` - æ™®é€šæŒ‡é’ˆï¼ˆæ— lifetimeç¬¦å·ï¼‰ï¼Œ8å­—èŠ‚ï¼Œç”¨äºæ™®é€šå˜é‡å’Œå‡½æ•°å‚æ•°
- `*T` - FFI æŒ‡é’ˆç±»å‹ï¼Œä»…ç”¨äº FFI å‡½æ•°å£°æ˜/è°ƒç”¨ï¼Œä¸èƒ½ç”¨äºæ™®é€šå˜é‡å£°æ˜
- å–åœ°å€æ“ä½œç¬¦ï¼š`&expr`
- è§£å¼•ç”¨ï¼šé€šè¿‡ `.` è®¿é—®å­—æ®µï¼Œæˆ–ä½¿ç”¨ `*expr` æ“ä½œç¬¦

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-11ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ·»åŠ æŒ‡é’ˆè§£å¼•ç”¨è¿ç®—ç¬¦ `*` çš„è¯­æ³•å®šä¹‰
- âœ… è¿ç®—ç¬¦åˆ—è¡¨ã€BNF è¯­æ³•ã€è¿ç®—ç¬¦ä¼˜å…ˆçº§å‡å·²æ›´æ–°
- âœ… è¡¨è¾¾å¼è¯´æ˜ä¸­è¡¥å……äº†æŒ‡é’ˆè§£å¼•ç”¨çš„è¯¦ç»†è¯´æ˜

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç»“æ„ä½“æŒ‡é’ˆä¼ é€’ï¼ˆ`&ASTNode`, `&Arena`ï¼‰ - ä½¿ç”¨ `&T`
- æ•°ç»„æŒ‡é’ˆï¼ˆ`&[ASTNode: N]`ï¼‰ - ä½¿ç”¨ `&[T: N]`
- FFI å‡½æ•°å‚æ•°ï¼ˆ`*byte`, `*void`, `*FILE`ï¼‰ - ä½¿ç”¨ `*T`
- C æ ‡å‡†åº“å’Œ LLVM C API è°ƒç”¨ - ä½¿ç”¨ `*T`

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/ast.h` - ASTNode ç»“æ„ä½“å®šä¹‰
- `compiler-mini/src/arena.h` - Arena ç»“æ„ä½“å®šä¹‰
- `compiler-mini/src/main.c:23-29` - æ–‡ä»¶ I/Oï¼ˆFFIï¼‰
- `compiler-mini/src/codegen.c` - LLVM C API è°ƒç”¨ï¼ˆFFIï¼‰

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
// æ™®é€šæŒ‡é’ˆï¼ˆ&Tï¼‰- ç”¨äºæ™®é€šå˜é‡å’Œå‡½æ•°å‚æ•°
struct Node {
    value: i32;
}

fn process(node: &Node) i32 {
    return node.value;  // é€šè¿‡æŒ‡é’ˆè®¿é—®å­—æ®µ
}

var n: Node = Node{ value: 10 };
var p: &Node = &n;  // å–åœ°å€
var v: i32 = p.value;  // é€šè¿‡æŒ‡é’ˆè®¿é—®å­—æ®µ

// FFI æŒ‡é’ˆç±»å‹ï¼ˆ*Tï¼‰- ä»…ç”¨äº extern å‡½æ•°å£°æ˜/è°ƒç”¨
extern fn fopen(filename: *byte, mode: *byte) *FILE;
extern fn fread(buffer: *void, size: i32, count: i32, file: *FILE) i32;
extern fn strcmp(s1: *byte, s2: *byte) i32;

// LLVM C APIï¼ˆFFIï¼‰
extern fn LLVMContextCreate() *LLVMContext;
extern fn LLVMModuleCreateWithNameInContext(name: *byte, context: *LLVMContext) *LLVMModule;
```

**å®ç°è¦ç‚¹**ï¼š
- æ™®é€šæŒ‡é’ˆç±»å‹ï¼š`&Type`
- FFI æŒ‡é’ˆç±»å‹ï¼š`*Type`ï¼ˆä»…ç”¨äº extern å‡½æ•°ï¼‰
- å–åœ°å€ï¼š`&expr`
- è§£å¼•ç”¨ï¼š`.field` æˆ– `*expr`
- æŒ‡é’ˆç±»å‹æ£€æŸ¥ï¼šæŒ‡é’ˆç±»å‹å¿…é¡»åŒ¹é…
- NULL æŒ‡é’ˆå¤„ç†ï¼š`null` å¸¸é‡ï¼ˆå¦‚æœæ”¯æŒï¼‰

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- `&T` å¯¹åº”å®Œæ•´ Uya çš„æ™®é€šæŒ‡é’ˆï¼ˆæ— lifetimeç¬¦å·ï¼‰
- `*T` å¯¹åº”å®Œæ•´ Uya çš„ FFI æŒ‡é’ˆç±»å‹ï¼ˆä»…ç”¨äº FFIï¼‰

---

### 2. å›ºå®šå¤§å°æ•°ç»„ (`[T: N]`)

**çŠ¶æ€**ï¼šéƒ¨åˆ†å®ç°ï¼ˆç±»å‹ç³»ç»Ÿæ‰©å±•å®Œæˆï¼Œè§£æå’Œä»£ç ç”Ÿæˆå¾…å®ç°ï¼‰  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æï¼Œæœ€åæ›´æ–°ï¼š2026-01-11ï¼‰ï¼š
- âœ… `TypeKind` æšä¸¾ä¸­å·²æ·»åŠ  `TYPE_ARRAY`ï¼ˆ2026-01-11ï¼‰
- âœ… `Type` ç»“æ„ä½“å·²æ‰©å±•æ”¯æŒæ•°ç»„ç±»å‹ï¼ˆä½¿ç”¨ unionï¼Œå­˜å‚¨å…ƒç´ ç±»å‹æŒ‡é’ˆå’Œæ•°ç»„å¤§å°ï¼‰ï¼ˆ2026-01-11ï¼‰
- âœ… `type_equals` å‡½æ•°å·²æ”¯æŒæ•°ç»„ç±»å‹æ¯”è¾ƒï¼ˆ2026-01-11ï¼‰
- âŒ AST èŠ‚ç‚¹ç±»å‹ä¸­æ²¡æœ‰æ•°ç»„ç›¸å…³èŠ‚ç‚¹
- âŒ è§£æå™¨æ²¡æœ‰å®ç°æ•°ç»„ç±»å‹è§£æï¼ˆ`[Type: N]`ï¼‰
- âŒ ç±»å‹æ£€æŸ¥å™¨æ²¡æœ‰æ•°ç»„ç±»å‹æ£€æŸ¥ï¼ˆç±»å‹åˆ›å»ºå’Œæ¨æ–­å¾…å®ç°ï¼‰
- âŒ ä»£ç ç”Ÿæˆå™¨æ²¡æœ‰æ•°ç»„ä»£ç ç”Ÿæˆ

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- æ•°ç»„è¯­æ³•ï¼š`[Type: Size]`
- Size å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡
- å¤šç»´æ•°ç»„ï¼š`[[Type: N]: M]`
- æ•°ç»„å¤§å°æŸ¥è¯¢ï¼š`sizeof(arr)` æˆ– `len(arr)`

**ä½¿ç”¨åœºæ™¯**ï¼š
- ç¬¦å·è¡¨æ§½ä½æ•°ç»„ï¼ˆ`[&Symbol: 256]`ï¼‰
- è¯æ³•åˆ†æå™¨ç¼“å†²åŒºï¼ˆ`[i8: 1024*1024]`ï¼‰
- AST èŠ‚ç‚¹æ•°ç»„ï¼ˆ`&[ASTNode: N]`ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/checker.h:48` - SymbolTable slots[256]
- `compiler-mini/src/lexer.h:77` - Lexer buffer[1024*1024]
- `compiler-mini/src/codegen.h:25` - struct_types[64]

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
struct SymbolTable {
    slots: [&Symbol: 256];  // å›ºå®šå¤§å°æ•°ç»„ï¼Œå…ƒç´ ç±»å‹ä¸ºæŒ‡é’ˆ
    count: i32;
}

struct Lexer {
    buffer: [i8: 1024*1024];  // 1MB ç¼“å†²åŒº
    position: i32;
}

struct CodeGenerator {
    struct_types: [StructTypeMap: 64];
    var_map: [VarMap: 256];
}

// æ•°ç»„è®¿é—®
fn access_array(arr: [i32: 10], index: i32) i32 {
    if index >= 0 && index < 10 {
        return arr[index];  // æ•°ç»„è®¿é—®ï¼ˆéœ€è¦è¾¹ç•Œæ£€æŸ¥è¯æ˜ï¼‰
    }
    return 0;
}

// æ•°ç»„å¤§å°
const buffer: [i8: 1024] = [];
const size: i32 = sizeof(buffer);  // æ•°ç»„æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰
const len: i32 = len(buffer);  // æ•°ç»„å…ƒç´ ä¸ªæ•°ï¼ˆ1024ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- æ•°ç»„å£°æ˜è¯­æ³•ï¼š`[Type: Size]`
- Size å¿…é¡»æ˜¯ç¼–è¯‘æœŸå¸¸é‡ï¼ˆ`const` æˆ–å­—é¢é‡ï¼‰
- æ•°ç»„è®¿é—®è¯­æ³•ï¼š`arr[index]`
- æ•°ç»„ä½œä¸ºå‡½æ•°å‚æ•°ï¼šæŒ‰å€¼ä¼ é€’ï¼ˆå¤åˆ¶æ•´ä¸ªæ•°ç»„ï¼‰æˆ–æŒ‰æŒ‡é’ˆä¼ é€’ `&[T: N]`
- æ•°ç»„å¤§å°æŸ¥è¯¢ï¼š`sizeof(arr)` è¿”å›æ•°ç»„æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰ï¼Œ`len(arr)` è¿”å›å…ƒç´ ä¸ªæ•°

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- è¯­æ³•ä¸å®Œæ•´ Uya å®Œå…¨ä¸€è‡´ï¼š`[T: N]`

---

### 3. `sizeof` å†…ç½®å‡½æ•°

**çŠ¶æ€**ï¼šæœªå®ç°ï¼ˆç¼–è¯‘å™¨å®ç°ï¼‰  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆåŒ…æ‹¬ BNF è¯­æ³•å®šä¹‰ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-11ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ·»åŠ  `sizeof_expr` çš„ BNF è¯­æ³•å®šä¹‰
- âœ… åœ¨è¡¨è¾¾å¼è¯­æ³•ä¸­æ­£ç¡®é›†æˆ `sizeof` è¯­æ³•

**å®ç°çŠ¶æ€è¯´æ˜**ï¼ˆåŸºäºæºç åˆ†æï¼‰ï¼š
- âŒ AST èŠ‚ç‚¹ç±»å‹ä¸­æ²¡æœ‰ `sizeof` ç›¸å…³èŠ‚ç‚¹
- âŒ è§£æå™¨æ²¡æœ‰å®ç° `sizeof` è§£æ
- âŒ ç±»å‹æ£€æŸ¥å™¨æ²¡æœ‰ `sizeof` ç±»å‹æ£€æŸ¥
- âŒ ä»£ç ç”Ÿæˆå™¨æ²¡æœ‰ `sizeof` ä»£ç ç”Ÿæˆ
- æ³¨æ„ï¼šæºç ä¸­çš„ `sizeof` æ˜¯ C è¯­è¨€çš„ `sizeof`ï¼Œä¸æ˜¯ Uya è¯­è¨€çš„å†…ç½®å‡½æ•°

**è§„èŒƒè¯´æ˜**ï¼š
- `sizeof(T)` æ˜¯å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
- è¿”å›ç±»å‹å¤§å°ï¼ˆç¼–è¯‘æœŸå¸¸é‡ï¼‰
- **è®¾è®¡å†³å®š**ï¼šUya Mini ä½œä¸ºæœ€å°å­é›†ï¼Œä¸ä¾èµ–æ¨¡å—ç³»ç»Ÿï¼Œå› æ­¤ `sizeof` ä½œä¸ºå†…ç½®å‡½æ•°è€Œéæ ‡å‡†åº“å‡½æ•°

**ä½¿ç”¨åœºæ™¯**ï¼š
- Arena åˆ†é…å™¨å†…å­˜åˆ†é…ï¼ˆ`arena_alloc(arena, sizeof(ASTNode))`ï¼‰
- æ•°ç»„å¤§å°è®¡ç®—ï¼ˆ`sizeof(&ASTNode) * capacity`ï¼‰
- ç»“æ„ä½“åˆå§‹åŒ–ï¼ˆ`memset(codegen, 0, sizeof(CodeGenerator))`ï¼‰
- ç¼“å†²åŒºå¤§å°æ£€æŸ¥

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/ast.c:14` - `arena_alloc(arena, sizeof(ASTNode))`
- `compiler-mini/src/parser.c:220` - `sizeof(ASTNode *) * new_capacity`
- `compiler-mini/src/codegen.c:18` - `memset(codegen, 0, sizeof(CodeGenerator))`

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼š
```uya
// å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼Œç›´æ¥ä½¿ç”¨ï¼‰
const node_size: i32 = sizeof(ASTNode);
const token_size: i32 = sizeof(Token);

// è¡¨è¾¾å¼å¤§å°æŸ¥è¯¢
var codegen: CodeGenerator = ...;
const codegen_size: i32 = sizeof(codegen);  // æˆ– sizeof(CodeGenerator)

// æ•°ç»„å¤§å°è®¡ç®—
const ptr_size: i32 = sizeof(&ASTNode);  // æŒ‡é’ˆç±»å‹å¤§å°
const array_size: i32 = sizeof(&ASTNode) * capacity;

// æ•°ç»„æ€»å¤§å°
var buffer: [i8: 1024] = [];
const buffer_size: i32 = sizeof(buffer);  // è¿”å› 1024ï¼ˆå­—èŠ‚ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- `sizeof(Type)` - è·å–ç±»å‹çš„å¤§å°ï¼ˆç¼–è¯‘æ—¶è®¡ç®—ï¼‰
- `sizeof(expr)` - è·å–è¡¨è¾¾å¼ç»“æœç±»å‹çš„å¤§å°ï¼ˆç¼–è¯‘æ—¶è®¡ç®—ï¼‰
- `sizeof(array)` - è·å–æ•´ä¸ªæ•°ç»„çš„æ€»å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
- `sizeof(&T)` - è·å–æŒ‡é’ˆç±»å‹çš„å¤§å°ï¼ˆé€šå¸¸ 8 å­—èŠ‚ï¼‰
- è¿”å›å€¼ç±»å‹ï¼š`i32`ï¼ˆå­—èŠ‚æ•°ï¼‰
- å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡
- **è®¾è®¡å†³å®š**ï¼šUya Mini ä½œä¸ºæœ€å°å­é›†ï¼Œä¸ä¾èµ–æ¨¡å—ç³»ç»Ÿï¼Œå› æ­¤ `sizeof` ä½œä¸ºå†…ç½®å‡½æ•°

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- å®Œæ•´ Uya ä¸­ `sizeof(T)` æ˜¯æ ‡å‡†åº“å‡½æ•°ï¼ˆ`use std.mem;`ï¼‰
- Uya Mini ä¸­ `sizeof(T)` æ˜¯å†…ç½®å‡½æ•°ï¼ˆæ— éœ€å¯¼å…¥ï¼‰ï¼Œè¿™æ˜¯ Uya Mini æœ€å°å­é›†è®¾è®¡çš„ç®€åŒ–

---

### 4. `extern` å‡½æ•°æŒ‡é’ˆå‚æ•°æ”¯æŒï¼ˆæ‰©å±•ï¼‰

**çŠ¶æ€**ï¼šéƒ¨åˆ†æ”¯æŒï¼ˆå½“å‰ä»…æ”¯æŒåŸºç¡€ç±»å‹å‚æ•°ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆå¿…éœ€ï¼‰

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- `extern` å‡½æ•°å£°æ˜æ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°ï¼ˆ`*T`ï¼‰
- `*T` ç±»å‹ä»…ç”¨äº FFI å‡½æ•°å£°æ˜/è°ƒç”¨
- æ”¯æŒæ‰€æœ‰ C å…¼å®¹ç±»å‹ï¼š`*i8` `*i16` `*i32` `*i64` `*u8` `*u16` `*u32` `*u64` `*f32` `*f64` `*bool` `*byte` `*void` `*CStruct`

**å½“å‰é™åˆ¶**ï¼š
- Uya Mini è§„èŒƒä¸­ `extern` ä»…æ”¯æŒåŸºç¡€ç±»å‹å‚æ•°ï¼Œä¸æ”¯æŒæŒ‡é’ˆç±»å‹å‚æ•°

**ä½¿ç”¨åœºæ™¯**ï¼š
- è°ƒç”¨ C æ ‡å‡†åº“å‡½æ•°ï¼ˆ`fopen`, `fread`, `strcmp` ç­‰ï¼‰
- è°ƒç”¨ LLVM C APIï¼ˆå¤§éƒ¨åˆ†å‡½æ•°éœ€è¦æŒ‡é’ˆå‚æ•°ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/main.c:23-29` - æ–‡ä»¶ I/O
- `compiler-mini/src/codegen.c` - LLVM C API è°ƒç”¨

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
// C æ ‡å‡†åº“å‡½æ•°å£°æ˜
extern fn fopen(filename: *byte, mode: *byte) *FILE;
extern fn fread(buffer: *void, size: i32, count: i32, file: *FILE) i32;
extern fn fclose(file: *FILE) i32;
extern fn strcmp(s1: *byte, s2: *byte) i32;
extern fn strlen(s: *byte) i32;
extern fn memcpy(dest: *void, src: *void, n: i32) *void;
extern fn memset(s: *void, c: i32, n: i32) *void;

// LLVM C API å‡½æ•°å£°æ˜
extern fn LLVMContextCreate() *LLVMContext;
extern fn LLVMModuleCreateWithNameInContext(name: *byte, context: *LLVMContext) *LLVMModule;
extern fn LLVMInt32Type() *LLVMType;
extern fn LLVMBuildAlloca(builder: *LLVMBuilder, ty: *LLVMType, name: *byte) *LLVMValue;
```

**å®ç°è¦ç‚¹**ï¼š
- æ‰©å±• `extern` å‡½æ•°å£°æ˜è¯­æ³•ï¼Œæ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°å’Œè¿”å›å€¼
- ç±»å‹æ˜ å°„ï¼š`*byte` â†’ `char*`, `*void` â†’ `void*`, `*i32` â†’ `int*` ç­‰
- è°ƒç”¨çº¦å®šï¼šä¸ C å…¼å®¹
- æ³¨æ„ï¼š`*T` ä»…ç”¨äº FFIï¼Œæ™®é€šå‡½æ•°å‚æ•°ä½¿ç”¨ `&T`

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- ä¸å®Œæ•´ Uya çš„ FFI è§„èŒƒå®Œå…¨ä¸€è‡´

---

## P1 ä¼˜å…ˆçº§ç‰¹æ€§ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

### 5. æšä¸¾ç±»å‹ (`enum`) âœ… å®Œæ•´ Uya å·²æ”¯æŒ

**çŠ¶æ€**ï¼šå®Œæ•´ Uya å·²æ”¯æŒï¼ŒUya Mini éœ€æ·»åŠ   
**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- æšä¸¾é»˜è®¤åº•å±‚ç±»å‹ä¸º `i32`
- æ”¯æŒæ˜¾å¼æŒ‡å®šåº•å±‚ç±»å‹ï¼ˆ`u8`, `u16`, `u32`, `i8`, `i16`, `i32`, `i64`ï¼‰
- æšä¸¾å˜ä½“å¯ä»¥æ˜¾å¼èµ‹å€¼
- æšä¸¾å€¼ä½¿ç”¨ `EnumName.Variant` è¯­æ³•
- ç±»å‹å®‰å…¨ï¼šæšä¸¾å€¼åªèƒ½ä¸ç›¸åŒæšä¸¾ç±»å‹æ¯”è¾ƒ
- ä¸ C æšä¸¾å®Œå…¨å…¼å®¹

**ä½¿ç”¨åœºæ™¯**ï¼š
- TokenType æšä¸¾ï¼ˆ`TOKEN_EOF`, `TOKEN_IDENTIFIER` ç­‰ï¼‰
- ASTNodeType æšä¸¾ï¼ˆ`AST_PROGRAM`, `AST_FN_DECL` ç­‰ï¼‰
- TypeKind æšä¸¾ï¼ˆ`TYPE_I32`, `TYPE_BOOL` ç­‰ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/lexer.h:16` - TokenType æšä¸¾
- `compiler-mini/src/ast.h:9` - ASTNodeType æšä¸¾
- `compiler-mini/src/checker.h:9` - TypeKind æšä¸¾

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
// åŸºæœ¬æšä¸¾ï¼ˆé»˜è®¤åº•å±‚ç±»å‹ i32ï¼‰
enum TokenType {
    TOKEN_EOF,
    TOKEN_IDENTIFIER,
    TOKEN_NUMBER,
    TOKEN_STRUCT,
    // ...
}

enum ASTNodeType {
    AST_PROGRAM,
    AST_FN_DECL,
    AST_STRUCT_DECL,
    // ...
}

// æ˜¾å¼èµ‹å€¼
enum TypeKind {
    TYPE_I32 = 0,
    TYPE_BOOL = 1,
    TYPE_VOID = 2,
    TYPE_STRUCT = 3
}

// ä½¿ç”¨
const token: TokenType = TokenType.TOKEN_IDENTIFIER;
const node_type: ASTNodeType = ASTNodeType.AST_PROGRAM;

fn get_token_type() TokenType {
    return TokenType.TOKEN_IDENTIFIER;
}
```

**å®ç°è¦ç‚¹**ï¼š
- æšä¸¾å€¼é»˜è®¤ä» 0 å¼€å§‹é€’å¢
- æšä¸¾å€¼å¯ä»¥æ˜¾å¼èµ‹å€¼
- ç±»å‹å®‰å…¨ï¼šæšä¸¾ç±»å‹ä¸èƒ½éšå¼è½¬æ¢ä¸ºæ•´æ•°ï¼ˆæˆ–åœ¨éœ€è¦æ—¶æ”¯æŒè½¬æ¢ï¼‰
- å¯ä»¥ä¸æ•´æ•°æ¯”è¾ƒï¼ˆå¦‚æœéœ€è¦ C å…¼å®¹æ€§ï¼‰
- åº•å±‚è¡¨ç¤ºï¼š`i32`ï¼ˆé»˜è®¤ï¼‰æˆ–æŒ‡å®šçš„åº•å±‚ç±»å‹

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- è¯­æ³•ä¸å®Œæ•´ Uya å®Œå…¨ä¸€è‡´

---

### 6. å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆæœ‰é™æ”¯æŒï¼‰

**çŠ¶æ€**ï¼šæœªå®ç°ï¼ˆç¼–è¯‘å™¨å®ç°ï¼‰  
**è§„èŒƒçŠ¶æ€**ï¼šâœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰ï¼ˆä½œä¸º FFI å‡½æ•°å‚æ•°ï¼‰  
**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰

**è§„èŒƒæ–‡æ¡£æ›´æ–°**ï¼ˆ2026-01-11ï¼‰ï¼š
- âœ… å·²åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­æ˜ç¡®å­—ç¬¦ä¸²å­—é¢é‡çš„æ”¯æŒèŒƒå›´
- âœ… æ·»åŠ äº†å­—ç¬¦ä¸²å­—é¢é‡çš„è¯æ³•è§„åˆ™å®šä¹‰ï¼ˆ3.4 èŠ‚ï¼‰
- âœ… åœ¨è¡¨è¾¾å¼è¯­æ³•ä¸­æ·»åŠ äº†å­—ç¬¦ä¸²å­—é¢é‡ï¼ˆ`STRING`ï¼‰
- âœ… æ·»åŠ äº†è¯¦ç»†çš„è¯´æ˜å’Œç¤ºä¾‹

**è§„èŒƒè¯´æ˜**ï¼ˆå‚è€ƒå®Œæ•´ Uyaï¼‰ï¼š
- å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ï¼š`*byte`ï¼ˆFFI æŒ‡é’ˆç±»å‹ï¼‰
- å­—ç¬¦ä¸²å­—é¢é‡å­˜å‚¨ï¼šç¼–è¯‘å™¨åœ¨åªè¯»æ•°æ®æ®µä¸­å­˜å‚¨ï¼ˆnull ç»ˆæ­¢ï¼‰
- ä»…å¯ä½œä¸º `extern` å‡½æ•°å‚æ•°ä½¿ç”¨ï¼ˆä¸èƒ½èµ‹å€¼ç»™å˜é‡ã€ä¸èƒ½ç”¨äºæ™®é€šè¡¨è¾¾å¼ï¼‰
- ä¸æä¾›å†…ç½®å­—ç¬¦ä¸²æ“ä½œï¼Œéœ€è¦é€šè¿‡ `extern` è°ƒç”¨ C å‡½æ•°ï¼ˆå¦‚ `strcmp`ï¼‰

**ä½¿ç”¨åœºæ™¯**ï¼š
- å­—ç¬¦ä¸²æ¯”è¾ƒï¼ˆ`strcmp("i32", type_name)`ï¼‰
- é”™è¯¯æ¶ˆæ¯
- æ ‡è¯†ç¬¦å­—ç¬¦ä¸²å­˜å‚¨

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/codegen.c:112-116` - å­—ç¬¦ä¸²æ¯”è¾ƒ

**è¯­æ³•è§„èŒƒå»ºè®®**ï¼ˆç¬¦åˆå®Œæ•´ Uya è§„èŒƒï¼‰ï¼š
```uya
extern fn strcmp(s1: *byte, s2: *byte) i32;

// å­—ç¬¦ä¸²å­—é¢é‡ä½œä¸º FFI å‡½æ•°å‚æ•°
fn compare_string(s: *byte) bool {
    return strcmp(s, "i32") == 0;  // å­—ç¬¦ä¸²å­—é¢é‡ "i32" ç±»å‹ä¸º *byte
}

// å­—ç¬¦ä¸²å­—é¢é‡ç”¨äºæ¯”è¾ƒ
// æ³¨æ„ï¼šå­—ç¬¦ä¸²å­—é¢é‡ä¸èƒ½ç›´æ¥èµ‹å€¼ç»™å˜é‡ï¼ˆä»…ç”¨äº FFI å‡½æ•°å‚æ•°ï¼‰
```

**å®ç°è¦ç‚¹**ï¼š
- å­—ç¬¦ä¸²å­—é¢é‡ç±»å‹ï¼š`*byte`ï¼ˆFFI æŒ‡é’ˆç±»å‹ï¼‰
- å­—ç¬¦ä¸²å­—é¢é‡å­˜å‚¨ï¼šç¼–è¯‘å™¨åœ¨åªè¯»æ•°æ®æ®µä¸­å­˜å‚¨
- å­—ç¬¦ä¸²æ¯”è¾ƒï¼šéœ€è¦é€šè¿‡ `extern` å‡½æ•°ï¼ˆå¦‚ `strcmp`ï¼‰
- æ³¨æ„ï¼šUya Mini ä¸æä¾›å†…ç½®å­—ç¬¦ä¸²æ“ä½œï¼Œéœ€è¦é€šè¿‡ `extern` è°ƒç”¨ C å‡½æ•°

**ä¸å®Œæ•´ Uya çš„å¯¹åº”å…³ç³»**ï¼š
- ä¸å®Œæ•´ Uya çš„å­—ç¬¦ä¸²å­—é¢é‡è§„åˆ™ä¸€è‡´ï¼ˆä»…ç”¨äº FFIï¼‰

---

## P2 ä¼˜å…ˆçº§ç‰¹æ€§ï¼ˆå¯é€‰ï¼‰

### 7. è”åˆä½“ (`union`) - å¯é€‰

**çŠ¶æ€**ï¼šæœªå®ç°  
**ä¼˜å…ˆçº§**ï¼šP2ï¼ˆå¯é€‰ï¼‰

**è§„èŒƒè¯´æ˜**ï¼š
- å®Œæ•´ Uya è§„èŒƒä¸­æœªæ˜ç¡®æåˆ° union
- å¯ä»¥ç”¨ç»“æ„ä½“ + ç±»å‹æ ‡ç­¾ï¼ˆtagged unionï¼‰æ›¿ä»£

**ä½¿ç”¨åœºæ™¯**ï¼š
- ASTNode çš„ union è®¾è®¡ï¼ˆèŠ‚çœå†…å­˜ï¼Œå½“å‰ä½¿ç”¨ union å­˜å‚¨ä¸åŒç±»å‹èŠ‚ç‚¹æ•°æ®ï¼‰

**å‚è€ƒä»£ç **ï¼š
- `compiler-mini/src/ast.h:45-159` - ASTNode ä½¿ç”¨ union

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š
ä½¿ç”¨ç»“æ„ä½“ + ç±»å‹æ ‡ç­¾ï¼ˆtagged unionï¼‰ï¼Œä½†å ç”¨æ›´å¤šç©ºé—´ï¼š
```uya
struct ASTNode {
    node_type: ASTNodeType;
    data: ASTNodeData;  // åŒ…å«æ‰€æœ‰å¯èƒ½çš„å­—æ®µï¼ˆæµªè´¹ç©ºé—´ä½†å¯è¡Œï¼‰
}
```

**å®ç°å»ºè®®**ï¼š
- å¦‚æœ Uya Mini éœ€è¦ä¸¥æ ¼çš„æœ€å°åŒ–ï¼Œå¯ä»¥ä¸å®ç° union
- ä½¿ç”¨ tagged union æ›¿ä»£æ–¹æ¡ˆï¼ˆç»“æ„ä½“ + ç±»å‹æ ‡ç­¾ï¼‰

---

## å®ç°è·¯çº¿å›¾

### é˜¶æ®µ1ï¼šæ ¸å¿ƒç‰¹æ€§ï¼ˆP0ï¼‰

1. **å®ç°æŒ‡é’ˆç±»å‹** (`&T` å’Œ `*T`)
   - æ™®é€šæŒ‡é’ˆ `&T`ï¼šè¯­æ³•åˆ†æå™¨ã€ç±»å‹æ£€æŸ¥å™¨ã€ä»£ç ç”Ÿæˆå™¨æ‰©å±•
   - FFI æŒ‡é’ˆ `*T`ï¼šä»…ç”¨äº extern å‡½æ•°å£°æ˜
   - å–åœ°å€å’Œè§£å¼•ç”¨æ“ä½œç¬¦

2. **å®ç°å›ºå®šå¤§å°æ•°ç»„** (`[T: N]`)
   - è¯­æ³•åˆ†æå™¨æ‰©å±•
   - ç±»å‹æ£€æŸ¥å™¨æ‰©å±•ï¼ˆç¼–è¯‘æœŸå¸¸é‡å¤§å°æ£€æŸ¥ï¼‰
   - ä»£ç ç”Ÿæˆå™¨æ‰©å±•ï¼ˆLLVM IR ç”Ÿæˆï¼‰

3. **å®ç° `sizeof` å†…ç½®å‡½æ•°**
   - è¯­æ³•åˆ†æå™¨æ‰©å±•ï¼ˆä½œä¸ºå†…ç½®å‡½æ•°å¤„ç†ï¼‰
   - ç±»å‹æ£€æŸ¥å™¨æ‰©å±•ï¼ˆç¼–è¯‘æ—¶è®¡ç®—ï¼‰
   - ä»£ç ç”Ÿæˆå™¨æ‰©å±•ï¼ˆç”Ÿæˆå¸¸é‡ï¼‰

4. **æ‰©å±• `extern` å‡½æ•°å£°æ˜**
   - è¯­æ³•åˆ†æå™¨æ‰©å±•ï¼ˆæ”¯æŒ FFI æŒ‡é’ˆç±»å‹å‚æ•°ï¼‰
   - ç±»å‹æ£€æŸ¥å™¨æ‰©å±•ï¼ˆæŒ‡é’ˆç±»å‹æ£€æŸ¥ï¼‰
   - ä»£ç ç”Ÿæˆå™¨æ‰©å±•ï¼ˆFFI è°ƒç”¨ï¼‰

### é˜¶æ®µ2ï¼šå¢å¼ºç‰¹æ€§ï¼ˆP1ï¼‰

5. **å®ç°æšä¸¾ç±»å‹** (`enum`)
   - è¯­æ³•åˆ†æå™¨æ‰©å±•
   - ç±»å‹æ£€æŸ¥å™¨æ‰©å±•
   - ä»£ç ç”Ÿæˆå™¨æ‰©å±•

6. **å¢å¼ºå­—ç¬¦ä¸²å­—é¢é‡æ”¯æŒ**
   - ç¡®ä¿å­—ç¬¦ä¸²å­—é¢é‡å¯ä»¥ä½œä¸º FFI å‡½æ•°å‚æ•°
   - å­—ç¬¦ä¸²å­—é¢é‡çš„å­˜å‚¨å’Œç±»å‹

### é˜¶æ®µ3ï¼šä¼˜åŒ–ç‰¹æ€§ï¼ˆP2ï¼‰

7. **å®ç°è”åˆä½“** (`union`)ï¼ˆå¯é€‰ï¼‰
   - æˆ–ä½¿ç”¨ tagged union æ›¿ä»£æ–¹æ¡ˆ

---

## å‚è€ƒæ–‡æ¡£

- `uya_ai_prompt.md` - **å®Œæ•´ Uya è¯­è¨€è§„èŒƒï¼ˆå¿…é¡»å‚è€ƒï¼‰**
- `spec/UYA_MINI_SPEC.md` - Uya Mini è¯­è¨€è§„èŒƒï¼ˆâœ… å·²æ›´æ–°ï¼š2026-01-11 ä¿®å¤æŒ‡é’ˆè§£å¼•ç”¨å’Œ sizeof è¯­æ³•å®šä¹‰ï¼‰
- `CODE_REVIEW.md` - å¯è¡Œæ€§è¯„ä¼°æŠ¥å‘Š
- `compiler-mini/src/` - compiler-mini æºä»£ç ï¼ˆå‚è€ƒå®ç°ï¼‰

---

## æµ‹è¯•ç­–ç•¥

æ¯ä¸ªç‰¹æ€§å®ç°åéœ€è¦ï¼š

1. **è¯­æ³•æµ‹è¯•**ï¼šéªŒè¯è¯­æ³•è§£ææ­£ç¡®
2. **ç±»å‹æ£€æŸ¥æµ‹è¯•**ï¼šéªŒè¯ç±»å‹æ£€æŸ¥æ­£ç¡®
3. **ä»£ç ç”Ÿæˆæµ‹è¯•**ï¼šéªŒè¯ç”Ÿæˆçš„ä»£ç æ­£ç¡®
4. **é›†æˆæµ‹è¯•**ï¼šåœ¨ compiler-mini é‡æ„ä¸­ä½¿ç”¨æ–°ç‰¹æ€§

---

## è§„èŒƒæ–‡æ¡£çŠ¶æ€

**è§„èŒƒæ–‡æ¡£æ›´æ–°è®°å½•**ï¼š

- **2026-01-11**ï¼šä¿®å¤äº† `spec/UYA_MINI_SPEC.md` ä¸­çš„ä»¥ä¸‹é—®é¢˜ï¼š
  - âœ… æ·»åŠ äº†æŒ‡é’ˆè§£å¼•ç”¨è¿ç®—ç¬¦ `*expr` çš„å®Œæ•´è¯­æ³•å®šä¹‰
  - âœ… æ·»åŠ äº† `sizeof` çš„ BNF è¯­æ³•å®šä¹‰ï¼ˆ`sizeof_expr`ï¼‰
  - âœ… ä¿®å¤äº†ç« èŠ‚ç¼–å·é—®é¢˜ï¼ˆ4.6 â†’ 4.5ï¼‰
  - âœ… åˆå¹¶äº†é‡å¤çš„"è¯´æ˜"éƒ¨åˆ†
  - âœ… å®Œå–„äº†æŒ‡é’ˆè§£å¼•ç”¨å’Œç±»å‹æ¨æ–­çš„è¯´æ˜

**å½“å‰å®ç°çŠ¶æ€æ€»ç»“**ï¼ˆåŸºäºæºç åˆ†æï¼Œ2026-01-11ï¼‰ï¼š

**å·²å®ç°ç‰¹æ€§**ï¼ˆç¼–è¯‘å™¨ä»£ç ä¸­å·²å®ç°ï¼‰ï¼š
- âœ… åŸºç¡€ç±»å‹ï¼š`i32`ã€`bool`ã€`void`ã€`struct Name`
- âœ… ç»“æ„ä½“å®šä¹‰ã€å®ä¾‹åŒ–å’Œå­—æ®µè®¿é—®
- âœ… `extern` å‡½æ•°å£°æ˜ï¼ˆåŸºç¡€ç±»å‹å‚æ•°ï¼‰
- âœ… æ§åˆ¶æµï¼š`if`ã€`while`ã€`return`
- âœ… è¡¨è¾¾å¼ï¼šç®—æœ¯ã€é€»è¾‘ã€æ¯”è¾ƒè¿ç®—
- âœ… ä¸€å…ƒè¡¨è¾¾å¼ï¼š`!`ï¼ˆé€»è¾‘éï¼‰ã€`-`ï¼ˆè´Ÿå·ï¼‰

**è§„èŒƒå·²å®šä¹‰ä½†æœªå®ç°ç‰¹æ€§**ï¼š
- âŒ æŒ‡é’ˆç±»å‹ `&T` å’Œ `*T`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ æ•°ç»„ç±»å‹ `[T: N]`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ `sizeof` å†…ç½®å‡½æ•°ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ `for` å¾ªç¯ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ `break` å’Œ `continue` è¯­å¥ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ å–åœ°å€è¿ç®—ç¬¦ `&expr`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ è§£å¼•ç”¨è¿ç®—ç¬¦ `*expr`ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ `null` å­—é¢é‡ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼Œç¼–è¯‘å™¨æœªå®ç°ï¼‰
- âŒ `byte` ç±»å‹ï¼ˆè§„èŒƒå·²å®šä¹‰ï¼ŒTypeKind æšä¸¾ä¸­æœªåŒ…å«ï¼‰

**å®ç°çŠ¶æ€æ£€æŸ¥æ–¹æ³•**ï¼š
- æ£€æŸ¥ `src/checker.h` ä¸­çš„ `TypeKind` æšä¸¾
- æ£€æŸ¥ `src/ast.h` ä¸­çš„ `ASTNodeType` æšä¸¾
- æ£€æŸ¥ `src/lexer.h` ä¸­çš„ `TokenType` æšä¸¾
- æ£€æŸ¥æµ‹è¯•ç¨‹åºç›®å½• `tests/programs/` ä¸­çš„æµ‹è¯•ç”¨ä¾‹

**è§„èŒƒæ–‡æ¡£ä¸å®ç°çŠ¶æ€çš„å…³ç³»**ï¼š

- **è§„èŒƒçŠ¶æ€**ï¼šæŒ‡è¯­æ³•è§„èŒƒæ˜¯å¦åœ¨ `spec/UYA_MINI_SPEC.md` ä¸­å®šä¹‰
- **å®ç°çŠ¶æ€**ï¼šæŒ‡ç¼–è¯‘å™¨ä»£ç æ˜¯å¦å®ç°äº†è¯¥ç‰¹æ€§
- è§„èŒƒå¯èƒ½å·²å®šä¹‰ï¼Œä½†å®ç°ä»ä¸º"æœªå®ç°"çŠ¶æ€

**æ›´æ–°è§„èŒƒæ–‡æ¡£çš„æ—¶æœº**ï¼š

å®ç°æ¯ä¸ªç‰¹æ€§åï¼Œéœ€è¦æ›´æ–°ï¼š

- `spec/UYA_MINI_SPEC.md` - æ·»åŠ æ–°ç‰¹æ€§çš„è¯­æ³•è§„èŒƒå’Œè¯­ä¹‰è§„åˆ™
- `spec/grammar_formal.md` - æ›´æ–° BNF è¯­æ³•ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
- ç›¸å…³ç¤ºä¾‹ä»£ç 

**é‡è¦**ï¼šæ‰€æœ‰è¯­æ³•å¿…é¡»ä¸å®Œæ•´ Uya è¯­è¨€è§„èŒƒï¼ˆ`uya_ai_prompt.md`ï¼‰ä¿æŒä¸€è‡´ã€‚

