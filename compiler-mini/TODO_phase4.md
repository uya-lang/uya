# 阶段4：实现词法分析器（Lexer）

## 4.1 Token 类型定义

- [ ] 创建 `src/lexer.h`
  - [ ] 定义 TokenType 枚举（仅包含最小子集需要的 Token）
    - [ ] 基础：EOF、IDENTIFIER、NUMBER、布尔字面量
    - [ ] 关键字：struct、const、var、fn、return、if、else、while、true、false
    - [ ] 运算符：+、-、*、/、%、==、!=、<、>、<=、>=、&&、||、!
    - [ ] 标点符号：(、)、{、}、;、,、=、.
  - [ ] 定义 Token 结构体（值、行号、列号等）
  - [ ] 添加中文注释说明

## 4.2 Lexer 结构定义

- [ ] 在 `src/lexer.h` 中定义 Lexer 结构体
  - [ ] 源代码缓冲区（固定大小数组）
  - [ ] 当前位置、行号、列号
  - [ ] 文件名（如果需要）
  - [ ] 添加中文注释说明

## 4.3 Lexer 核心实现（TDD，可以分部实现）

### TDD Red: 编写测试

- [ ] 创建测试文件
  - [ ] 测试 `lexer_new()` 创建功能
  - [ ] 测试标识符识别
  - [ ] 测试关键字识别
  - [ ] 测试数字识别
  - [ ] 测试运算符识别
  - [ ] 运行测试确保失败

### TDD Green: 实现功能（可以分多次会话完成）

- [ ] 创建 `src/lexer.c`
  - [ ] 实现 `lexer_new()` - 创建 Lexer（读取文件到固定大小缓冲区）
  - [ ] 实现 `lexer_next_token()` - 获取下一个 Token
  - [ ] 实现标识符和关键字识别
  - [ ] 实现数字字面量识别
  - [ ] 实现运算符和标点符号识别
  - [ ] 实现注释处理（`//` 单行注释）
  - [ ] 实现空白字符跳过
  - [ ] 所有字符串存储在 Arena 中
  - [ ] 添加中文注释说明
  - [ ] 运行测试确保通过
  - [ ] **验证函数 < 200 行，文件 < 1500 行**
  - [ ] **如果文件超过 1500 行，必须拆分为多个文件**

### TDD Refactor: 优化

- [ ] 代码审查和重构
- [ ] 运行测试确保通过

## 4.4 Lexer 测试

- [ ] 创建测试用例验证 Lexer 功能
- [ ] 测试基本 Token 识别
- [ ] 测试关键字识别
- [ ] 测试数字识别
- [ ] 测试运算符识别

