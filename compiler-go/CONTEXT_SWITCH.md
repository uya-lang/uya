# 上下文切换指南

当 Cursor 上下文满了，需要在新会话中继续工作时，请按照以下步骤操作：

## 🔄 快速恢复步骤

### 1. 新会话开始时

打开 Cursor 后，立即执行以下操作：

1. **阅读当前进度**
   ```bash
   # 查看进度文档
   cat compiler-go/PROGRESS.md
   ```

2. **查看待办任务**
   ```bash
   # 查看详细任务列表
   cat compiler-go/TODO.md
   ```

3. **查看规则文件**
   ```bash
   # 确认开发规则
   cat compiler-go/.cursorrules
   ```

### 2. 确认当前状态

检查以下内容：

- ✅ 查看 `PROGRESS.md` 中的"已完成模块"部分
- ✅ 查看 `PROGRESS.md` 中的"下一步行动"
- ✅ 确认上次会话完成的工作状态
- ✅ 检查代码是否可以编译（如果可能）

### 3. 继续执行计划

根据 `PROGRESS.md` 中的"下一步行动"，继续实现：

1. **从标记的模块开始**
   - 不要重复已完成的工作
   - 按照依赖顺序实现（Lexer → Parser → Checker → IR → CodeGen → Main）

2. **遵循 TDD 流程**
   - 先写测试（Red）
   - 实现功能（Green）
   - 重构优化（Refactor）

3. **保持代码质量**
   - 函数 < 150 行
   - 文件 < 1500 行
   - 通过 linter 检查

### 4. 完成模块后

立即更新进度：

1. **更新 PROGRESS.md**
   - 将完成的模块标记为 ✅
   - 更新"下一步行动"
   - 记录完成时间

2. **更新 TODO.md（可选）**
   - 标记已完成的任务项

3. **提交代码（如果使用 git）**
   ```bash
   git add compiler-go/
   git commit -m "feat: 完成 [模块名称] 实现"
   ```

## 📋 检查清单

在新会话开始前，确认：

- [ ] 已阅读 `PROGRESS.md`
- [ ] 已阅读 `TODO.md`（了解详细任务）
- [ ] 已阅读 `.cursorrules`（了解开发规范）
- [ ] 了解当前进度状态
- [ ] 知道下一步要做什么
- [ ] 确认依赖的模块已完成

在模块完成后，确认：

- [ ] 代码可以编译（或至少语法正确）
- [ ] 符合代码质量约束（函数<150行，文件<1500行）
- [ ] 已更新 `PROGRESS.md`
- [ ] 已提交代码（如果使用版本控制）

## 🔍 关键文件说明

| 文件 | 用途 | 何时查看 |
|------|------|----------|
| `PROGRESS.md` | 当前进度和状态 | 每次新会话开始时 |
| `TODO.md` | 详细任务列表 | 需要了解具体任务时 |
| `.cursorrules` | 开发规则和规范 | 新会话开始时确认规则 |
| `.cursor/plans/*.plan.md` | 原始迁移计划 | 需要了解整体架构时 |

## 💡 提示

1. **从 PROGRESS.md 开始**：这是最重要的文件，包含当前状态
2. **按顺序实现**：不要跳过依赖的模块
3. **小步提交**：完成一个模块就更新进度，不要等到全部完成
4. **保持一致性**：遵循已有的代码风格和结构
5. **测试优先**：始终遵循 TDD 流程

## 🚨 常见问题

**Q: 如何知道从哪里继续？**
A: 查看 `PROGRESS.md` 中的"下一步行动"部分

**Q: 如果上次会话没有完成模块怎么办？**
A: 查看代码状态，如果基本功能已实现但测试未完成，继续完成测试和优化

**Q: 如何确认代码质量？**
A: 运行 `go test` 和 `golangci-lint`，检查文件行数和函数行数

**Q: 可以并行实现多个模块吗？**
A: 不建议，因为模块之间有依赖关系。按照依赖顺序实现更安全。

## 📝 示例：新会话开始

```bash
# 1. 查看当前进度
cat compiler-go/PROGRESS.md

# 输出示例：
# 下一步行动: 继续实现阶段3：Parser 模块，从 parser.go 核心开始

# 2. 查看具体任务
grep -A 20 "阶段3" compiler-go/TODO.md

# 3. 开始实现（根据 PROGRESS.md 的指示）
# 实现 parser.go 核心功能...
```

