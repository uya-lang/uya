# 已知问题和限制

本文档记录Uya编译器Go实现中的已知问题和限制。

## 代码生成限制

### For循环
- **状态**: 简化实现（占位符）
- **问题**: `for`循环的完整代码生成尚未实现
- **影响**: 生成的C代码中包含TODO注释，需要手动处理
- **计划**: 未来版本实现完整的迭代器支持和for循环展开

### Defer和ErrDefer
- **状态**: ✅ 已完整实现（2026-01-11）
- **问题**: ~~defer和errdefer语句当前直接生成代码，未实现LIFO栈管理~~（已修复）
- **影响**: ~~生成的代码可能不符合Uya语义（应该在函数返回时执行）~~（已修复）
- **实现**: 
  - defer和errdefer块在函数体中收集，不立即生成代码
  - return语句被转换为goto到返回标签
  - 在`_error_return_`标签处：先执行errdefer块（LIFO顺序），再执行defer块（LIFO顺序）
  - 在`_normal_return_`标签处：执行defer块（LIFO顺序）
  - 完整的错误联合类型返回支持

### Try-Catch错误处理
- **状态**: 简化实现
- **问题**: try-catch表达式的完整错误处理尚未实现
- **影响**: 错误传播和错误联合类型处理不完整
- **计划**: 未来版本实现完整的错误联合类型支持

## 类型检查限制

### 表达式类型检查
- **状态**: 部分实现
- **问题**: 某些二元和一元运算符的类型检查使用简化实现
- **影响**: 可能无法完全检测类型错误
- **计划**: 未来版本实现完整的类型检查规则

### 成员访问和下标
- **状态**: 简化实现
- **问题**: 成员访问和数组下标操作的完整类型检查未实现
- **影响**: 结构体字段访问和数组访问的类型安全无法完全保证
- **计划**: 未来版本实现完整的类型检查

### Match表达式
- **状态**: 未实现
- **问题**: match表达式的类型检查未实现
- **影响**: match表达式无法使用
- **计划**: 未来版本实现pattern matching支持

## IR生成限制

### Try表达式
- **状态**: 简化实现（占位符）
- **问题**: try表达式的IR生成未完整实现
- **影响**: try表达式可能无法正确编译
- **计划**: 未来版本实现完整的try表达式支持

### Match表达式
- **状态**: 未实现
- **问题**: match表达式的IR生成未实现
- **影响**: match表达式无法使用
- **计划**: 未来版本实现pattern matching支持

## Parser限制

### 数组大小解析
- **状态**: 简化实现
- **问题**: 数组类型的大小表达式解析仅支持数字字面量
- **影响**: 编译期常量表达式作为数组大小可能无法解析
- **计划**: 未来版本支持编译期常量表达式

### 切片语法
- **状态**: 未实现
- **问题**: 切片语法（如`arr[1:3]`）解析未实现
- **影响**: 切片语法无法使用
- **计划**: 未来版本实现切片语法支持

### Interface声明
- **状态**: 部分实现
- **问题**: interface声明解析使用了简化实现
- **影响**: 某些interface特性可能无法使用
- **计划**: 未来版本完善interface支持

## 测试覆盖

- **状态**: 基础测试覆盖
- **问题**: 测试覆盖主要针对核心功能，端到端测试尚未完成
- **影响**: 复杂程序的编译可能存在问题
- **计划**: 未来版本增加端到端测试和集成测试

## 性能

- **状态**: 未优化
- **问题**: 性能优化和基准测试尚未完成
- **影响**: 编译大型程序可能较慢
- **计划**: 未来版本进行性能优化和基准测试

## 文档

- **状态**: 部分完成
- **问题**: API文档（godoc）和迁移说明文档尚未完成
- **影响**: 开发者使用和迁移可能遇到困难
- **计划**: 持续完善文档

---

**最后更新**: 2026-01-11
