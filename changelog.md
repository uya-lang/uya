# Uya 语言版本变更日志

本文档记录 Uya 语言的所有版本变更历史。

---

## 0.17 版本变更（相对于 0.16）

### 0.17 新增特性
- **移动语义**（第 12.5 章）：结构体赋值时转移所有权，避免不必要的拷贝，零运行时开销
  - 自动移动场景：赋值、函数参数传递、返回值、结构体字段初始化、数组元素赋值
  - 严格检查机制：存在活跃指针时禁止移动，防止悬垂指针
  - 与 RAII 完美配合：移动后只有目标对象调用 drop，防止 double free
- **结构体方法语法糖**（第 29.3 章）：`obj.method()` 语法糖，编译期展开为静态函数调用
  - 支持 `Self` 占位符：`fn method(self: *Self) ReturnType`，与接口实现语法一致
  - 必须使用指针：`self: *Self` 或 `self: *StructName`，不允许按值传递，避免语义歧义
  - 方法调用不触发移动：调用时自动传递指针（`&obj`），确保方法调用后原对象仍然可用
  - 零运行时开销：编译期展开为静态函数，所有方法都是静态绑定
- **Self 类型扩展**：`Self` 占位符现在可以在结构体方法中使用，与接口实现保持一致
- ***T 语法扩展**：`*T` 语法现在可以在结构体方法的方法签名中使用

---

## 0.16 版本变更（相对于 0.15）

### 0.16 新增特性
- **字符串插值**（第 23 章）：支持 `"a${x}"` 和 `"pi=${pi:.2f}"` 两种形式
- **安全指针算术**（第 27 章）：支持 `ptr +/- offset`，必须通过编译期证明安全
- **测试单元**（第 28 章）：`test` 块用于单元测试

---

## 0.15 版本变更（相对于 0.14）

### 0.15 新增特性
- **sizeof 和 alignof**：标准库函数，用于获取类型大小和对齐，编译期常量，零运行时开销
  - 位置：`std/mem.uya`
  - 使用：`use std.mem.{sizeof, alignof};`
  - 支持所有基础类型、数组、结构体、原子类型等

---

## 语法简化（跨版本）

### for 循环语法简化
- 移除 `iter()` 和 `range()` 函数，直接支持 `for obj |v| {}` 和 `for 0..10 |v| {}`
- 新增可修改迭代语法：`for obj |&v| {}`（用于修改数组元素）
- 支持丢弃元素语法：`for obj {}` 和 `for 0..N {}`（只循环次数，不绑定变量）

### 运算符简化
- 移除 `checked_*` 函数，使用 `try` 关键字进行溢出检查（如 `try a + b`）
- 移除 `saturating_*` 函数，使用饱和运算符（`+|`, `-|`, `*|`）
- 移除 `wrapping_*` 函数，使用包装运算符（`+%`, `-%`, `*%`）

---

## 向后兼容性

- 所有 0.13 代码保持兼容（语法变更不影响现有代码）
- 新语法完全可选，可以继续使用原有方式

